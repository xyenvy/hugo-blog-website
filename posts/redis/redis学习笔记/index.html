<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Redis学习笔记 | Cookie</title>
<meta name="keywords" content="redis">
<meta name="description" content="Redis 是完全开源免费的，遵守BSD协议，是一个高性能(NOSQL)的key-value数据库，Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存可持久化的日志型，Key-Value数据库，并提供多种语言的API">
<meta name="author" content="Cookie">
<link rel="canonical" href="http://hugo.itshare.work/posts/redis/redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://hugo.itshare.work/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="http://hugo.itshare.work/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="http://hugo.itshare.work/img/Q.gif">
<link rel="apple-touch-icon" href="http://hugo.itshare.work/img/Q.gif">
<link rel="mask-icon" href="http://hugo.itshare.work/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="Redis学习笔记" />
<meta property="og:description" content="Redis 是完全开源免费的，遵守BSD协议，是一个高性能(NOSQL)的key-value数据库，Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存可持久化的日志型，Key-Value数据库，并提供多种语言的API" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://hugo.itshare.work/posts/redis/redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" />
<meta property="og:image" content="http://oss.itshare.work/itshare-work-images/28.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-09T14:59:00+00:00" />
<meta property="article:modified_time" content="2023-02-09T15:59:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://oss.itshare.work/itshare-work-images/28.jpg" />
<meta name="twitter:title" content="Redis学习笔记"/>
<meta name="twitter:description" content="Redis 是完全开源免费的，遵守BSD协议，是一个高性能(NOSQL)的key-value数据库，Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存可持久化的日志型，Key-Value数据库，并提供多种语言的API"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "📚文章",
          "item": "http://hugo.itshare.work/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "🧨 Redis",
          "item": "http://hugo.itshare.work/posts/redis/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Redis学习笔记",
      "item": "http://hugo.itshare.work/posts/redis/redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Redis学习笔记",
  "name": "Redis学习笔记",
  "description": "Redis 是完全开源免费的，遵守BSD协议，是一个高性能(NOSQL)的key-value数据库，Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存可持久化的日志型，Key-Value数据库，并提供多种语言的API",
  "keywords": [
    "redis"
  ],
  "articleBody": "Redis学习笔记 一 、Redis简介 1.1 什么是Redis Redis 是完全开源免费的，遵守BSD协议，是一个高性能(NOSQL)的key-value数据库*，Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存可持久化的日志型，Key-Value数据库，并提供多种语言的API。\nBSD是\"Berkeley Software Distribution\"的缩写，意思是“伯克利软件发型版本”。 BSD开源协议是一个给予使用者很大自由的协议。可以自由的使用，修改源代码，也可以将修改后的代码作为开源或者专有软件在发布。BSD代码鼓励代码共享，但需要尊重代码作者的著作权。 BSD由于允许使用者修改和重新发布代码，也允许使用或在BSD代码上开发商业软件发布和销售，一次是对商业集成很友好的协议。 1.2 NoSQL NoSQL,泛指非关系型的数据库，NoSQL即Not-only SQL,它可以作为关系型数据库的良好补充。随着互谅网web2.0网站的兴起，非关系型的数据库现在成为了一个及其热门的新领域，非关系型数据库产品的发展非常迅速。 传统数据库暴露很多难以克服的问题，如下问题：\n1、High performance - 对数据库高并发读写的需求。 2、Huge Storage - 对海量数据的高效存储和访问的需求。 3、High Scalability \u0026\u0026 High Availability - 对数据库的高可扩展性和高课用性的需求。 1.3 NoSQL的类别 键值（Key-Value）存储数据库\n这一类数据库主要会使用到一个哈希表，这个表中有一个特定的键和一个指针指向特定的数据。 key/value模型对于IT系统涞水的优势在于简单，已部署。但是如果DBA只对部分值进行查询或者更新的时候，key/value显示的效率低下。 相关产品 ： Redis，Tokyo Cabinet 典型应用 ： 内存缓存，主要用于处理大量数据的高访问负载。 数据模型 ： 一系列键值对 优势 ： 快速查询 劣势 ： 存储的数据缺少结构化 列存储数据库\n这部分数据库通常是用来对分布式存储的海量数据。键仍然存在，但是他们的特点是指向了多个列。这些列是由列家族来安排的。 相关产品 : HBase 、Riak 典型应用 ： 分布式的文件系统 数据模型 ： 以列簇式存储，将同一列数据存在一起 优势 ： 查找速度快，可扩展性强，更容易进行分布式扩展 劣势 ： 功能相对于局限 文档型数据库\n文档型数据库：该类型的数据库模型是版本化的文档，半结构化的文档一特定的格式存储，比如JSON。文档数据库可以看做键值数据库的升级版，允许之间嵌套键值。而且文档型数据库比键值数据库的查询效率更高。 相关产品：MOngoDB 典型应用 ： web应用 数据模型 ： 一系列键值对 优势 ： 数据结构要求不严格 劣势 ： 查询性能不高，而且缺乏统一的查询语言 1.4 总结： NoSQL 数据库在一下的这几种情况下比较适用 ：\n1、数据模型比较简单；\n2、需要灵活更前的IT系统；\n3、对数据库性能要求较高；\n4、不需要高度的数据一致性；\n5、对于给定key，比较容易映射复杂的环境；\n1.5 Redis 描述 ​\tRedis是完全开源免费的，遵守BSD协议，是一个高性能(NoSQL)的（key-value）数据库，Redis是一个开源的使用ANSI C语言编写，支持网络，可基于内存亦可持久化的日志型，Key-Value数据库，并提供多种语言的API。\n1.6 Redis的特点 性能极高 - Redis读写的熟读110000次/s，写的速度是81000次/s。 丰富的数据类型 - Redis支持的类型String， Hash 、List 、Set 及 Ordered Set数据类型操作。 原子性 - Redis的所有操作都是原子性的，意思就是要么成功，要么失败。单个操作时原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。 丰富的特性 - Redis还支持publis/subscribe，通知，key过期等等特性。 高速读写 ，redis使用自己实现的分离器，代码量很短，没有使用lock(MySQL),因此效率非常高。 Redis是一个简单的，高效的，分布式的，基于内存的缓存工具。\n架设好服务器后，通过网络连接(类似数据库)，提供Key-Value缓存服务。\n简单，是Redis突出的特色。\n简单可以保证核心功能的稳定和优异。\n1.7 Redis的应用场景 可以作为数据库，缓存，热点数据(经常别查询，但是不经常被修改或者删除的数据)和消息中间件等大部分功能。\nRedis常用的场景示例如下：\n1、缓存 缓存现在几乎是所有大中型网站都在用的必杀技，合理利用缓存提升网站的访问速度，还能大大降低数据库的访问压力。Redis提供了键过期功能，也提供了灵活的键淘汰策略，所以，现在Redis用在缓存的场合非常多。 2、排行榜 Redis提供的有序集合数据类结构能够实现葛洪复杂的排行榜应用。 3、计数器 什么是计数器，，视频网站的播放量等等，每次浏览+1，并发量高时如果每次都请求数据库操作无疑是中挑战和压力。Redis提供的incr命令来实现计数器功能，内存操作，性能非常好，非常是用于这些技术场景。 4、分布式会话 集群模式下，在应用不多的情况下一般使用容日自带的session复制功能就能够满足，当应用相对复杂的系统中，一般都会搭建Redis等内存数据库为中心的session服务，session不在由容器管理，而是有session服务及内存数据管理。 5、分布式锁 在很多互联网公司中都是用来分布式技术，分布式技术带来的技术挑战是对同一个资源的并发访问，如全局ID，减库存，秒杀等场景，并发量不发的场景可以使用数据库的悲观锁，乐观锁来实现，但是在并发高的场合中，利用数据库锁来控制资源的并发访问是不太理想的，大大影响了数据库的性能。可以利用Redis的setnx功能来编写分布式的锁，如果设置返回1，说明获取所成功，否则获取锁失败，实际应用中药考虑的细节要更多。 6、社交网络 点赞、踩、关注/被关注，共同好友等是社交网站的基本功能，社交网站的访问量通常老说比较大，而且传统的关系数据库不适合这种类型的数据，Redis提供的哈希，集合等数据结构能很方便的实现这些功能。 7、最新列表 Redis列表结构，LPUSH可以在列表头部插入一个内容ID作为关键字，LTRIM可以用来限制列表的数量，这样列表永远为N个ID。无需查询最新的列表，直接根据ID 去到对应的内容也即可。 8、消息系统 消息对队列是网站比用中间件，如ActiveMQ，RabbitMQ，Kafaka等流行的消息队列中间件，主要用于业务解耦，流量削峰及异步处理试试性低的业务。Redis提供了发布/订阅及阻塞队列功能，能实现一个简单的消息队列系统。另外，这个不能喝专业的消息中间件相比。 1.8 Redis总结 优势\n性能极高 - Redis读写的熟读110000次/s，写的速度是81000次/s。 丰富的数据类型 - Redis支持的类型String， Hash 、List 、Set 及 Ordered Set数据类型操作。 原子性 - Redis的所有操作都是原子性的，意思就是要么成功，要么失败。单个操作时原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。 丰富的特性 - Redis还支持publis/subscribe，通知，key过期等等特性。 高速读写 ，redis使用自己实现的分离器，代码量很短，没有使用lock(MySQL),因此效率非常高。 缺点\n持久化。 Redis直接将数据存储到内存中，要将数据保存到磁盘上，Redis可以使用两种方式实现持久化过程。定时快照(snapshot)：每个一端时间将整个数据库写到磁盘上，每次均是写全部数据，代价非常高。第二种方式基于语句追加（aof）：只追踪变化的数据，但是追加的log可能过大，同时所有的操作均重新执行一遍，回复速度慢。 耗内存 、占用内存过高。 二、Redis安装 2.1 Redis官网 官方网站 ： https://redis.io/\n官方下载 ： https://redis.io/download 可以根据需要下载不同版本\n2.2 Redis 安装 Redis是C语言开发，安装Redis需要先将官网下载的源码进行编译。编译依赖gcc环境，如果没有gcc环境，需要安装gcc\n2.3 安装gcc gcc的安装很简单，首先要确保root登录，其次就是Linux要能连外网\nyum -y install gcc automake autoconf libtool make 注意： 运行yum是出现/var/run/yum.pid已被锁定，PID为xxxx的另外一个程序正在运行的问题解决。\nrm -f /var/run/yum.pid 2.4 安装Redis 下载redis二进制安装包\nwget http://download.redis.io/release/redis-6.0.5.tar.gz 解压/apps目录下\ntar zxvf redis-6.0.5.tar.gz -C /apps #Linux 中剪切命令 mv redis-6.0.5.tar.gz 安装包 #Linux中复制命令: cp Files path cp redis-6.0.5.tar.gz /root/apps 进入redis中使用make命令进行编译\n[root@centos redis-5.0.8]# make MALLOC=libc LINK redis-cli CC redis-benchmark.o LINK redis-benchmark INSTALL redis-check-rdb INSTALL redis-check-aof Hint: It's a good idea to run 'make test' ;) make[1]: 离开目录“/root/apps/redis-5.0.8/src” [root@centos redis-5.0.8]# ll 安装成功如上\n2.5 安装到指定的位置 make PREFIX=/root/apps/redis install （安装编译后的文件）安装到指定目录；\n注意：PREFIX必须为大写，同时会自动为我们创建redis目录，并将结果安装此目录；\n三 、Redis启动 3.1 启动Redis服务端，进入到Redis的安装目录 cd /usr/local/redis 3.2 执行命令 ./bin/redis-server 3.3 Redis的客户端进行启动 ./bin/redis-cli 3.4 启动Redis客户端命令语法： redis-cli -h IP地址 -p 端口 //默认IP本机 端口号6379 3.5 检测是否服务端启动 启动redis客户端，打开终端并输入命令redis-cli。该命令连接本地的redis服务。\n127.0.0.1:6379\u003e 127.0.0.1:6379\u003e ping PONG 127.0.0.1:6379\u003e 在以上实例中我们连接到本地的redis服务并执行PING 命令，该命令用于检测redis服务是否启动\n3.6 检查redis的进程 #执行 ps -ef | grep -i redis 来查看进程 ps -ef | grep -i redis root 10050 5728 0 23:03 pts/0 00:00:03 ./bin/redis-server *:6379 root 10077 10056 0 23:10 pts/1 00:00:00 ./bin/redis-cli root 10100 10081 0 23:22 pts/2 00:00:00 grep --color=auto -i redis [root@centos ~]# 四、Redis配置详细 Redis默认定义了很多默认配置。但在实际开发中，一般我们都会通过手动配置完成。回到安装目录下找到解压文件中的redis.conf。\nRedis的配置文件位于Redis安装目录下，文件名称为redis.conf\n4.1 配置Redis 命令：解压目录下的redis.conf配置文件复制到安装文件的目录下\n#把编译的redis.conf文件放 ，安装的redis文件目录下 [root@centos redis-5.0.8]# pwd /root/apps/redis-5.0.8 [root@centos redis-5.0.8]# cp redis.conf /root/apps/redis [root@centos redis-5.0.8]# cd .. [root@centos apps]# ll 4.2 Redis.conf 1、Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程 daemonize no 2、当Redis以守护进程方式运行时，Redis默认会把pid写入/var/run/redis.pid文件，可以通过pidfile指定 pidfile /var/run/redis.pid 3、指定Redis监听端口，默认端口为6379；’ port 6379 4、绑定的主机地址 bind 127.0.0.1 5、当客户端限制多长时间后关闭连接，如果指定为0，表示关闭该功能 timeout 300 6、指定日志记录几倍，Redis总共支持四个级别：debug，verbose，notice，warning，默认为verbose loglevel verbos 7、日志记录方式，默认为标准输出，如果配置Redis为守护进程方式运行，而这里又配置日志记录方式标准输出，则日志将会发送给/dev/null logfile stdout 8、设置数据库的数量，默认数据库为0，可以使用SELECT\u003cdbid\u003e命令在连接上指定数据库id databases 16 9、指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合 save\u003cseconds\u003e\u003cchanges\u003e Redis默认配置文件中提供了三个条件 save 900 1 save 300 10 save 60 10000 分别表示900秒(15分钟)内有1个更改，300秒(5分钟)内有10个更改以及60秒内有10000个更改。 10、指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF(压缩算法)压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大 rdbcompression yes 中间10个\n11、指定本地数据库文件名，默认为dump.rdb dbfilename dump.rdb 12、指定本地数据库存放目录 dir ./ 13、设置当本机为slav服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步slaveof\u003cmasterip\u003e \u003cmasterport\u003e 14、当master服务设置了密码保护时，slav服务连接master的密码 masterauth\u003cmaster-password\u003e 15、设置Redis连接密码，如果配置了连接密码，客户端在连接Redis是需要通过AUTH \u003cpassword\u003e命令提供密码，默认关闭 requirepass foobared 16、设置同一时间最大客户端连接数，默认是无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数，如果设置maxclients 0，表示不作限制。当客户端连接数到达限制是，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息 maxclients 128 17、指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，档次方法处理后，仍然达最大内存设置，将无法再进行写入操作，但仍然可以静心读取操作。Rdis新的vm机制，会把key存放内存，Value会存放在swap区 maxmemory \u003cbytes\u003e 18、指定是否每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一端时间内的数据丢失。因为 redis 本省同步数据文件是按上面save条件来同步的，所有的数据会在一端时间内只存在于内存中。默认为no appendonly no 19、指定更新日志文件名，默认为appendonly.aof appendfulename appendonly.aof 20、指定更新日志条件，共有3个可选值： no: 表示等操作系统进行数据缓存同步到磁盘(快) always: 表示每次更新操作后活动调用fsync()将数据写到磁盘(慢，安全) everysec: 表示每秒同步一个(折中，默认值) appendfsync everysec maxmemory-policy noeviction # 内存达到上限之后的处理策略 1、volatile-lru ： 只对设置了过期时间的key进行LRU（默认值） 2、allkeys-lru ： 产出lru算法的key 3、volatile-random ： 随机删除即将过期key 4、allkey -random : 随机删除 5、volatile-ttl : 删除即将过期的 6、noeviction ： 永不过期，返回错误 结尾10个\n21、指定是否启用虚拟内存机制，默认为no，简单的介绍一下，vm机制将数据分页存放，有Redis将访问量较少的页即冷数据swap到磁盘上，访问多的页面由磁盘自动换出到内存中(在后面的文章会仔细分析Redis的vm机制) vm-enabled no 22、虚拟内存文件路径，默认值为/tmp/redis.swap，不可多个Redis实例共享 vm-swap-file /tmp/redis.swap 23、将所有大于vm-max-memory的数据存入虚拟内存，无论vm-max-memory设置多小，所有索引数据都是内存存储的(Redis的索引数据 就是keys)，也就是说，当vm-max-memory设置为0的时候，其实是所有value都存在于磁盘。默认值为0 vm-page-size 32 24、Redis swap文件分成了很多的page，一个对象可以保存咱几多个page上面，但一个page上不能被多个对象共享，vm-page-size是要根据存储的 数据大小来设定的，作者建议如果村粗很多小对象，page大小最好设置为32或者64bytes；如果存储很大大对象，则可以使用更大的page，如果不确定，就是用默认值 vm-page-size 32 25、设置swap文件中的page数量，由于页表(一种表示页面空闲或是欧诺个的bitmap)是放在内存中的，在磁盘上每8个pages将消耗1byte的内存 vm-pages 134217728 26、设置访问swap文件的线程数，最好不要超过机器的核数，如果设置为0，那么所有对swap文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为 4 vm-max-threads 4 27、设置在向客户端应答时，是否把较小的包含并未一个包发送，默认为开启 glueoutputbuf yes 28、指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法 hash-max-zipmap-entries 64 hash-max-zipmap-value 512 29、指定是否激活重置哈希。默认为开启(后面在介绍Redis的哈希算法时具体介绍) activerehasing yes 30、指定包含其他的配置文件，可以在同一主机上多个redis实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件 include /path/to/local.conf 4.2、内存中的维护策略 redis作为优秀的中间缓存件，时常会存储大量的数据，即使采取了集群部署来动态扩容，也应该即使的整理内存，维持系统性能。\n4.2.1 在redis中有两种解决方案 为数据设置超时时间 //设置过期时间 expire key time(以秒为单位)--这是最常用的方式 setex(String key, int seconds, String value) --字符串独有的方式 1、除了字符串自己独有设置过期时间的方法外，其他方法都需要依靠expire方法来设置时间 2、如果没有设置时间，那缓存就是永不过期 3、如果设置了过期时间，之后又想让缓存永不过期没使用persist key 采用LRU算法动态将不用的数据删除 内存管理的一种页面置换算法，对于在内存中但又不用的数据块(内存块)叫做LRU， 操作系统会根据哪些数据属于LRU而将其移除内存而腾出空间来加载另外的数据。 1.volatile-lru：设定超时时间的数据中，删除最不常使用的数据\n2.allkeys-lru：查询所有的key只能怪最近最不常使用的数据进行删除，这是应用最广泛的策略。\n3.volatile-random：在已经设定了超时的数据中随机删除。\n4.allkeys-random：查询所有的key，之后随机删除。\n5.volatile-ttl：查询全部设定超时时间的数据，之后排序，将马上要过期的数据进行删除操作。\n6.noeviction：如果设置为该属性，则不会进行删除操作，如果内存溢出则报错返回。\n7.volatile-lfu：从所有配置了过去时间的键中驱逐使用频率最少的键\n8.allkeys-lfu：从所有键中驱逐使用频率最少的键\n4.2.2 自定义配置redis 进入对应的安装目录：\n/root/apps/redis 修改redis.conf配置文件 vim redis.conf（进入命令模式 通过/内容 查找相应字符串）\ndaemonize no 修改为 daemonize yes 守护进程启动 bind 127.0.0.1 注释掉 允许除本机 外的机器访问redis服务 requirepass 设置密码 设定数据库密码 (保证服务安全/有些情况下不设定密码是无法进行远程连接访问的) Redis采用的是单进程多线程的模式。当redis.conf中选项daemonize设置成为yes时，代表开启守护进程模式。在该模式下，redis会在后台运行，并将进程pid号写入值redis.conf选项pidfile设置的文件中，此时redis将一直运行，除非手动kill该进程。但当daemonize选项设置为no时，当前界面将进入redis的命令行界面，exit强制退出或者关闭连接工具（putty,xshell等）都会呆滞redis进程退出。\n服务端开发的大部分应用都是采用后台运行的模式\nrequirepass设置密码。因为redis速度相当快，所以一台比较好的服务器下，一个外部用户在一秒内可以进行15w密码尝试，这意味你需要设定非常强大的密码来防止暴力破解。\n可以通过redis的配置文件设置密码参数，这样客户端连接大redis服务就需要密码验证，这样可以让你的redis服务更加安全。\n五 、Redis启动 5.1 Redis以守护进程服务端进行启动 // 使用该命令进行启动：【./bin/redis-server ./redis.conf 】 [root@centos redis]# ./bin/redis-server ./redis.conf 11450:C 05 Jul 2020 12:23:34.257 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo 11450:C 05 Jul 2020 12:23:34.257 # Redis version=5.0.8, bits=64, commit=00000000, modified=0, pid=11450, just started 11450:C 05 Jul 2020 12:23:34.257 # Configuration loaded [root@centos redis]# 5.2 Redis客户端进行启动： //Redis 客户端启动命令：./redis-cli [root@centos bin]# ./redis-cli 127.0.0.1:6379\u003e keys * 1) \"name\" 127.0.0.1:6379\u003e 六、Redis关闭 6.1、第一种关闭方式： (断电、非正常关闭，容易数据丢失) 查询不到redis进程id\nPID ps -ef | grep -i redis kill 查询的id进行强制关闭\nkill -9 PID 6.2、第二种关闭方式 (正常关闭，数据保存)\n关闭redis服务，通过客户端进行shutdown\n如果redis设置了密码，需要先在客户端通过密码登录，在进行shutdown即可关闭服务端\n// 在客户端使用【shutdown】命令关闭Redis服务端 127.0.0.1:6379\u003e SHUTDOWN not connected\u003e y Could not connect to Redis at 127.0.0.1:6379: Connection refused not connected\u003e shutdown 七、远程连接 7.1 Redis远程连接比较流行的软件：RedisDesktoManager 默认不允许远程连接，需要修改一下信息才可以进行修改，\nbind 127.0.0.1 注释掉 允许除本机以外的机器访问Redis服务 requirepass 设置密码 设定数据库密码(有些情况系不设定密码是无法进行远程连接访问的) 7.2 Redis使用密码登录 // Redis客户端使用密码进行登录 【./bin/redis-cli -a redis】 [root@centos redis]# ./bin/redis-cli -a redis Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 127.0.0.1:6379\u003e keys * 1) \"name\" 127.0.0.1:6379\u003e Centos 防火墙端口 开放8080端口（如下命令只针对Centos7以上）\n查看已经开放的端口：\nfirewall-cmd --list-ports 开启端口：\nfirewall-cmd --zone=public --add-port-6379/tcp --permanent 重启防火墙：\nfirewall-cmd --reload #重启 Firewall systemctl stop firewalld.service #停止 firewall systemctl disable firewalld.service #禁止firewall 开机启动 八 、Docker安装Redis 8.1 搜索redis docker search redis 8.2 下载镜像 docker pull redis：4.0.1 8.3 创建并运行容器 docker run -d --name redis6379 -p 6379:6379 redis:4.0.1 --requirepass \"redis\" 8.4 测试进入Redis进入客户端 使用redis镜像执行redis-cli命令连接到刚启动的容器\n九、Redis常用命令 Redis 命令用于在redis服务上执行操作。要在redis服务上执行命令需要一个redis客户端。\nRedis 客户端在我们之前下载的Redis的安装包中。\n**Redis支持的物种数据类型 ：string(字符串)，hash(哈希)，list(列表)，set(集合)及zset（sorted set : 有序集合）等\n9.1 常用命令key管理 1、 keys * :返回满足的所有键，可以模糊匹配，比如 keys abc* ：表示以 abc 开头的 key 2、 exists key ： 是否存在指定的key ，存在返回1.不存在返回0 3、 expire key second ：设置某个key的过期时间 时间为妙 4、 del key : 删除某个key 5、 ttl key ：查看剩余时间，当key不存在是，返回-2；存在但没有设置剩余生存时间时，返回 -1，否 则，以秒为单位，返回key 的剩余生存时间。 6、 persist key ：取消过去时间 7、 PEXPIRE key millisseconds 修改key 的过期时间为毫秒 8、 select ： 选择数据库 数据库为0-15（默认一共16个数据库） 9、 设计成多个数据库实际上是为了数据库安全和备份 10、 move key dbindex ： 将当前数据中的key转移到其他数据库 11、 randomkey ： 随机返回一个key 12、 rename key key2 : 种命名key 13、 echo ： 打印命令 14、 dbsize : 查看数据库的key数量 15、 info : 查看数据库信息 16、 config get * 实时存储收到的请求，返回相关的配置 17、 flushdb ： 清除当前数据库 18、 flushall ： 清空所有数据库 9.2 DEL key 该命令用于在key存在时删除key。 9.3 EXISTS key 检查给定key是否存在。 9.4 EXPIRE key seconds 为给定key设置过期时间(以秒计) 9.5 PEXPIRE key milliseconds 设置key的过期时间以毫秒计 9.6 TTL key 以秒为单位，返回给定key的剩余生存时间(TTL, time to live) 9.7 PTTL key 以秒为单位，返回 key 的剩余生存时间 9.8 KEYS pattern 查找所有服务给定模式(pattern)的key。 keys 通配符 获取所有与pattern匹配的key，返回所有与该匹配 通配符 ： * 代表所有 ? 表示代表一个字符 9.9 RENAME key newkey 修改key的名称 9.10 MOVE key db 将当前数据库的 key 移动到给定的数据库db当中 9.11 TYPE key 返回 key 所存储的值的类型 9.12 应用场景 EXPIPER key seconds\n1、限时的优惠活动信息 2、网站数据缓存(对于一些需要定时更新的数据，例如:积分排行榜) 3、手机验证码 4、限制网站访客访问频率(例如：1分钟最多访问10次) 9.13 key的命名建议 redis单个key允许存入512M大小\n1、key 不要太长，尽量不要超过1024字节，这不仅消耗内存，而且会降低查找的效率 2、key 也不要太短，太短的话，key的可读性会降低 3、在一个项目中，key最好使用提议的命名模式，例如user:12:password 4、key名称区分大小写 十 、Redis数据类型 10.1 String 类型 String类型是Redis最基本的数据类型，一个键最大能存储512MB。\nString 数据结构最贱但的key-value类型，value其不仅是string，也可以是数字，是包含很多种类型的特殊类型，\nString类型是二进制安全的。意思是redis的string可以包含任何数据。\n比如序列化的对象进行存储，比如一张图片进行二进制存储，比如一个简单的字符串，数值等等。\nString命令 1、复制语法： SET KEY_NAME VALUE : (说明：多次设置name会覆盖)(Redis SET 命令用于设置给定 key 的值。如果 key 已经存储值，SET 就要写旧值，且无视类型)。 2、命令： SETNX key1 value：(not exist) 如果key1不存在，则设置 并返回1。如果key1存在，则不设置并返回0;(解决分布式锁 方案之一，只有在key 不存在时设置 key 的值。setnx (SET if not exits)命令在指定的key不存在时，为key设置指定的值)。 SETEX key1 10 lx :(expired)设置key1的值为lx,过期时间为10秒，10秒后key1清除（key也清除） SETEX key1 10 lx :(expired) 设置key1的值为lx，过期时间为10秒，10秒后key1清除(key 也清除) SETRANG STRING range value : 替换字符串 3、取值语法： GET KEY_NAME : Redis GET 命令用于获取指定 key 的值。如果 key 不存在，返回 nil。如果key存储的值不是字符串类型，返回一个错误。 GETRANGE key start end : 用于获取存储在指定key中字符串的子字符串。字符串的截取范围由 start 和 end 两个偏移量来决定(包括 start 和 end 在内) GETBIT key offset ：对 key 所存储的字符串值，获取指定偏移量上的为(bit)； GETTEST语法 ： GETSET KEY_NAME VALUE : GETSET 命令用于设置指定 key 的值，并返回key的旧值。当key不存在是，返回 nil STRLEN key :返回 key 所存储的字符串值的长度 4、删除语法： DEL KEY_NAME : 删除指定的key，如果存在，返回数字类型。 5、批量写：MSET K1 V1 K2 V2 ... (一次性写入多个值) 6、批量读：MGET K1 K2 K3 7、GETSET NAME VALUE : 一次性设置和读取(返回旧值，写上新值) 8、自增/自减： INCR KEY_Name : Incr 命令将key中存储的数组值增1。如果 key 不存在，那么key的值会先被初始化为0，然后在执行INCR操作 自增: INCRBY KEY_Name : 增量值Incrby 命令将key中存储的数字加上指定的增量值 自减: DECR KEY_Name 或 DECYBY KEY_NAME 减值：DECR 命令将key中存储的数字减少1 ：(注意这些key对应的必须是数字类型字符串，否则会出错。) 字符串拼接：APPEND KEY_NAME VALUE :Append 命令用于为指定的key追加至末尾，如果不存在，为其赋值 字符串长度 ：STRLEN key ########################## setex (set with expire) #设置过期时间 setnx (set if not exist) #不存在设置 在分布式锁中会常常使用！ 10.2 应用场景 1、String通常用于保存单个字符串或JSON字符串数据\n2、因String是二进制安全的，所以你完全可以把一个图片文件的内容作为字符串来存储\n3、计数器(常规key-value缓存应用。常规计数：微博数，粉丝数)\nINCR 等指令本身就具有原子操作的特定，所以我们完全可以利用redis的INCR，INCRBY,DECR,DECRBY等指令来实现原子计数的效果。假如，在某种场景下有3个客户端同时读取了mynum的值(值为2)，然后对其同时进行了加1的操作，那么，最后mynum的值一定是5。 不少网站都利用redis的这个特性来实现业务上的统计计数需求。 10.3 Hash类型 Hash类型是String类型的field和value的映射表，或者说是一个String集合。hash特别适合用于存储对象，相比较而言，将一个对象类型存储在Hash类型要存储在String类型里占用更少的内存空间，并对整个对象的存取。可以看成具有KEY和VALUE的MAP容器，该类型非常适合于存储值对象的信息。\n如：uname，upass，age等。该类型的数据仅占用很少的磁盘空间(相比于JSON).\nRedis 中每一个hash 可以存储 2的32次方 -1 键值对(40 多亿)\n10.4 Hash命令 常用命令\n一、赋值语法： 1、 HSET KEY FIELD VALUE ： 为指定的KEY,设定FILD/VALUE 2、 HMSET KEY FIELD VALUE [FIELD1，VALUE]... : 同时将多个 field-value(域-值)对设置到哈希表key中。 二、取值语法： HGET KEY FIELD :获取存储在HASH中的值，根据FIELD得到VALUE HMGET KEY FIELD [FIELD1] :获取key所有给定字段的值 HGETALL KEY :返回HASH表中所有的字段和值 HKEYS KEY : 获取所有哈希表中的字段 HLEN KEY : 获取哈希表中字段的数量 三、删除语法： HDEL KEY FIELD[FIELD2] :删除一个或多个HASH表字段 四、其它语法： HSETNX KEY FIELD VALUE : 只有在字段field 不存在时，设置哈希表字段的值 HINCRBY KEY FIELD INCREMENT :为哈希key中的指定字段的整数值加上增量 increment。 HINCRBYFLOAT KEY FIELD INCREMENT :为哈希表key 中的指定字段的浮点数值加上增量 increment HEXISTS KEY FIELD : 查看哈希表中key中，指定的字段是否存在 10.5 应用场景 Hash的应用场景 ：(存储一个用户信息对象数据)\n常用于存储一个对象\n为什么不用string存储一个对象\nhash值最接近关系数据库结构的数据类型，可以将数据库一条记录或程序中一个对象转换成hashmap存放在redis中。\n用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息，如果用普通的key/value结构来存储，主要有一下2中村粗方式：\n​\t第一种方式将用户ID作为查找key，把其他信息封装成为一个对象以序列化的方式存储，这种方式的却但是，增加了序列化/反序列化的开销，并且在需要修改其中一项信息时，需要把整个对象取回，并且修改操作需要对并发进行保护，引入CAS等复杂问题。\n​ 第二种方法是这个用户信息对象有多少成员就存成多少个key-value对儿，用用户ID+对应属性的名称作为唯一标识来取的对应属性的值，虽然省去了序列化开销和并发问题，但是用户ID重复存储，如果存在大量这样的数据，内存浪费还是非常可观的。\n10.6 总结： Redis提供的Hash很好的解决了这个问题，Redis的Hash实际内部存储的Value为一个HashMap，\n10.6 List类型 简介：\n1、 List 类型是一个链表结构的集合，其主要功能有push、pop、获取元素等。更详细的说，List类型是一个双端链表的节后，我们可以通过相关的操作进行集合的头部或者尾部添加和删除元素，List的设计是非常简单精巧，即可以最为栈，有可以最为队列，满足绝大多数的需求。 常用命令\n1、赋值语法： LPUSH KEY VALUE1 [VALUE2] :将一个或多个值插入到列表头部（从左侧添加） RPUSH KEY VALUE1 [VALUE2] ：在列表中添加一个或多个值（从有侧添加） LPUSHX KEY VAKUE :将一个值插入到已存在的列表头部。如果列表不在，操作无效 RPUSHX KEY VALUE :一个值插入已经在的列表尾部（最右边）。如果列表不在，操作无效 2、取值语法： LLEN KEY :获取列表长度 LINDEX KEY INDEX\t:通过索引获取列表中的元素 LRANGE KEY START STOP\t:获取列表指定范围内的元素 描述：返回列表中指定区间的元素，区间以偏移量START和END指定。\n其中0表示列表的第一个元素，1表示列表的第二个元素，以此类推。。。\n也可以使用负数下标，以-1表示列表的最后一个元素，-2表示列表的倒数第二个元素，一次类推。。。\nstart：页大小（页数-1）\nstop：（页大小页数）-1\n3、删除语法： LPOP KEY :移除并获取列表的第一个元素（从左侧删除） RPOP KEY :移除列表的最后一个元素，返回值为移除的元素（从右侧删除） BLPOP key1 [key2]timeout :移除并获取列表的第一个元素，如果列表没有元素会阻塞列表知道等待超时或发现可弹出元素为止。 4、修改语法： LSET KEY INDEX VALUE :通过索引设置列表元素的值 LINSERT KEY BEFORE|AFTER WORIL VALUE :在列表的元素前或者后 插入元素 描述：将值 value 插入到列表key当中，位于值world之前或之后。 高级命令\n高级语法： RPOPLPUSH source destiation : 移除列表的最后一个元素，并将该元素添加到另外一个列表并返回 示例描述： RPOPLPUSH a1 a2 : a1的最后元素移到a2的左侧 RPOPLPUSH a1 a1 : 循环列表，将最后元素移到最左侧 BRPOPLPUSH source destination timeout :从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它；如果列表没有元素会阻塞列表知道等待超时或发现可弹出的元素为止。 List代码案例\npackage com.tyx.service.impl; import com.tyx.po.User; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.data.redis.core.RedisTemplate; import org.springframework.stereotype.Service; import org.springframework.util.CollectionUtils; import java.io.Serializable; import java.util.Collections; import java.util.List; import java.util.concurrent.TimeUnit; /** * @author papi * @data 2020/7/15 */ @Service @Slf4j public class UserServiceImpl { @Autowired private RedisTemplate\u003cString, Object\u003e redisTemplate; /** * Redis有什么命令，Jedis有什么方法 * Lettuce-----》RedisTemplate进一步的封装 *RedisTemplate 方法和命令是肯定不一样的 * Redis 和 String类型 * 需求输入一个key * 先判断该key是否存在如果不存在则在mysql中进行查询，写入到redis中。并返回值。 */ public String getRedisValueByKey(String key){ if (redisTemplate.hasKey(key)) { //表示存在值，进行获取 log.info(\"-------\u003e redis中查询的数据\"); Object o = redisTemplate.opsForValue().get(key); return (String) o; }else { //不存在去mysql中查并且赋值给reids String val = \"redis中不存在的key\"; log.info(\"------\u003emysql中查询出来的：\"+val); redisTemplate.opsForValue().set(key,val); log.info(\"------\u003emysql中查出的数据存入redis中\"); return val; } } /** * 测试String类型 * 需求：用户输入一个redis数据。该key的有效期为28小时 */ public void expireStr(String key, String val){ redisTemplate.opsForValue().set(key,val); redisTemplate.expire(key,2,TimeUnit.HOURS); } /** * 根据ID查询用户对象信息 * 先判断redis中是否存在该key * 如果不存在，查询数据库中mysql中的值，并将结果添加到redis中。 * 如果存在，直接将结果在redis查询，并返回。 */ public User getHashKey(String id){ if (redisTemplate.opsForHash().hasKey(\"user\",id)){ log.info(\"-----\u003e查询redis数据库\"); return (User) redisTemplate.opsForHash().get(\"user\",id); }else { log.info(\"-----\u003e查询mysql数据库\"); User user = new User(); user.setId(id); user.setAge(18); user.setName(\"速速\"); /* @param h 用户的实体 @param hk 用户主键id @param hv 整个对象 */ redisTemplate.opsForHash().put(\"user\",id,user); return user; } } /** * 将list放入缓存中 * @param key 值 * @param list 键 * @return true 成功 false 失败 */ public boolean lpushAll(String key, List\u003cObject\u003e list){ try { redisTemplate.opsForList().leftPush(key, list); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * 将list放入缓存中 * @param key 值 * @param list 键 * @param time 时间（秒） * @return true 成功 false 失败 */ public boolean lpushAll(String key, List\u003cObject\u003e list, long time){ try { redisTemplate.opsForList().leftPushAll(key, list); if (time \u003e0){ redisTemplate.expire(key,time,TimeUnit.SECONDS); } return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * 在变量左边添加元素。 * @param key * @param obj * @return */ public boolean lpush(String key, Object obj){ try { redisTemplate.opsForList().leftPush(key,obj); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * 在变量左边添加元素。 * @param key 键 * @param prvot 中间参数 * @param object 要放的值 * @return 。 */ public boolean lpush(String key, Object prvot,Object object){ try { redisTemplate.opsForList().leftPush(key,prvot,object); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * 在变量左边添加元素。 * @param key 键 * @param prvot 中间参数 * @param object 要放的值 * @return 。 */ public boolean rpush(String key, Object prvot,Object object){ try { redisTemplate.opsForList().rightPush(key,prvot,object); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * 在变量左边添加元素。 * @param key 键 * @param object 要放的值 * @return 。 */ public boolean rpush(String key, Object object){ try { redisTemplate.opsForList().rightPush(key,object); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * 在变量左边添加元素。 * @param key 键 * @param object 要放的值 * @return 。 */ public boolean lpushIfPresent(String key, Object object){ try { redisTemplate.opsForList().leftPushIfPresent(key,object); return true; }catch (Exception e){ e.printStackTrace(); return false; } } /** * 移除集合中的左边第一个集合 * @param key 键 * @return 返回右边第一个值 */ public Object lpop(String key) { return redisTemplate.opsForList().leftPop(key); } /** * 移除集合中的右边的元素，一般用在队列取值 * @param key 键 * @return 返回右边的元素 */ public Object rpop(String key) { return redisTemplate.opsForList().leftPop(key); } /** * 获取指定区间的值 * @param key 键 * @param start 开始位置 * @param end 结束位置 * @return 返回值 */ public List\u003cObject\u003e lrange(String key, long start, long end) { return redisTemplate.opsForList().range(key,start,end); } /** * 返回当前位置上的值。 * @param key 键 * @param index 当前位置 * @return */ public Object lindex(String key, long index) { return redisTemplate.opsForList().index(key,index); } /** * * @param key 键 * @param count 统计 * @param object 移除的对象 * @return */ public long remove(String key,long count, Object object){ return redisTemplate.opsForList().remove(key,count,object); } /** * 获取集合长度 * @param key 键 * @return 长度 */ public long llen(String key){ return redisTemplate.opsForList().size(key); } /** * 在集合的指定位置插入元素，如果指定的位置已有元素，则覆盖，没有则新增，超过集合的下标+n则会报错； * @param key 键 * @param index 位置 * @param value 值 */ public void set(String key,Long index, Object value) { } /** * 截取集合元素，保留成都内地数据 * @param key 键 * @param start 开始位置 * @param end 结束位置 */ public void trim(String key,Long start, Long end) { redisTemplate.opsForList().trim(key,start,end); } /** *出去集合右边的值，同时集合的左边添加一个值 * @param key 键 * @param str 入栈的值 * @return 返回对象 */ public Object rightPopAndleftPush(String key,String str) { return redisTemplate.opsForList().rightPopAndLeftPush(key,str); } /** *出去集合右边的值，同时集合的左边添加一个值,如果超过等待的时间仍然没有元素则退出 * @param key 键 * @param str 左边新增的值 * @param time 超时时间 * @return 返回移除右边的值 */ public Object rightPopAndleftPush(String key,String str,long time) { return redisTemplate.opsForList().rightPopAndLeftPush(key,str,time,TimeUnit.MINUTES); } /** * 删除. * @param keys */ public void del(String ... keys){ if (keys!=null || keys.length \u003e 0){ if (keys.length == 1) { redisTemplate.delete(keys[0]); }else { redisTemplate.delete(CollectionUtils.arrayToList(keys)); } } } /** * 设置过期时间。 * @param key 键。 * @param seconds 过期时间。 */ public void expire(String key,long seconds){ redisTemplate.expire(key,seconds,TimeUnit.SECONDS); } } 10.7 List 的应用场景 项目应用于：1、对数据量大的集合数据删除；2、任务队列\n1、对数据量大的集合数据删减\n​\t列表数据显示，关注列表，粉丝列表，留言评论等…..分页，热点新闻等\n利用LRANG还可以很方便的实现分页的功能，在博客系统中，每片博文的评论也可以存入一个单独的list中。\n2、任务队列\n(list 通常用来实现一个消息队列，而且可以却表先后顺序，不必像MySQL那样还需要通过ORDER BY来进行排序)\n任务队列介绍(生产者和消费者模式：) 在处理web客户端发送的命令请求是，某些操作的执行时间可能会比我们预期的更长一些，通过将待执行任务的相关信息放入队列里面，并在之后队列进行处理，用户可以推迟执行那些需要一段时间才能完成的操作，这种将工作交个任务处理器来执行的做法被称为任务队列（task queue）。 RPOPLPUSH source destination 移除列表的最后一个元素，并将该元素添加到另一个列表并返回 3、List应用场景案例1\n10.8 Set类型 简介\n​\tRedis的Set是String类型的无需集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。Redis中集合是通过哈希表实现的，set是通过hashtable实现的\n集合中最大的成员数为2^32 -1,类似于JAVA中的Hashtable集合。\n命令\n1、复制语法： SADD KEY member1 [member2]:向集合添加一个或多个成员 2、取值语法： SCARD KEY :获取集合的成员数 SMEMBERS KEY ：返回集合中的所有成员 SISMEMBER KEY MEMBER :判断member元素是否是集合key的成员(开发中：验证是否存在判断) SRANDMEMBER KEY [COUNT] :返回集合中一个或对个随机数 3、删除语法： SREM key member1 [member2] : 移除集合中一个或多个成员 SPOP key [count] : 移除并返回集合中的一个随机元素 SMOVE source destination member :将member 元素从Source集合移动到destination集合中 4、差集语言： SDIFF key1 [key2] :返回给定所有集合的差集 SDIFFSTORE destination key1 [key2] :返回给定所有集合的茶几并存储在destination中 5、交集语言： SUNION key1 [key2] : 返回所有给定集合的并集 SUNIONSTORE destination key1 [key2] :所有给定集合的并集存储在 destinatiion集合中 10.9 ZSet类型 有序集合(sorted set)\n简介\n1、Redis有序集合和集合一样也是string类型元素的集合，且不允许重复的成员。\n2、不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。\n3、有序集合的成员是唯一的，但分数（score）却可以重复。\n4、集合是通过哈希表实现的。集合中最大的成员数为2^32 -1。Redis的ZSet是有序，且不重复。\n（很多时候，我们都将redis中的有序结合叫做zsets，这是因为在redis中，有序集合相关的操作指令都是以z开头的）\n命令\n1、复制语法： ZADD KEY score1 member1 【score2 member2】 ：向有序集合添加一个或多个成员，或者更新已经存在成员的分数 2、取值语法： ZCARD key ：获取有序结合的成员数 ZCOUNT key min max :计算在有序结合中指定区间分数的成员数 127.0.0.1:6379\u003e ZADD kim 1 tian (integer) 0 127.0.0.1:6379\u003e zadd kim 2 yuan 3 xing (integer) 2 127.0.0.1:6379\u003e zcount kim 1 2 (integer) 2 127.0.0.1:6379\u003e ZRANK key member :返回有序集合中指定成员的所有 ZRANGE KEY START STOP [WITHSCORES]:通过索引区间返回有序集合成指定区间内的成员(低到高) ZRANGEBYSCORE KEY MIN MAX [WITHSCORES] [LIMIT] :通过分数返回有序集合指定区间内的成员 ZREVRANGE KEY START STOP [WITHSCORES] :返回有序集中是定区间内的成员，通过索引，分数从高到底 ZREVERANGEBYSCORE KEY MAX MIN [WITHSCORES] :返回有序集中指定分数区间的成员，分数从高到低排序 删除语法： DEL KEY : 移除集合 ZREM key member [member...] 移除有序集合中的一个或多个成员 ZREMRANGEBYSCORE KEY MIN MAX :移除有序集合中给定的分数区间的所有成员。 ZREMRANGEBYSCORE KEY MIN MAX :移除有序集合中给定的分数区间的所有成员。 ZINCRBY KEY INCREMENT MEMBER :增加member元素的分数increment，返回值是更改后的分数 10.10 HyperLogLog 常用命令\nPFADD key element [element ...] : 添加指定元素到HyperLoglog中 PFCOUNT KEY [key ...] :返回给定 HyperLogLog的基数估算值 PFMERGE destkey sourcekey [sourcekey ...] :将过个HyperLogLog 合并为一个HyperLoglog 应用场景\n基数不大，数据量不大就用不上，会有点大材小用浪费空间\n有局限性，就是指能统计基数数量，而没办法去知道具体的内容是什么\n统计注册 IP 数 统计每日访问 IP 数 统计页面实时 UV 数 统计在线用户数 统计用户每天搜索不同词条的个数 统计真实文章阅读数 10.11 geospatial 地理位置 GEORANDIUSBYMEMBER 找出指定元素周围的其他元素\n十一、SpringBoot整合Jedis 11.1 简介 ​\t我们在使用springboot搭建微服务的时候，在很多时候还是需要redis的高速缓存来缓存一些数据，存储一些高品率访问的数据，如果直接使用redis的话由比较麻烦，在这里，我们使用jedis来实现redis缓存达到高效缓存的目的。\n11.2 引入Jedis依赖 redis.clients jedis 3.2.0 因为SpringBoot内默认引用了jedis版本。\n所以我们直接引入jedis依赖无需配置jedis的版本号了。\n11.3 application.yml 例如 在application.yml中配置如下信息：\n十二、SpringBoot2.x中redis使用（lettuce） java代码操作Redis，需要使用Jedis，也就是redis支持java的第三方类库 注意：Jedis2.7以上的版本才支持集群操作 12.1 maven配置 新建SpringBoot2.0.3的WEB工程，在MAVEN的pom.xml文件中加入如下依赖\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e ",
  "wordCount" : "31352",
  "inLanguage": "en",
  "image":"http://oss.itshare.work/itshare-work-images/28.jpg","datePublished": "2023-02-09T14:59:00Z",
  "dateModified": "2023-02-09T15:59:00Z",
  "author":[{
    "@type": "Person",
    "name": "Cookie"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://hugo.itshare.work/posts/redis/redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Cookie",
    "logo": {
      "@type": "ImageObject",
      "url": "http://hugo.itshare.work/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://hugo.itshare.work/" accesskey="h" title="Cookie (Alt + H)">
            <img src="http://hugo.itshare.work/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">Cookie</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://hugo.itshare.work/search" title="🔍 搜索 (Alt &#43; /)" accesskey=/>
                <span>🔍 搜索</span>
                </a>
            </li>
            <li>
                <a href="http://hugo.itshare.work/" title="🏠 主页">
                <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="http://hugo.itshare.work/posts" title="📚 文章">
                <span>📚 文章</span>
                </a>
            </li>
            <li>
                <a href="http://hugo.itshare.work/archivist" title="📒 归档">
                <span>📒 归档</span>
                </a>
            </li>
            <li>
                <a href="http://hugo.itshare.work/tags" title="🧩 标签">
                <span>🧩 标签</span>
                </a>
            </li>
            <li>
                <a href="http://hugo.itshare.work/archives/" title="⏱️ 时间轴">
                <span>⏱️ 时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://hugo.itshare.work/about" title="🙋🏻‍♂️ 关于">
                <span>🙋🏻‍♂️ 关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="http://hugo.itshare.work/">🏠 主页</a>&nbsp;»&nbsp;<a href="http://hugo.itshare.work/posts/">📚文章</a>&nbsp;»&nbsp;<a href="http://hugo.itshare.work/posts/redis/">🧨 Redis</a></div>
            <h1 class="post-title">
                Redis学习笔记
            </h1>
            <div class="post-description">
                Redis 是完全开源免费的，遵守BSD协议，是一个高性能(NOSQL)的key-value数据库，Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存可持久化的日志型，Key-Value数据库，并提供多种语言的API
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-02-09
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>31352字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>63分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>Cookie
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="http://hugo.itshare.work/tags/redis/" style="color: var(--secondary)!important;">redis</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "http://hugo.itshare.work/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="http://oss.itshare.work/itshare-work-images/28.jpg" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">文章目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#redis%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" aria-label="Redis学习笔记">Redis学习笔记</a><ul>
                        
                <li>
                    <a href="#%e4%b8%80-redis%e7%ae%80%e4%bb%8b" aria-label="一 、Redis简介">一 、Redis简介</a><ul>
                        
                <li>
                    <a href="#11-%e4%bb%80%e4%b9%88%e6%98%afredis" aria-label="1.1 什么是Redis">1.1 什么是Redis</a></li>
                <li>
                    <a href="#12-nosql" aria-label="1.2 NoSQL">1.2 NoSQL</a></li>
                <li>
                    <a href="#13-nosql%e7%9a%84%e7%b1%bb%e5%88%ab" aria-label="1.3 NoSQL的类别">1.3 NoSQL的类别</a></li>
                <li>
                    <a href="#14-%e6%80%bb%e7%bb%93" aria-label="1.4 总结：">1.4 总结：</a></li>
                <li>
                    <a href="#15-redis-%e6%8f%8f%e8%bf%b0" aria-label="1.5 Redis 描述">1.5 Redis 描述</a></li>
                <li>
                    <a href="#16-redis%e7%9a%84%e7%89%b9%e7%82%b9" aria-label="1.6 Redis的特点">1.6 Redis的特点</a></li>
                <li>
                    <a href="#17-redis%e7%9a%84%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="1.7 Redis的应用场景">1.7 Redis的应用场景</a></li>
                <li>
                    <a href="#18--redis%e6%80%bb%e7%bb%93" aria-label="1.8  Redis总结">1.8  Redis总结</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%8credis%e5%ae%89%e8%a3%85" aria-label="二、Redis安装">二、Redis安装</a><ul>
                        
                <li>
                    <a href="#21-redis%e5%ae%98%e7%bd%91" aria-label="2.1 Redis官网">2.1 Redis官网</a></li>
                <li>
                    <a href="#22-redis-%e5%ae%89%e8%a3%85" aria-label="2.2 Redis 安装">2.2 Redis 安装</a></li>
                <li>
                    <a href="#23-%e5%ae%89%e8%a3%85gcc" aria-label="2.3 安装gcc">2.3 安装gcc</a></li>
                <li>
                    <a href="#24-%e5%ae%89%e8%a3%85redis" aria-label="2.4 安装Redis">2.4 安装Redis</a></li>
                <li>
                    <a href="#25-%e5%ae%89%e8%a3%85%e5%88%b0%e6%8c%87%e5%ae%9a%e7%9a%84%e4%bd%8d%e7%bd%ae" aria-label="2.5 安装到指定的位置">2.5 安装到指定的位置</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%89-redis%e5%90%af%e5%8a%a8" aria-label="三 、Redis启动">三 、Redis启动</a><ul>
                        
                <li>
                    <a href="#31-%e5%90%af%e5%8a%a8redis%e6%9c%8d%e5%8a%a1%e7%ab%af%e8%bf%9b%e5%85%a5%e5%88%b0redis%e7%9a%84%e5%ae%89%e8%a3%85%e7%9b%ae%e5%bd%95" aria-label="3.1 启动Redis服务端，进入到Redis的安装目录">3.1 启动Redis服务端，进入到Redis的安装目录</a></li>
                <li>
                    <a href="#32-%e6%89%a7%e8%a1%8c%e5%91%bd%e4%bb%a4" aria-label="3.2 执行命令">3.2 执行命令</a></li>
                <li>
                    <a href="#33-redis%e7%9a%84%e5%ae%a2%e6%88%b7%e7%ab%af%e8%bf%9b%e8%a1%8c%e5%90%af%e5%8a%a8" aria-label="3.3 Redis的客户端进行启动">3.3 Redis的客户端进行启动</a></li>
                <li>
                    <a href="#34-%e5%90%af%e5%8a%a8redis%e5%ae%a2%e6%88%b7%e7%ab%af%e5%91%bd%e4%bb%a4%e8%af%ad%e6%b3%95" aria-label="3.4 启动Redis客户端命令语法：">3.4 启动Redis客户端命令语法：</a></li>
                <li>
                    <a href="#35-%e6%a3%80%e6%b5%8b%e6%98%af%e5%90%a6%e6%9c%8d%e5%8a%a1%e7%ab%af%e5%90%af%e5%8a%a8" aria-label="3.5 检测是否服务端启动">3.5 检测是否服务端启动</a></li>
                <li>
                    <a href="#36-%e6%a3%80%e6%9f%a5redis%e7%9a%84%e8%bf%9b%e7%a8%8b" aria-label="3.6 检查redis的进程">3.6 检查redis的进程</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%9bredis%e9%85%8d%e7%bd%ae%e8%af%a6%e7%bb%86" aria-label="四、Redis配置详细">四、Redis配置详细</a><ul>
                        
                <li>
                    <a href="#41-%e9%85%8d%e7%bd%aeredis" aria-label="4.1 配置Redis">4.1 配置Redis</a></li>
                <li>
                    <a href="#42-redisconf" aria-label="4.2 Redis.conf">4.2 Redis.conf</a></li>
                <li>
                    <a href="#42%e5%86%85%e5%ad%98%e4%b8%ad%e7%9a%84%e7%bb%b4%e6%8a%a4%e7%ad%96%e7%95%a5" aria-label="4.2、内存中的维护策略">4.2、内存中的维护策略</a><ul>
                        
                <li>
                    <a href="#421-%e5%9c%a8redis%e4%b8%ad%e6%9c%89%e4%b8%a4%e7%a7%8d%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88" aria-label="4.2.1 在redis中有两种解决方案">4.2.1 在redis中有两种解决方案</a></li>
                <li>
                    <a href="#422-%e8%87%aa%e5%ae%9a%e4%b9%89%e9%85%8d%e7%bd%aeredis" aria-label="4.2.2 自定义配置redis">4.2.2 自定义配置redis</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%94-redis%e5%90%af%e5%8a%a8" aria-label="五 、Redis启动">五 、Redis启动</a><ul>
                        
                <li>
                    <a href="#51-redis%e4%bb%a5%e5%ae%88%e6%8a%a4%e8%bf%9b%e7%a8%8b%e6%9c%8d%e5%8a%a1%e7%ab%af%e8%bf%9b%e8%a1%8c%e5%90%af%e5%8a%a8" aria-label="5.1 Redis以守护进程服务端进行启动">5.1 Redis以守护进程服务端进行启动</a></li>
                <li>
                    <a href="#52-redis%e5%ae%a2%e6%88%b7%e7%ab%af%e8%bf%9b%e8%a1%8c%e5%90%af%e5%8a%a8" aria-label="5.2 Redis客户端进行启动：">5.2 Redis客户端进行启动：</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%adredis%e5%85%b3%e9%97%ad" aria-label="六、Redis关闭">六、Redis关闭</a><ul>
                        
                <li>
                    <a href="#61%e7%ac%ac%e4%b8%80%e7%a7%8d%e5%85%b3%e9%97%ad%e6%96%b9%e5%bc%8f" aria-label="6.1、第一种关闭方式：">6.1、第一种关闭方式：</a></li>
                <li>
                    <a href="#62%e7%ac%ac%e4%ba%8c%e7%a7%8d%e5%85%b3%e9%97%ad%e6%96%b9%e5%bc%8f" aria-label="6.2、第二种关闭方式">6.2、第二种关闭方式</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%83%e8%bf%9c%e7%a8%8b%e8%bf%9e%e6%8e%a5" aria-label="七、远程连接">七、远程连接</a><ul>
                        
                <li>
                    <a href="#71-redis%e8%bf%9c%e7%a8%8b%e8%bf%9e%e6%8e%a5%e6%af%94%e8%be%83%e6%b5%81%e8%a1%8c%e7%9a%84%e8%bd%af%e4%bb%b6redisdesktomanager" aria-label="7.1 Redis远程连接比较流行的软件：RedisDesktoManager">7.1 Redis远程连接比较流行的软件：RedisDesktoManager</a></li>
                <li>
                    <a href="#72-redis%e4%bd%bf%e7%94%a8%e5%af%86%e7%a0%81%e7%99%bb%e5%bd%95" aria-label="7.2 Redis使用密码登录">7.2 Redis使用密码登录</a></li></ul>
                </li>
                <li>
                    <a href="#centos-%e9%98%b2%e7%81%ab%e5%a2%99%e7%ab%af%e5%8f%a3" aria-label="Centos 防火墙端口">Centos 防火墙端口</a></li>
                <li>
                    <a href="#%e5%85%ab-docker%e5%ae%89%e8%a3%85redis" aria-label="八 、Docker安装Redis">八 、Docker安装Redis</a><ul>
                        
                <li>
                    <a href="#81-%e6%90%9c%e7%b4%a2redis" aria-label="8.1 搜索redis">8.1 搜索redis</a></li>
                <li>
                    <a href="#82-%e4%b8%8b%e8%bd%bd%e9%95%9c%e5%83%8f" aria-label="8.2 下载镜像">8.2 下载镜像</a></li>
                <li>
                    <a href="#83-%e5%88%9b%e5%bb%ba%e5%b9%b6%e8%bf%90%e8%a1%8c%e5%ae%b9%e5%99%a8" aria-label="8.3 创建并运行容器">8.3 创建并运行容器</a></li>
                <li>
                    <a href="#84-%e6%b5%8b%e8%af%95%e8%bf%9b%e5%85%a5redis%e8%bf%9b%e5%85%a5%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="8.4 测试进入Redis进入客户端">8.4 测试进入Redis进入客户端</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b9%9dredis%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4" aria-label="九、Redis常用命令">九、Redis常用命令</a><ul>
                        
                <li>
                    <a href="#91-%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4key%e7%ae%a1%e7%90%86" aria-label="9.1 常用命令key管理">9.1 常用命令key管理</a></li>
                <li>
                    <a href="#92-del-key" aria-label="9.2 DEL key">9.2 DEL key</a></li>
                <li>
                    <a href="#93-exists-key" aria-label="9.3 EXISTS key">9.3 EXISTS key</a></li>
                <li>
                    <a href="#94-expire-key-seconds" aria-label="9.4 EXPIRE key seconds">9.4 EXPIRE key seconds</a></li>
                <li>
                    <a href="#95-pexpire-key-milliseconds" aria-label="9.5 PEXPIRE key milliseconds">9.5 PEXPIRE key milliseconds</a></li>
                <li>
                    <a href="#96-ttl-key" aria-label="9.6 TTL key">9.6 TTL key</a></li>
                <li>
                    <a href="#97-pttl-key" aria-label="9.7 PTTL key">9.7 PTTL key</a></li>
                <li>
                    <a href="#98-keys-pattern" aria-label="9.8 KEYS pattern">9.8 KEYS pattern</a></li>
                <li>
                    <a href="#99-rename-key-newkey" aria-label="9.9 RENAME key newkey">9.9 RENAME key newkey</a></li>
                <li>
                    <a href="#910-move-key-db" aria-label="9.10 MOVE key db">9.10 MOVE key db</a></li>
                <li>
                    <a href="#911-type-key" aria-label="9.11 TYPE key">9.11 TYPE key</a></li>
                <li>
                    <a href="#912-%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="9.12 应用场景">9.12 应用场景</a></li>
                <li>
                    <a href="#913-key%e7%9a%84%e5%91%bd%e5%90%8d%e5%bb%ba%e8%ae%ae" aria-label="9.13 key的命名建议">9.13 key的命名建议</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81-redis%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" aria-label="十 、Redis数据类型">十 、Redis数据类型</a><ul>
                        
                <li>
                    <a href="#101-string-%e7%b1%bb%e5%9e%8b" aria-label="10.1 String 类型">10.1 String 类型</a></li>
                <li>
                    <a href="#string%e5%91%bd%e4%bb%a4" aria-label="String命令">String命令</a></li>
                <li>
                    <a href="#102-%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="10.2 应用场景">10.2 应用场景</a></li>
                <li>
                    <a href="#103-hash%e7%b1%bb%e5%9e%8b" aria-label="10.3 Hash类型">10.3 Hash类型</a></li>
                <li>
                    <a href="#104-hash%e5%91%bd%e4%bb%a4" aria-label="10.4 Hash命令">10.4 Hash命令</a></li>
                <li>
                    <a href="#105-%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="10.5 应用场景">10.5 应用场景</a></li>
                <li>
                    <a href="#106-%e6%80%bb%e7%bb%93" aria-label="10.6 总结：">10.6 总结：</a></li>
                <li>
                    <a href="#106-list%e7%b1%bb%e5%9e%8b" aria-label="10.6 List类型">10.6 List类型</a></li>
                <li>
                    <a href="#107-list-%e7%9a%84%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="10.7 List 的应用场景">10.7 List 的应用场景</a></li>
                <li>
                    <a href="#108-set%e7%b1%bb%e5%9e%8b" aria-label="10.8 Set类型">10.8 Set类型</a></li>
                <li>
                    <a href="#109-zset%e7%b1%bb%e5%9e%8b" aria-label="10.9 ZSet类型">10.9 ZSet类型</a></li>
                <li>
                    <a href="#1010-hyperloglog" aria-label="10.10 HyperLogLog">10.10 HyperLogLog</a></li>
                <li>
                    <a href="#1011-geospatial-%e5%9c%b0%e7%90%86%e4%bd%8d%e7%bd%ae" aria-label="10.11 geospatial 地理位置">10.11 geospatial 地理位置</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e4%b8%80springboot%e6%95%b4%e5%90%88jedis" aria-label="十一、SpringBoot整合Jedis">十一、SpringBoot整合Jedis</a><ul>
                        
                <li>
                    <a href="#111-%e7%ae%80%e4%bb%8b" aria-label="11.1 简介">11.1 简介</a></li>
                <li>
                    <a href="#112-%e5%bc%95%e5%85%a5jedis%e4%be%9d%e8%b5%96" aria-label="11.2 引入Jedis依赖">11.2 引入Jedis依赖</a></li>
                <li>
                    <a href="#113-applicationyml" aria-label="11.3 application.yml">11.3 application.yml</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e4%ba%8cspringboot2x%e4%b8%adredis%e4%bd%bf%e7%94%a8lettuce" aria-label="十二、SpringBoot2.x中redis使用（lettuce）">十二、SpringBoot2.x中redis使用（lettuce）</a><ul>
                        
                <li>
                    <a href="#121-maven%e9%85%8d%e7%bd%ae" aria-label="12.1 maven配置">12.1 maven配置</a></li>
                <li>
                    <a href="#122-%e8%a7%86%e9%a2%91%e4%b8%ad%e7%9a%84%e4%bb%a3%e7%a0%81" aria-label="12.2 视频中的代码">12.2 视频中的代码</a></li>
                <li>
                    <a href="#123-%e6%9f%a5%e7%9c%8bredis%e5%ae%a2%e6%88%b7%e7%ab%af%e4%bf%a1%e6%81%af" aria-label="12.3 查看Redis客户端信息">12.3 查看Redis客户端信息</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e4%b8%89redis%e7%9a%84%e5%8f%91%e5%b8%83%e8%ae%a2%e9%98%85" aria-label="十三、Redis的发布订阅">十三、Redis的发布订阅</a><ul>
                        
                <li>
                    <a href="#131-redis%e5%8f%91%e5%b8%83%e8%ae%a2%e9%98%85%e7%ae%80%e4%bb%8b" aria-label="13.1 redis发布订阅简介">13.1 redis发布订阅简介</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e5%9b%9bredis%e5%a4%9a%e6%95%b0%e6%8d%ae%e5%ba%93" aria-label="十四、Redis多数据库">十四、Redis多数据库</a><ul>
                        
                <li>
                    <a href="#141-redis%e4%b8%8b%e6%95%b0%e6%8d%ae%e5%ba%93%e6%98%af%e7%94%b1%e4%b8%80%e4%b8%aa%e6%95%b4%e6%95%b0%e7%b4%a2%e5%bc%95%e6%a0%87%e8%af%86%e8%80%8c%e4%b8%8d%e6%98%af%e4%b8%80%e4%b8%aa%e6%95%b0%e6%8d%ae%e5%ba%93%e5%90%8d%e7%a7%b0%e9%bb%98%e8%ae%a4%e6%83%85%e5%86%b5%e4%b8%8b%e4%b8%80%e4%b8%aa%e5%ae%a2%e6%88%b7%e7%ab%af%e8%bf%9e%e6%8e%a5%e5%88%b0%e6%95%b0%e6%8d%ae%e5%ba%930" aria-label="14.1 Redis下，数据库是由一个整数索引标识，而不是一个数据库名称。默认情况下，一个客户端连接到数据库0。">14.1 Redis下，数据库是由一个整数索引标识，而不是一个数据库名称。默认情况下，一个客户端连接到<strong>数据库0</strong>。</a></li>
                <li>
                    <a href="#142-%e6%95%b0%e6%8d%ae%e5%ba%93%e6%b8%85%e7%a9%ba" aria-label="14.2 数据库清空：">14.2 数据库清空：</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e4%ba%94redis%e4%ba%8b%e5%8a%a1" aria-label="十五、Redis事务">十五、Redis事务</a><ul>
                        
                <li>
                    <a href="#151%e7%a4%ba%e4%be%8b-1-multi-exec" aria-label="15.1示例 1 MULTI EXEC">15.1示例 1 MULTI EXEC</a></li>
                <li>
                    <a href="#152-%e7%a4%ba%e4%be%8b-discard%e6%94%be%e5%bc%83%e9%98%9f%e5%88%97%e8%bf%90%e8%a1%8c" aria-label="15.2 示例 DISCARD放弃队列运行">15.2 示例 DISCARD放弃队列运行</a></li></ul>
                </li>
                <li>
                    <a href="#153-%e7%a4%ba%e4%be%8b3%e4%ba%8b%e5%8a%a1%e7%9a%84%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" aria-label="15.3 示例3事务的错误处理">15.3 示例3事务的错误处理</a><ul>
                        
                <li>
                    <a href="#154--%e7%a4%ba%e4%be%8b4-%e4%ba%8b%e5%8a%a1%e7%9a%84%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" aria-label="15.4  示例4 事务的错误处理">15.4  示例4 事务的错误处理</a></li>
                <li>
                    <a href="#155-%e7%a4%ba%e4%be%8b5-%e4%ba%8b%e5%8a%a1%e7%9a%84watch" aria-label="15.5 示例5 事务的watch">15.5 示例5 事务的watch</a></li>
                <li>
                    <a href="#156-%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="15.6 应用场景">15.6 应用场景</a></li>
                <li>
                    <a href="#157-redis%e4%ba%8b%e5%8a%a1%e7%9a%84%e6%80%bb%e7%bb%93" aria-label="15.7 Redis事务的总结">15.7 Redis事务的总结</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e5%85%adredis%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="十六、Redis持久化">十六、Redis持久化</a><ul>
                        
                <li>
                    <a href="#161-%e4%bb%80%e4%b9%88%e6%98%afredis-%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="16.1 什么是Redis 持久化？">16.1 什么是Redis 持久化？</a></li>
                <li>
                    <a href="#162-rdb" aria-label="16.2 RDB">16.2 RDB</a></li>
                <li>
                    <a href="#163-aof" aria-label="16.3 AOF">16.3 AOF</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e4%b8%83redis%e7%bc%93%e5%ad%98%e4%b8%8e%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%80%e8%87%b4%e6%80%a7" aria-label="十七、Redis缓存与数据库一致性">十七、Redis缓存与数据库一致性</a><ul>
                        
                <li>
                    <a href="#171-%e5%ae%9e%e6%97%b6%e5%90%8c%e6%ad%a5" aria-label="17.1 实时同步">17.1 实时同步</a></li>
                <li>
                    <a href="#172-%e5%bc%82%e6%ad%a5%e9%98%9f%e5%88%97" aria-label="17.2 异步队列">17.2 异步队列</a></li>
                <li>
                    <a href="#173-%e4%bd%bf%e7%94%a8%e9%98%bf%e9%87%8c%e7%9a%84%e5%90%8c%e6%ad%a5%e5%b7%a5%e5%85%b7canal" aria-label="17.3 使用阿里的同步工具canal">17.3 使用阿里的同步工具canal</a></li>
                <li>
                    <a href="#174-%e9%87%87%e7%94%a8udf%e8%87%aa%e5%ae%9a%e4%b9%89%e5%87%bd%e6%95%b0%e7%9a%84%e6%96%b9%e5%bc%8f" aria-label="17.4 采用UDF自定义函数的方式">17.4 采用UDF自定义函数的方式</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e5%85%ab%e6%80%bb%e7%bb%93" aria-label="十八、总结">十八、总结</a><ul>
                        
                <li>
                    <a href="#181-%e7%bc%93%e5%ad%98%e7%a9%bf%e9%80%8f" aria-label="18.1 缓存穿透">18.1 缓存穿透</a><ul>
                        
                <li>
                    <a href="#1811-%e5%b8%83%e9%9a%86%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="18.1.1 布隆过滤器">18.1.1 布隆过滤器</a></li></ul>
                </li>
                <li>
                    <a href="#1812-%e7%bc%93%e5%ad%98%e5%87%bb%e7%a9%bf" aria-label="18.1.2 缓存击穿">18.1.2 缓存击穿</a></li>
                <li>
                    <a href="#182-%e9%9b%aa%e5%b4%a9" aria-label="18.2 雪崩">18.2 雪崩</a></li>
                <li>
                    <a href="#183-%e7%83%ad%e7%82%b9key" aria-label="18.3 热点key">18.3 热点key</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8d%81%e4%b9%9d%e5%8f%af%e8%83%bd%e7%9a%84%e9%97%ae%e9%a2%98" aria-label="十九、可能的问题">十九、可能的问题</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%8d%81%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6" aria-label="二十、主从复制">二十、主从复制</a><ul>
                        
                <li>
                    <a href="#201%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6" aria-label="20.1主从复制：">20.1主从复制：</a></li>
                <li>
                    <a href="#202-redis%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e9%85%8d%e7%bd%ae" aria-label="20.2 Redis主从复制配置">20.2 Redis主从复制配置</a></li>
                <li>
                    <a href="#203-%e5%9f%ba%e6%9c%ac%e6%a6%82%e8%bf%b0" aria-label="20.3 基本概述">20.3 基本概述</a></li>
                <li>
                    <a href="#204-%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e7%9a%84%e4%b8%bb%e8%a6%81%e4%bd%9c%e7%94%a8%e5%8c%85%e6%8b%ac" aria-label="20.4 主从复制的主要作用包括">20.4 主从复制的主要作用包括</a></li>
                <li>
                    <a href="#205-%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e7%9a%84%e5%8e%9f%e7%90%86" aria-label="20.5 主从复制的原理">20.5 主从复制的原理</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%8c%e5%8d%81%e4%b8%80redis-cluster%e9%9b%86%e7%be%a4" aria-label="二十一、Redis Cluster集群">二十一、Redis Cluster集群</a><ul>
                        
                <li>
                    <a href="#211-%e9%9b%86%e7%be%a4%e6%a8%a1%e5%bc%8f%e6%98%af%e5%ae%9e%e9%99%85%e4%bd%bf%e7%94%a8%e6%9c%80%e5%a4%9a%e7%9a%84%e6%a8%a1%e5%bc%8f" aria-label="21.1 集群模式是实际使用最多的模式。">21.1 集群模式是实际使用最多的模式。</a></li>
                <li>
                    <a href="#212-%e9%9b%86%e7%be%a4%e6%8f%8f%e8%bf%b0" aria-label="21.2 集群描述">21.2 集群描述</a></li>
                <li>
                    <a href="#213-redis-cluster%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label="21.3 Redis Cluster集群搭建">21.3 Redis Cluster集群搭建</a></li>
                <li>
                    <a href="#214-redis%e6%80%bb%e7%bb%93" aria-label="21.4 Redis总结">21.4 Redis总结</a></li>
                <li>
                    <a href="#215-%e5%85%b3%e9%97%ad%e9%9b%86%e7%be%a4" aria-label="21.5 关闭集群">21.5 关闭集群</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%8c%e5%8d%81%e4%ba%8credis%e4%b8%ad%e7%9a%84%e6%8b%93%e5%b1%95" aria-label="二十二、Redis中的拓展">二十二、Redis中的拓展</a><ul>
                        
                <li>
                    <a href="#221-redis%e4%b8%ba%e4%bb%80%e4%b9%88%e5%8d%95%e7%ba%bf%e7%a8%8b%e8%bf%98%e8%bf%99%e4%b9%88%e5%bf%ab" aria-label="22.1 Redis为什么单线程还这么快">22.1 Redis为什么单线程还这么快</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%8c%e5%8d%81%e4%b8%89%e9%87%8d%e6%96%b0%e9%85%8d%e7%bd%aeredistemplate" aria-label="二十三、重新配置RedisTemplate">二十三、重新配置RedisTemplate</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%8d%81%e5%9b%9b%e9%87%8d%e6%96%b0%e7%bc%96%e5%86%99redisutils" aria-label="二十四、重新编写RedisUtils">二十四、重新编写RedisUtils</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%8d%81%e4%ba%94%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f" aria-label="二十五、哨兵模式">二十五、哨兵模式</a><ul>
                        
                <li>
                    <a href="#251-%e8%87%aa%e5%8a%a8%e9%80%89%e4%b8%bemaster%e7%9a%84%e6%a8%a1%e5%bc%8f" aria-label="25.1 自动选举master的模式">25.1 自动选举master的模式</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h3 id="redis学习笔记">Redis学习笔记<a hidden class="anchor" aria-hidden="true" href="#redis学习笔记">#</a></h3>
<h4 id="一-redis简介">一 、Redis简介<a hidden class="anchor" aria-hidden="true" href="#一-redis简介">#</a></h4>
<h5 id="11-什么是redis">1.1 什么是Redis<a hidden class="anchor" aria-hidden="true" href="#11-什么是redis">#</a></h5>
<p>Redis 是完全开源免费的，遵守<strong>BSD</strong>协议，是一个高性能(<strong>NOSQL</strong>)的key-value<strong>数据库</strong>*，Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存可持久化的日志型，Key-Value数据库，并提供多种语言的API。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>BSD是&#34;Berkeley Software Distribution&#34;的缩写，意思是“伯克利软件发型版本”。
</span></span><span style="display:flex;"><span>BSD开源协议是一个给予使用者很大自由的协议。可以自由的使用，修改源代码，也可以将修改后的代码作为开源或者专有软件在发布。BSD代码鼓励代码共享，但需要尊重代码作者的著作权。
</span></span><span style="display:flex;"><span>BSD由于允许使用者修改和重新发布代码，也允许使用或在BSD代码上开发商业软件发布和销售，一次是对商业集成很友好的协议。
</span></span></code></pre></div><h5 id="12-nosql">1.2 NoSQL<a hidden class="anchor" aria-hidden="true" href="#12-nosql">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>NoSQL,泛指非关系型的数据库，NoSQL即Not-only SQL,它可以作为关系型数据库的良好补充。随着互谅网web2.0网站的兴起，非关系型的数据库现在成为了一个及其热门的新领域，非关系型数据库产品的发展非常迅速。
</span></span></code></pre></div><p>传统数据库暴露很多难以克服的问题，如下问题：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>1、High performance - 对数据库高并发读写的需求。
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2、Huge Storage - 对海量数据的高效存储和访问的需求。
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>3、High Scalability <span style="color:#960050;background-color:#1e0010">&amp;&amp;</span> High Availability - 对数据库的高可扩展性和高课用性的需求。
</span></span></code></pre></div><h5 id="13-nosql的类别">1.3 NoSQL的类别<a hidden class="anchor" aria-hidden="true" href="#13-nosql的类别">#</a></h5>
<p><strong>键值（Key-Value）存储数据库</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>  这一类数据库主要会使用到一个哈希表，这个表中有一个特定的键和一个指针指向特定的数据。
</span></span><span style="display:flex;"><span>key/value模型对于IT系统涞水的优势在于简单，已部署。但是如果DBA只对部分值进行查询或者更新的时候，key/value显示的效率低下。
</span></span><span style="display:flex;"><span>相关产品 ： Redis，Tokyo Cabinet
</span></span><span style="display:flex;"><span>典型应用 ： 内存缓存，主要用于处理大量数据的高访问负载。
</span></span><span style="display:flex;"><span>数据模型 ： 一系列键值对
</span></span><span style="display:flex;"><span>优势 ： 快速查询
</span></span><span style="display:flex;"><span>劣势 ： 存储的数据缺少结构化
</span></span></code></pre></div><p><strong>列存储数据库</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>这部分数据库通常是用来对分布式存储的海量数据。键仍然存在，但是他们的特点是指向了多个列。这些列是由列家族来安排的。
</span></span><span style="display:flex;"><span>相关产品 : HBase 、Riak
</span></span><span style="display:flex;"><span>典型应用 ： 分布式的文件系统
</span></span><span style="display:flex;"><span>数据模型 ： 以列簇式存储，将同一列数据存在一起
</span></span><span style="display:flex;"><span>优势 ： 查找速度快，可扩展性强，更容易进行分布式扩展
</span></span><span style="display:flex;"><span>劣势 ： 功能相对于局限
</span></span></code></pre></div><p><strong>文档型数据库</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>文档型数据库：该类型的数据库模型是版本化的文档，半结构化的文档一特定的格式存储，比如JSON。文档数据库可以看做键值数据库的升级版，允许之间嵌套键值。而且文档型数据库比键值数据库的查询效率更高。
</span></span><span style="display:flex;"><span>相关产品：MOngoDB
</span></span><span style="display:flex;"><span>典型应用 ： web应用
</span></span><span style="display:flex;"><span>数据模型 ： 一系列键值对
</span></span><span style="display:flex;"><span>优势 ： 数据结构要求不严格
</span></span><span style="display:flex;"><span>劣势 ： 查询性能不高，而且缺乏统一的查询语言
</span></span></code></pre></div><h5 id="14-总结">1.4 总结：<a hidden class="anchor" aria-hidden="true" href="#14-总结">#</a></h5>
<p>NoSQL 数据库在一下的这几种情况下比较适用 ：</p>
<p>1、数据模型比较简单；</p>
<p>2、需要灵活更前的IT系统；</p>
<p>3、对数据库性能要求较高；</p>
<p>4、不需要高度的数据一致性；</p>
<p>5、对于给定key，比较容易映射复杂的环境；</p>
<h5 id="15-redis-描述">1.5 Redis 描述<a hidden class="anchor" aria-hidden="true" href="#15-redis-描述">#</a></h5>
<p>​	Redis是完全开源免费的，遵守BSD协议，是一个高性能(NoSQL)的（key-value）数据库，Redis是一个开源的使用ANSI C语言编写，支持网络，可基于内存亦可持久化的日志型，Key-Value数据库，并提供多种语言的API。</p>
<h5 id="16-redis的特点">1.6 Redis的特点<a hidden class="anchor" aria-hidden="true" href="#16-redis的特点">#</a></h5>
<ul>
<li><strong>性能极高</strong> - Redis读写的熟读110000次/s，写的速度是81000次/s。</li>
<li><strong>丰富的数据类型</strong> - Redis支持的类型String， Hash 、List 、Set 及 Ordered Set数据类型操作。</li>
<li><strong>原子性</strong>  - Redis的所有操作都是原子性的，意思就是要么成功，要么失败。单个操作时原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</li>
<li><strong>丰富的特性</strong> - Redis还支持publis/subscribe，通知，key过期等等特性。</li>
<li><strong>高速读写</strong> ，redis使用自己实现的分离器，代码量很短，没有使用lock(MySQL),因此效率非常高。</li>
</ul>
<p>Redis是一个简单的，高效的，分布式的，基于内存的缓存工具。</p>
<p>架设好服务器后，通过网络连接(类似数据库)，提供Key-Value缓存服务。</p>
<p>简单，是Redis突出的特色。</p>
<p>简单可以保证核心功能的稳定和优异。</p>
<h5 id="17-redis的应用场景">1.7 Redis的应用场景<a hidden class="anchor" aria-hidden="true" href="#17-redis的应用场景">#</a></h5>
<p><strong>可以作为数据库，缓存，热点数据(经常别查询，但是不经常被修改或者删除的数据)和消息中间件等大部分功能。</strong></p>
<p>Redis常用的场景示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>1、缓存
</span></span><span style="display:flex;"><span>   缓存现在几乎是所有大中型网站都在用的必杀技，合理利用缓存提升网站的访问速度，还能大大降低数据库的访问压力。Redis提供了键过期功能，也提供了灵活的键淘汰策略，所以，现在Redis用在缓存的场合非常多。
</span></span><span style="display:flex;"><span>2、排行榜
</span></span><span style="display:flex;"><span>   Redis提供的有序集合数据类结构能够实现葛洪复杂的排行榜应用。
</span></span><span style="display:flex;"><span>3、计数器
</span></span><span style="display:flex;"><span>   什么是计数器，，视频网站的播放量等等，每次浏览+1，并发量高时如果每次都请求数据库操作无疑是中挑战和压力。Redis提供的incr命令来实现计数器功能，内存操作，性能非常好，非常是用于这些技术场景。
</span></span><span style="display:flex;"><span>4、分布式会话
</span></span><span style="display:flex;"><span>   集群模式下，在应用不多的情况下一般使用容日自带的session复制功能就能够满足，当应用相对复杂的系统中，一般都会搭建Redis等内存数据库为中心的session服务，session不在由容器管理，而是有session服务及内存数据管理。
</span></span><span style="display:flex;"><span>5、分布式锁
</span></span><span style="display:flex;"><span>   在很多互联网公司中都是用来分布式技术，分布式技术带来的技术挑战是对同一个资源的并发访问，如全局ID，减库存，秒杀等场景，并发量不发的场景可以使用数据库的悲观锁，乐观锁来实现，但是在并发高的场合中，利用数据库锁来控制资源的并发访问是不太理想的，大大影响了数据库的性能。可以利用Redis的setnx功能来编写分布式的锁，如果设置返回1，说明获取所成功，否则获取锁失败，实际应用中药考虑的细节要更多。
</span></span><span style="display:flex;"><span>6、社交网络
</span></span><span style="display:flex;"><span>   点赞、踩、关注/被关注，共同好友等是社交网站的基本功能，社交网站的访问量通常老说比较大，而且传统的关系数据库不适合这种类型的数据，Redis提供的哈希，集合等数据结构能很方便的实现这些功能。
</span></span><span style="display:flex;"><span>7、最新列表
</span></span><span style="display:flex;"><span>   Redis列表结构，LPUSH可以在列表头部插入一个内容ID作为关键字，LTRIM可以用来限制列表的数量，这样列表永远为N个ID。无需查询最新的列表，直接根据ID 去到对应的内容也即可。
</span></span><span style="display:flex;"><span>8、消息系统
</span></span><span style="display:flex;"><span>   消息对队列是网站比用中间件，如ActiveMQ，RabbitMQ，Kafaka等流行的消息队列中间件，主要用于业务解耦，流量削峰及异步处理试试性低的业务。Redis提供了发布/订阅及阻塞队列功能，能实现一个简单的消息队列系统。另外，这个不能喝专业的消息中间件相比。
</span></span></code></pre></div><h5 id="18--redis总结">1.8  Redis总结<a hidden class="anchor" aria-hidden="true" href="#18--redis总结">#</a></h5>
<p><strong>优势</strong></p>
<ul>
<li><strong>性能极高</strong> - Redis读写的熟读110000次/s，写的速度是81000次/s。</li>
<li><strong>丰富的数据类型</strong> - Redis支持的类型String， Hash 、List 、Set 及 Ordered Set数据类型操作。</li>
<li><strong>原子性</strong>  - Redis的所有操作都是原子性的，意思就是要么成功，要么失败。单个操作时原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</li>
<li><strong>丰富的特性</strong> - Redis还支持publis/subscribe，通知，key过期等等特性。</li>
<li><strong>高速读写</strong> ，redis使用自己实现的分离器，代码量很短，没有使用lock(MySQL),因此效率非常高。</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li><strong>持久化</strong>。 Redis直接将数据存储到内存中，要将数据保存到磁盘上，Redis可以使用两种方式实现持久化过程。定时快照(snapshot)：每个一端时间将整个数据库写到磁盘上，每次均是写全部数据，代价非常高。第二种方式基于语句追加（aof）：只追踪变化的数据，但是追加的log可能过大，同时所有的操作均重新执行一遍，<strong>回复速度慢</strong>。</li>
<li><strong>耗内存</strong>  、占用内存过高。</li>
</ul>
<h4 id="二redis安装">二、Redis安装<a hidden class="anchor" aria-hidden="true" href="#二redis安装">#</a></h4>
<h5 id="21-redis官网">2.1 Redis官网<a hidden class="anchor" aria-hidden="true" href="#21-redis官网">#</a></h5>
<p>官方网站 ： <a href="https://redis.io/">https://redis.io/</a></p>
<p>官方下载 ： <a href="https://redis.io/download">https://redis.io/download</a> 可以根据需要下载不同版本</p>
<h5 id="22-redis-安装">2.2 Redis 安装<a hidden class="anchor" aria-hidden="true" href="#22-redis-安装">#</a></h5>
<p>Redis是C语言开发，安装Redis需要先将官网下载的源码进行编译。编译依赖gcc环境，如果没有gcc环境，需要安装gcc</p>
<h5 id="23-安装gcc">2.3 安装gcc<a hidden class="anchor" aria-hidden="true" href="#23-安装gcc">#</a></h5>
<p>gcc的安装很简单，首先要确保root登录，其次就是Linux要能连外网</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>yum -y install gcc automake autoconf libtool make
</span></span></code></pre></div><p><strong>注意：</strong> 运行yum是出现/var/run/yum.pid已被锁定，PID为xxxx的另外一个程序正在运行的问题解决。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>rm -f /var/run/yum.pid
</span></span></code></pre></div><h5 id="24-安装redis">2.4 安装Redis<a hidden class="anchor" aria-hidden="true" href="#24-安装redis">#</a></h5>
<p><strong>下载redis二进制安装包</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>wget http://download.redis.io/release/redis-6.0.5.tar.gz
</span></span></code></pre></div><p><strong>解压/apps目录下</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>tar zxvf redis-6.0.5.tar.gz -C /apps
</span></span><span style="display:flex;"><span>#Linux 中剪切命令
</span></span><span style="display:flex;"><span>mv redis-6.0.5.tar.gz 安装包
</span></span><span style="display:flex;"><span>#Linux中复制命令: cp Files path
</span></span><span style="display:flex;"><span>cp redis-6.0.5.tar.gz /root/apps
</span></span></code></pre></div><p>进入redis中使用make命令进行编译</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>[root@centos redis-5.0.8]# make MALLOC=libc
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>    LINK redis-cli
</span></span><span style="display:flex;"><span>    CC redis-benchmark.o
</span></span><span style="display:flex;"><span>    LINK redis-benchmark
</span></span><span style="display:flex;"><span>    INSTALL redis-check-rdb
</span></span><span style="display:flex;"><span>    INSTALL redis-check-aof
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Hint: It&#39;s a good idea to run &#39;make test&#39; ;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>make[1]: 离开目录“/root/apps/redis-5.0.8/src”
</span></span><span style="display:flex;"><span>[root@centos redis-5.0.8]# ll
</span></span></code></pre></div><p><strong>安装成功如上</strong></p>
<h5 id="25-安装到指定的位置">2.5 安装到指定的位置<a hidden class="anchor" aria-hidden="true" href="#25-安装到指定的位置">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>make PREFIX=/root/apps/redis install
</span></span></code></pre></div><p>（安装编译后的文件）安装到指定目录；</p>
<p>注意：PREFIX必须为大写，同时会自动为我们创建redis目录，并将结果安装此目录；</p>
<h4 id="三-redis启动">三 、Redis启动<a hidden class="anchor" aria-hidden="true" href="#三-redis启动">#</a></h4>
<h5 id="31-启动redis服务端进入到redis的安装目录">3.1 启动Redis服务端，进入到Redis的安装目录<a hidden class="anchor" aria-hidden="true" href="#31-启动redis服务端进入到redis的安装目录">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>cd /usr/local/redis
</span></span></code></pre></div><h5 id="32-执行命令">3.2 执行命令<a hidden class="anchor" aria-hidden="true" href="#32-执行命令">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>./bin/redis-server
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200701230641144.png" alt="image-20200701230641144"  />
</p>
<h5 id="33-redis的客户端进行启动">3.3 Redis的客户端进行启动<a hidden class="anchor" aria-hidden="true" href="#33-redis的客户端进行启动">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">./</span>bin<span style="color:#f92672">/</span>redis<span style="color:#f92672">-</span>cli
</span></span></code></pre></div><h5 id="34-启动redis客户端命令语法">3.4 启动Redis客户端命令语法：<a hidden class="anchor" aria-hidden="true" href="#34-启动redis客户端命令语法">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>redis<span style="color:#f92672">-</span>cli <span style="color:#f92672">-</span>h IP<span style="color:#960050;background-color:#1e0010">地址</span> <span style="color:#f92672">-</span>p <span style="color:#960050;background-color:#1e0010">端口</span>   <span style="color:#75715e">//默认IP本机  端口号6379
</span></span></span></code></pre></div><h5 id="35-检测是否服务端启动">3.5 检测是否服务端启动<a hidden class="anchor" aria-hidden="true" href="#35-检测是否服务端启动">#</a></h5>
<p>启动redis客户端，打开终端并输入命令redis-cli。该命令连接本地的redis服务。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">&gt;</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">&gt;</span> ping
</span></span><span style="display:flex;"><span>PONG
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">&gt;</span> 
</span></span></code></pre></div><p>在以上实例中我们连接到本地的redis服务并执行<strong>PING</strong> 命令，该命令用于检测redis服务是否启动</p>
<h5 id="36-检查redis的进程">3.6 检查redis的进程<a hidden class="anchor" aria-hidden="true" href="#36-检查redis的进程">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#执行</span> ps <span style="color:#f92672">-</span>ef <span style="color:#f92672">|</span> grep <span style="color:#f92672">-</span>i redis <span style="color:#960050;background-color:#1e0010">来查看进程</span>
</span></span><span style="display:flex;"><span>ps <span style="color:#f92672">-</span>ef <span style="color:#f92672">|</span> grep <span style="color:#f92672">-</span>i redis
</span></span><span style="display:flex;"><span>root      <span style="color:#ae81ff">10050</span>   <span style="color:#ae81ff">5728</span>  <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">23</span><span style="color:#f92672">:</span><span style="color:#ae81ff">03</span> pts<span style="color:#f92672">/</span><span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">03</span> <span style="color:#f92672">./</span>bin<span style="color:#f92672">/</span>redis<span style="color:#f92672">-</span>server <span style="color:#f92672">*:</span><span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>root      <span style="color:#ae81ff">10077</span>  <span style="color:#ae81ff">10056</span>  <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">23</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span> pts<span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#f92672">./</span>bin<span style="color:#f92672">/</span>redis<span style="color:#f92672">-</span>cli
</span></span><span style="display:flex;"><span>root      <span style="color:#ae81ff">10100</span>  <span style="color:#ae81ff">10081</span>  <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">23</span><span style="color:#f92672">:</span><span style="color:#ae81ff">22</span> pts<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>    <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> grep <span style="color:#f92672">--</span>color<span style="color:#f92672">=</span>auto <span style="color:#f92672">-</span>i redis
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> <span style="color:#f92672">~]</span><span style="color:#960050;background-color:#1e0010">#</span>   
</span></span></code></pre></div><h4 id="四redis配置详细">四、Redis配置详细<a hidden class="anchor" aria-hidden="true" href="#四redis配置详细">#</a></h4>
<p>Redis默认定义了很多默认配置。但在实际开发中，一般我们都会通过手动配置完成。回到安装目录下找到解压文件中的redis.conf。</p>
<p>Redis的配置文件位于Redis安装目录下，文件名称为redis.conf</p>
<h5 id="41-配置redis">4.1 配置Redis<a hidden class="anchor" aria-hidden="true" href="#41-配置redis">#</a></h5>
<p>命令：解压目录下的redis.conf配置文件复制到安装文件的目录下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#把编译的</span>redis<span style="color:#f92672">.</span><span style="color:#a6e22e">conf</span><span style="color:#960050;background-color:#1e0010">文件放</span> <span style="color:#960050;background-color:#1e0010">，安装的</span>redis<span style="color:#960050;background-color:#1e0010">文件目录下</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> redis<span style="color:#f92672">-</span><span style="color:#ae81ff">5.0.8</span><span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">#</span> pwd
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>root<span style="color:#f92672">/</span>apps<span style="color:#f92672">/</span>redis<span style="color:#f92672">-</span><span style="color:#ae81ff">5.0.8</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> redis<span style="color:#f92672">-</span><span style="color:#ae81ff">5.0.8</span><span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">#</span> cp redis<span style="color:#f92672">.</span><span style="color:#a6e22e">conf</span> <span style="color:#f92672">/</span>root<span style="color:#f92672">/</span>apps<span style="color:#f92672">/</span>redis
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> redis<span style="color:#f92672">-</span><span style="color:#ae81ff">5.0.8</span><span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">#</span> cd <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> apps<span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">#</span> ll
</span></span></code></pre></div><h5 id="42-redisconf">4.2 Redis.conf<a hidden class="anchor" aria-hidden="true" href="#42-redisconf">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">、</span>Redis<span style="color:#960050;background-color:#1e0010">默认不是以守护进程的方式运行，可以通过该配置项修改，使用</span>yes<span style="color:#960050;background-color:#1e0010">启用守护进程</span>
</span></span><span style="display:flex;"><span>    daemonize no
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">、当</span>Redis<span style="color:#960050;background-color:#1e0010">以守护进程方式运行时，</span>Redis<span style="color:#960050;background-color:#1e0010">默认会把</span>pid<span style="color:#960050;background-color:#1e0010">写入</span><span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>run<span style="color:#f92672">/</span>redis<span style="color:#f92672">.</span><span style="color:#a6e22e">pid</span><span style="color:#960050;background-color:#1e0010">文件，可以通过</span>pidfile<span style="color:#960050;background-color:#1e0010">指定</span> 
</span></span><span style="display:flex;"><span>    pidfile <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>run<span style="color:#f92672">/</span>redis<span style="color:#f92672">.</span><span style="color:#a6e22e">pid</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">、指定</span>Redis<span style="color:#960050;background-color:#1e0010">监听端口，默认端口为</span><span style="color:#ae81ff">6379</span><span style="color:#960050;background-color:#1e0010">；’</span>
</span></span><span style="display:flex;"><span>    port <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">、绑定的主机地址</span>
</span></span><span style="display:flex;"><span>    bind <span style="color:#ae81ff">127.0.0.1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">、当客户端限制多长时间后关闭连接，如果指定为</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">，表示关闭该功能</span>
</span></span><span style="display:flex;"><span>    timeout <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span><span style="color:#960050;background-color:#1e0010">、指定日志记录几倍，</span>Redis<span style="color:#960050;background-color:#1e0010">总共支持四个级别：</span>debug<span style="color:#960050;background-color:#1e0010">，</span>verbose<span style="color:#960050;background-color:#1e0010">，</span>notice<span style="color:#960050;background-color:#1e0010">，</span>warning<span style="color:#960050;background-color:#1e0010">，默认为</span>verbose
</span></span><span style="display:flex;"><span>    loglevel verbos
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7</span><span style="color:#960050;background-color:#1e0010">、日志记录方式，默认为标准输出，如果配置</span>Redis<span style="color:#960050;background-color:#1e0010">为守护进程方式运行，而这里又配置日志记录方式标准输出，则日志将会发送给</span><span style="color:#f92672">/</span>dev<span style="color:#f92672">/</span><span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>    logfile stdout
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">、设置数据库的数量，默认数据库为</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">，可以使用</span>SELECT<span style="color:#f92672">&lt;</span>dbid<span style="color:#f92672">&gt;</span><span style="color:#960050;background-color:#1e0010">命令在连接上指定数据库</span>id
</span></span><span style="display:flex;"><span>    databases <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span><span style="color:#960050;background-color:#1e0010">、指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span>
</span></span><span style="display:flex;"><span>    save<span style="color:#f92672">&lt;</span>seconds<span style="color:#f92672">&gt;&lt;</span>changes<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    Redis<span style="color:#960050;background-color:#1e0010">默认配置文件中提供了三个条件</span>
</span></span><span style="display:flex;"><span>    save <span style="color:#ae81ff">900</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    save <span style="color:#ae81ff">300</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    save <span style="color:#ae81ff">60</span> <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">分别表示</span><span style="color:#ae81ff">900</span><span style="color:#960050;background-color:#1e0010">秒</span><span style="color:#f92672">(</span><span style="color:#ae81ff">15</span><span style="color:#960050;background-color:#1e0010">分钟</span><span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">内有</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">个更改，</span><span style="color:#ae81ff">300</span><span style="color:#960050;background-color:#1e0010">秒</span><span style="color:#f92672">(</span><span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">分钟</span><span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">内有</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">个更改以及</span><span style="color:#ae81ff">60</span><span style="color:#960050;background-color:#1e0010">秒内有</span><span style="color:#ae81ff">10000</span><span style="color:#960050;background-color:#1e0010">个更改。</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">、指定存储至本地数据库时是否压缩数据，默认为</span>yes<span style="color:#960050;background-color:#1e0010">，</span>Redis<span style="color:#960050;background-color:#1e0010">采用</span>LZF<span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">压缩算法</span><span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">压缩，如果为了节省</span>CPU<span style="color:#960050;background-color:#1e0010">时间，可以关闭该选项，但会导致数据库文件变的巨大</span>
</span></span><span style="display:flex;"><span>    rdbcompression yes
</span></span></code></pre></div><p><strong>中间10个</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ae81ff">11</span><span style="color:#960050;background-color:#1e0010">、指定本地数据库文件名，默认为</span>dump<span style="color:#f92672">.</span><span style="color:#a6e22e">rdb</span>
</span></span><span style="display:flex;"><span>	dbfilename dump<span style="color:#f92672">.</span><span style="color:#a6e22e">rdb</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12</span><span style="color:#960050;background-color:#1e0010">、指定本地数据库存放目录</span>
</span></span><span style="display:flex;"><span>	dir <span style="color:#f92672">./</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">13</span><span style="color:#960050;background-color:#1e0010">、设置当本机为</span>slav<span style="color:#960050;background-color:#1e0010">服务时，设置</span>master<span style="color:#960050;background-color:#1e0010">服务的</span>IP<span style="color:#960050;background-color:#1e0010">地址及端口，在</span>Redis<span style="color:#960050;background-color:#1e0010">启动时，它会自动从</span>master<span style="color:#960050;background-color:#1e0010">进行数据同步</span>slaveof<span style="color:#f92672">&lt;</span>masterip<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>masterport<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">14</span><span style="color:#960050;background-color:#1e0010">、当</span>master<span style="color:#960050;background-color:#1e0010">服务设置了密码保护时，</span>slav<span style="color:#960050;background-color:#1e0010">服务连接</span>master<span style="color:#960050;background-color:#1e0010">的密码</span>
</span></span><span style="display:flex;"><span>    masterauth<span style="color:#f92672">&lt;</span>master<span style="color:#f92672">-</span>password<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">15</span><span style="color:#960050;background-color:#1e0010">、设置</span>Redis<span style="color:#960050;background-color:#1e0010">连接密码，如果配置了连接密码，客户端在连接</span>Redis<span style="color:#960050;background-color:#1e0010">是需要通过</span>AUTH <span style="color:#f92672">&lt;</span>password<span style="color:#f92672">&gt;</span><span style="color:#960050;background-color:#1e0010">命令提供密码，默认关闭</span>
</span></span><span style="display:flex;"><span>    requirepass foobared
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">16</span><span style="color:#960050;background-color:#1e0010">、设置同一时间最大客户端连接数，默认是无限制，</span>Redis<span style="color:#960050;background-color:#1e0010">可以同时打开的客户端连接数为</span>Redis<span style="color:#960050;background-color:#1e0010">进程可以打开的最大文件描述符数，如果设置</span>maxclients <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">，表示不作限制。当客户端连接数到达限制是，</span>Redis<span style="color:#960050;background-color:#1e0010">会关闭新的连接并向客户端返回</span>max number of clients reached<span style="color:#960050;background-color:#1e0010">错误信息</span>
</span></span><span style="display:flex;"><span>    maxclients <span style="color:#ae81ff">128</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">17</span><span style="color:#960050;background-color:#1e0010">、指定</span>Redis<span style="color:#960050;background-color:#1e0010">最大内存限制，</span>Redis<span style="color:#960050;background-color:#1e0010">在启动时会把数据加载到内存中，达到最大内存后，</span>Redis<span style="color:#960050;background-color:#1e0010">会先尝试清除已到期或即将到期的</span>Key<span style="color:#960050;background-color:#1e0010">，档次方法处理后，仍然达最大内存设置，将无法再进行写入操作，但仍然可以静心读取操作。</span>Rdis<span style="color:#960050;background-color:#1e0010">新的</span>vm<span style="color:#960050;background-color:#1e0010">机制，会把</span>key<span style="color:#960050;background-color:#1e0010">存放内存，</span>Value<span style="color:#960050;background-color:#1e0010">会存放在</span>swap<span style="color:#960050;background-color:#1e0010">区</span>
</span></span><span style="display:flex;"><span>    maxmemory <span style="color:#f92672">&lt;</span>bytes<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">18</span><span style="color:#960050;background-color:#1e0010">、指定是否每次更新操作后进行日志记录，</span>Redis<span style="color:#960050;background-color:#1e0010">在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一端时间内的数据丢失。因为</span> redis <span style="color:#960050;background-color:#1e0010">本省同步数据文件是按上面</span>save<span style="color:#960050;background-color:#1e0010">条件来同步的，所有的数据会在一端时间内只存在于内存中。默认为</span>no
</span></span><span style="display:flex;"><span>    appendonly no
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">19</span><span style="color:#960050;background-color:#1e0010">、指定更新日志文件名，默认为</span>appendonly<span style="color:#f92672">.</span><span style="color:#a6e22e">aof</span>
</span></span><span style="display:flex;"><span>    appendfulename appendonly<span style="color:#f92672">.</span><span style="color:#a6e22e">aof</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">20</span><span style="color:#960050;background-color:#1e0010">、指定更新日志条件，共有</span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">个可选值：</span>
</span></span><span style="display:flex;"><span>    no<span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">表示等操作系统进行数据缓存同步到磁盘</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">快</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    always<span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">表示每次更新操作后活动调用</span>fsync<span style="color:#f92672">()</span><span style="color:#960050;background-color:#1e0010">将数据写到磁盘</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">慢，安全</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    everysec<span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">表示每秒同步一个</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">折中，默认值</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    appendfsync everysec
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>maxmemory-policy noeviction  #  内存达到上限之后的处理策略
</span></span><span style="display:flex;"><span>1、volatile-lru ： 只对设置了过期时间的key进行LRU（默认值）
</span></span><span style="display:flex;"><span>2、allkeys-lru ： 产出lru算法的key
</span></span><span style="display:flex;"><span>3、volatile-random  ： 随机删除即将过期key
</span></span><span style="display:flex;"><span>4、allkey -random : 随机删除
</span></span><span style="display:flex;"><span>5、volatile-ttl  :  删除即将过期的
</span></span><span style="display:flex;"><span>6、noeviction    ： 永不过期，返回错误
</span></span></code></pre></div><p><strong>结尾10个</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ae81ff">21</span><span style="color:#960050;background-color:#1e0010">、指定是否启用虚拟内存机制，默认为</span>no<span style="color:#960050;background-color:#1e0010">，简单的介绍一下，</span>vm<span style="color:#960050;background-color:#1e0010">机制将数据分页存放，有</span>Redis<span style="color:#960050;background-color:#1e0010">将访问量较少的页即冷数据</span>swap<span style="color:#960050;background-color:#1e0010">到磁盘上，访问多的页面由磁盘自动换出到内存中</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">在后面的文章会仔细分析</span>Redis<span style="color:#960050;background-color:#1e0010">的</span>vm<span style="color:#960050;background-color:#1e0010">机制</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    vm<span style="color:#f92672">-</span>enabled no
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">22</span><span style="color:#960050;background-color:#1e0010">、虚拟内存文件路径，默认值为</span><span style="color:#f92672">/</span>tmp<span style="color:#f92672">/</span>redis<span style="color:#f92672">.</span><span style="color:#a6e22e">swap</span><span style="color:#960050;background-color:#1e0010">，不可多个</span>Redis<span style="color:#960050;background-color:#1e0010">实例共享</span>
</span></span><span style="display:flex;"><span>    vm<span style="color:#f92672">-</span>swap<span style="color:#f92672">-</span>file <span style="color:#f92672">/</span>tmp<span style="color:#f92672">/</span>redis<span style="color:#f92672">.</span><span style="color:#a6e22e">swap</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">23</span><span style="color:#960050;background-color:#1e0010">、将所有大于</span>vm<span style="color:#f92672">-</span>max<span style="color:#f92672">-</span>memory<span style="color:#960050;background-color:#1e0010">的数据存入虚拟内存，无论</span>vm<span style="color:#f92672">-</span>max<span style="color:#f92672">-</span>memory<span style="color:#960050;background-color:#1e0010">设置多小，所有索引数据都是内存存储的</span><span style="color:#f92672">(</span>Redis<span style="color:#960050;background-color:#1e0010">的索引数据</span> <span style="color:#960050;background-color:#1e0010">就是</span>keys<span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">，也就是说，当</span>vm<span style="color:#f92672">-</span>max<span style="color:#f92672">-</span>memory<span style="color:#960050;background-color:#1e0010">设置为</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">的时候，其实是所有</span>value<span style="color:#960050;background-color:#1e0010">都存在于磁盘。默认值为</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    vm<span style="color:#f92672">-</span>page<span style="color:#f92672">-</span>size <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">24</span><span style="color:#960050;background-color:#1e0010">、</span>Redis swap<span style="color:#960050;background-color:#1e0010">文件分成了很多的</span>page<span style="color:#960050;background-color:#1e0010">，一个对象可以保存咱几多个</span>page<span style="color:#960050;background-color:#1e0010">上面，但一个</span>page<span style="color:#960050;background-color:#1e0010">上不能被多个对象共享，</span>vm<span style="color:#f92672">-</span>page<span style="color:#f92672">-</span>size<span style="color:#960050;background-color:#1e0010">是要根据存储的</span> <span style="color:#960050;background-color:#1e0010">数据大小来设定的，作者建议如果村粗很多小对象，</span>page<span style="color:#960050;background-color:#1e0010">大小最好设置为</span><span style="color:#ae81ff">32</span><span style="color:#960050;background-color:#1e0010">或者</span><span style="color:#ae81ff">64</span>bytes<span style="color:#960050;background-color:#1e0010">；如果存储很大大对象，则可以使用更大的</span>page<span style="color:#960050;background-color:#1e0010">，如果不确定，就是用默认值</span>
</span></span><span style="display:flex;"><span>    vm<span style="color:#f92672">-</span>page<span style="color:#f92672">-</span>size <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">25</span><span style="color:#960050;background-color:#1e0010">、设置</span>swap<span style="color:#960050;background-color:#1e0010">文件中的</span>page<span style="color:#960050;background-color:#1e0010">数量，由于页表</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">一种表示页面空闲或是欧诺个的</span>bitmap<span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">是放在内存中的，在磁盘上每</span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">个</span>pages<span style="color:#960050;background-color:#1e0010">将消耗</span><span style="color:#ae81ff">1</span>byte<span style="color:#960050;background-color:#1e0010">的内存</span>
</span></span><span style="display:flex;"><span>    vm<span style="color:#f92672">-</span>pages <span style="color:#ae81ff">134217728</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">26</span><span style="color:#960050;background-color:#1e0010">、设置访问</span>swap<span style="color:#960050;background-color:#1e0010">文件的线程数，最好不要超过机器的核数，如果设置为</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">，那么所有对</span>swap<span style="color:#960050;background-color:#1e0010">文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>    vm<span style="color:#f92672">-</span>max<span style="color:#f92672">-</span>threads <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">27</span><span style="color:#960050;background-color:#1e0010">、设置在向客户端应答时，是否把较小的包含并未一个包发送，默认为开启</span>
</span></span><span style="display:flex;"><span>    glueoutputbuf yes
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">28</span><span style="color:#960050;background-color:#1e0010">、指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</span>
</span></span><span style="display:flex;"><span>    hash<span style="color:#f92672">-</span>max<span style="color:#f92672">-</span>zipmap<span style="color:#f92672">-</span>entries <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    hash<span style="color:#f92672">-</span>max<span style="color:#f92672">-</span>zipmap<span style="color:#f92672">-</span>value <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">29</span><span style="color:#960050;background-color:#1e0010">、指定是否激活重置哈希。默认为开启</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">后面在介绍</span>Redis<span style="color:#960050;background-color:#1e0010">的哈希算法时具体介绍</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    activerehasing yes
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">30</span><span style="color:#960050;background-color:#1e0010">、指定包含其他的配置文件，可以在同一主机上多个</span>redis<span style="color:#960050;background-color:#1e0010">实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件</span>
</span></span><span style="display:flex;"><span>    include <span style="color:#f92672">/</span>path<span style="color:#f92672">/</span>to<span style="color:#f92672">/</span>local<span style="color:#f92672">.</span><span style="color:#a6e22e">conf</span>    
</span></span></code></pre></div><h5 id="42内存中的维护策略">4.2、内存中的维护策略<a hidden class="anchor" aria-hidden="true" href="#42内存中的维护策略">#</a></h5>
<p>redis作为优秀的中间缓存件，时常会存储大量的数据，即使采取了集群部署来动态扩容，也应该即使的整理内存，维持系统性能。</p>
<h6 id="421-在redis中有两种解决方案">4.2.1 在redis中有两种解决方案<a hidden class="anchor" aria-hidden="true" href="#421-在redis中有两种解决方案">#</a></h6>
<ul>
<li>为数据设置超时时间</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//设置过期时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>expire key <span style="color:#a6e22e">time</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">以秒为单位</span><span style="color:#f92672">)--</span><span style="color:#960050;background-color:#1e0010">这是最常用的方式</span>
</span></span><span style="display:flex;"><span>setex<span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> seconds<span style="color:#f92672">,</span> String value<span style="color:#f92672">)</span> <span style="color:#f92672">--</span><span style="color:#960050;background-color:#1e0010">字符串独有的方式</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">、除了字符串自己独有设置过期时间的方法外，其他方法都需要依靠</span>expire<span style="color:#960050;background-color:#1e0010">方法来设置时间</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">、如果没有设置时间，那缓存就是永不过期</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">、如果设置了过期时间，之后又想让缓存永不过期没使用</span>persist key    
</span></span></code></pre></div><ul>
<li>采用LRU算法动态将不用的数据删除</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">内存管理的一种页面置换算法，对于在内存中但又不用的数据块</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">内存块</span><span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">叫做</span>LRU<span style="color:#960050;background-color:#1e0010">，</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">操作系统会根据哪些数据属于</span>LRU<span style="color:#960050;background-color:#1e0010">而将其移除内存而腾出空间来加载另外的数据。</span>
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><p>1.<strong>volatile-lru</strong>：设定超时时间的数据中，删除最不常使用的数据</p>
<p>2.<strong>allkeys-lru</strong>：查询所有的key只能怪最近最不常使用的数据进行删除，这是应用最广泛的策略。</p>
<p>3.<strong>volatile-random</strong>：在已经设定了超时的数据中随机删除。</p>
<p>4.<strong>allkeys-random</strong>：查询所有的key，之后随机删除。</p>
<p>5.<strong>volatile-ttl</strong>：查询全部设定超时时间的数据，之后排序，将马上要过期的数据进行删除操作。</p>
<p>6.<strong>noeviction</strong>：如果设置为该属性，则不会进行删除操作，如果内存溢出则报错返回。</p>
<p>7.<strong>volatile-lfu</strong>：从所有配置了过去时间的键中驱逐使用频率最少的键</p>
<p>8.<strong>allkeys-lfu</strong>：从所有键中驱逐使用频率最少的键</p>
<h6 id="422-自定义配置redis">4.2.2 自定义配置redis<a hidden class="anchor" aria-hidden="true" href="#422-自定义配置redis">#</a></h6>
<p>进入对应的安装目录：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>/root/apps/redis
</span></span></code></pre></div><p>修改redis.conf配置文件 vim redis.conf（进入命令模式 通过/内容 查找相应字符串）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>daemonize no <span style="color:#960050;background-color:#1e0010">修改为</span> daemonize yes <span style="color:#960050;background-color:#1e0010">守护进程启动</span>
</span></span><span style="display:flex;"><span>bind <span style="color:#ae81ff">127.0.0.1</span> <span style="color:#960050;background-color:#1e0010">注释掉</span>  <span style="color:#960050;background-color:#1e0010">允许除本机</span> <span style="color:#960050;background-color:#1e0010">外的机器访问</span>redis<span style="color:#960050;background-color:#1e0010">服务</span>
</span></span><span style="display:flex;"><span>requirepass <span style="color:#960050;background-color:#1e0010">设置密码</span>  <span style="color:#960050;background-color:#1e0010">设定数据库密码</span> <span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">保证服务安全</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">有些情况下不设定密码是无法进行远程连接访问的</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Redis采用的是单进程多线程的模式。当redis.conf中选项daemonize设置成为yes时，代表开启守护进程模式。在该模式下，redis会在后台运行，并将进程pid号写入值redis.conf选项pidfile设置的文件中，此时redis将一直运行，除非手动kill该进程。但当daemonize选项设置为no时，当前界面将进入redis的命令行界面，exit强制退出或者关闭连接工具（putty,xshell等）都会呆滞redis进程退出。</p>
<p>服务端开发的大部分应用都是采用后台运行的模式</p>
<p>requirepass设置密码。因为redis速度相当快，所以一台比较好的服务器下，一个外部用户在一秒内可以进行15w密码尝试，这意味你需要设定非常强大的密码来防止暴力破解。</p>
<p>可以通过redis的配置文件设置密码参数，这样客户端连接大redis服务就需要密码验证，这样可以让你的redis服务更加安全。</p>
<h4 id="五-redis启动">五 、Redis启动<a hidden class="anchor" aria-hidden="true" href="#五-redis启动">#</a></h4>
<h5 id="51-redis以守护进程服务端进行启动">5.1 Redis以守护进程服务端进行启动<a hidden class="anchor" aria-hidden="true" href="#51-redis以守护进程服务端进行启动">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 使用该命令进行启动：【./bin/redis-server ./redis.conf 】
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> redis<span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">./</span>bin<span style="color:#f92672">/</span>redis<span style="color:#f92672">-</span>server <span style="color:#f92672">./</span>redis<span style="color:#f92672">.</span><span style="color:#a6e22e">conf</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">11450</span><span style="color:#f92672">:</span>C <span style="color:#ae81ff">05</span> Jul <span style="color:#ae81ff">2020</span> <span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#ae81ff">23</span><span style="color:#f92672">:</span><span style="color:#ae81ff">34.257</span> <span style="color:#960050;background-color:#1e0010">#</span> oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">11450</span><span style="color:#f92672">:</span>C <span style="color:#ae81ff">05</span> Jul <span style="color:#ae81ff">2020</span> <span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#ae81ff">23</span><span style="color:#f92672">:</span><span style="color:#ae81ff">34.257</span> <span style="color:#960050;background-color:#1e0010">#</span> Redis version<span style="color:#f92672">=</span><span style="color:#ae81ff">5.0.8</span><span style="color:#f92672">,</span> bits<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span><span style="color:#f92672">,</span> commit<span style="color:#f92672">=</span><span style="color:#ae81ff">00000000</span><span style="color:#f92672">,</span> modified<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">,</span> pid<span style="color:#f92672">=</span><span style="color:#ae81ff">11450</span><span style="color:#f92672">,</span> just started
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">11450</span><span style="color:#f92672">:</span>C <span style="color:#ae81ff">05</span> Jul <span style="color:#ae81ff">2020</span> <span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#ae81ff">23</span><span style="color:#f92672">:</span><span style="color:#ae81ff">34.257</span> <span style="color:#960050;background-color:#1e0010">#</span> Configuration loaded
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> redis<span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">#</span> 
</span></span></code></pre></div><h5 id="52-redis客户端进行启动">5.2 Redis客户端进行启动：<a hidden class="anchor" aria-hidden="true" href="#52-redis客户端进行启动">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//Redis 客户端启动命令：./redis-cli
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> bin<span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">./</span>redis<span style="color:#f92672">-</span>cli 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">&gt;</span> keys <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">&gt;</span> 
</span></span></code></pre></div><h4 id="六redis关闭">六、Redis关闭<a hidden class="anchor" aria-hidden="true" href="#六redis关闭">#</a></h4>
<h5 id="61第一种关闭方式">6.1、第一种关闭方式：<a hidden class="anchor" aria-hidden="true" href="#61第一种关闭方式">#</a></h5>
<p>(断电、非正常关闭，容易数据丢失) 查询不到redis进程id</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>PID ps -ef | grep -i redis
</span></span></code></pre></div><p>kill 查询的id进行强制关闭</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>kill <span style="color:#f92672">-</span><span style="color:#ae81ff">9</span> PID
</span></span></code></pre></div><h5 id="62第二种关闭方式">6.2、第二种关闭方式<a hidden class="anchor" aria-hidden="true" href="#62第二种关闭方式">#</a></h5>
<p>(正常关闭，数据保存)</p>
<p><strong>关闭redis服务，通过客户端进行shutdown</strong></p>
<p>如果redis设置了密码，需要先在客户端通过密码登录，在进行shutdown即可关闭服务端</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 在客户端使用【shutdown】命令关闭Redis服务端
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">&gt;</span> SHUTDOWN
</span></span><span style="display:flex;"><span>not connected<span style="color:#f92672">&gt;</span> y
</span></span><span style="display:flex;"><span>Could not connect to Redis at <span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">:</span> Connection refused
</span></span><span style="display:flex;"><span>not connected<span style="color:#f92672">&gt;</span> shutdown
</span></span></code></pre></div><h4 id="七远程连接">七、远程连接<a hidden class="anchor" aria-hidden="true" href="#七远程连接">#</a></h4>
<h5 id="71-redis远程连接比较流行的软件redisdesktomanager">7.1 Redis远程连接比较流行的软件：RedisDesktoManager<a hidden class="anchor" aria-hidden="true" href="#71-redis远程连接比较流行的软件redisdesktomanager">#</a></h5>
<p>默认不允许远程连接，需要修改一下信息才可以进行修改，</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>bind <span style="color:#ae81ff">127.0.0.1</span> <span style="color:#960050;background-color:#1e0010">注释掉</span> <span style="color:#960050;background-color:#1e0010">允许除本机以外的机器访问</span>Redis<span style="color:#960050;background-color:#1e0010">服务</span>
</span></span><span style="display:flex;"><span>requirepass <span style="color:#960050;background-color:#1e0010">设置密码</span> <span style="color:#960050;background-color:#1e0010">设定数据库密码</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">有些情况系不设定密码是无法进行远程连接访问的</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><h5 id="72-redis使用密码登录">7.2 Redis使用密码登录<a hidden class="anchor" aria-hidden="true" href="#72-redis使用密码登录">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Redis客户端使用密码进行登录  【./bin/redis-cli -a redis】
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">[</span>root<span style="color:#a6e22e">@centos</span> redis<span style="color:#f92672">]</span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">./</span>bin<span style="color:#f92672">/</span>redis<span style="color:#f92672">-</span>cli <span style="color:#f92672">-</span>a redis
</span></span><span style="display:flex;"><span>Warning: Using a password with <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">-</span>a<span style="color:#960050;background-color:#1e0010">&#39;</span> or <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">-</span>u<span style="color:#960050;background-color:#1e0010">&#39;</span> option on the command line <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">may</span> not be safe<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">&gt;</span> keys <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#f92672">)</span> <span style="color:#e6db74">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span><span style="color:#f92672">&gt;</span> 
</span></span></code></pre></div><h4 id="centos-防火墙端口">Centos 防火墙端口<a hidden class="anchor" aria-hidden="true" href="#centos-防火墙端口">#</a></h4>
<p>开放8080端口（如下命令只针对Centos7以上）</p>
<p>查看已经开放的端口：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>firewall-cmd --list-ports
</span></span></code></pre></div><p>开启端口：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>firewall-cmd --zone=public --add-port-6379/tcp --permanent
</span></span></code></pre></div><p>重启防火墙：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>firewall-cmd --reload  #重启
</span></span><span style="display:flex;"><span>Firewall systemctl stop firewalld.service  #停止
</span></span><span style="display:flex;"><span>firewall systemctl disable firewalld.service #禁止firewall 开机启动
</span></span></code></pre></div><h4 id="八-docker安装redis">八 、Docker安装Redis<a hidden class="anchor" aria-hidden="true" href="#八-docker安装redis">#</a></h4>
<h5 id="81-搜索redis">8.1 搜索redis<a hidden class="anchor" aria-hidden="true" href="#81-搜索redis">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>docker search redis
</span></span></code></pre></div><h5 id="82-下载镜像">8.2 下载镜像<a hidden class="anchor" aria-hidden="true" href="#82-下载镜像">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>docker pull redis<span style="color:#960050;background-color:#1e0010">：</span><span style="color:#ae81ff">4.0.1</span>
</span></span></code></pre></div><h5 id="83-创建并运行容器">8.3 创建并运行容器<a hidden class="anchor" aria-hidden="true" href="#83-创建并运行容器">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>docker run <span style="color:#f92672">-</span>d <span style="color:#f92672">--</span>name redis6379 <span style="color:#f92672">-</span>p <span style="color:#ae81ff">6379</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6379</span> redis<span style="color:#f92672">:</span><span style="color:#ae81ff">4.0.1</span> <span style="color:#f92672">--</span>requirepass <span style="color:#e6db74">&#34;redis&#34;</span>
</span></span></code></pre></div><h5 id="84-测试进入redis进入客户端">8.4 测试进入Redis进入客户端<a hidden class="anchor" aria-hidden="true" href="#84-测试进入redis进入客户端">#</a></h5>
<p>使用redis镜像执行redis-cli命令连接到刚启动的容器</p>
<h4 id="九redis常用命令">九、Redis常用命令<a hidden class="anchor" aria-hidden="true" href="#九redis常用命令">#</a></h4>
<p>Redis 命令用于在redis服务上执行操作。要在redis服务上执行命令需要一个redis客户端。</p>
<p>Redis 客户端在我们之前下载的Redis的安装包中。</p>
<p>**Redis支持的物种数据类型 ：string(字符串)，hash(哈希)，list(列表)，set(集合)及zset（sorted set : 有序集合）等</p>
<h5 id="91-常用命令key管理">9.1 常用命令key管理<a hidden class="anchor" aria-hidden="true" href="#91-常用命令key管理">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">、</span> keys <span style="color:#f92672">*</span> <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">返回满足的所有键，可以模糊匹配，比如</span> keys abc<span style="color:#f92672">*</span> <span style="color:#960050;background-color:#1e0010">：表示以</span> abc <span style="color:#960050;background-color:#1e0010">开头的</span> key
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">、</span> exists key <span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">是否存在指定的</span>key <span style="color:#960050;background-color:#1e0010">，存在返回</span><span style="color:#ae81ff">1.</span><span style="color:#960050;background-color:#1e0010">不存在返回</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">、</span> expire key second <span style="color:#960050;background-color:#1e0010">：设置某个</span>key<span style="color:#960050;background-color:#1e0010">的过期时间</span> <span style="color:#960050;background-color:#1e0010">时间为妙</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">、</span> del key <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">删除某个</span>key
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">、</span> ttl key <span style="color:#960050;background-color:#1e0010">：查看剩余时间，当</span>key<span style="color:#960050;background-color:#1e0010">不存在是，返回</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">；存在但没有设置剩余生存时间时，返回</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">，否</span>              <span style="color:#960050;background-color:#1e0010">则，以秒为单位，返回</span>key <span style="color:#960050;background-color:#1e0010">的剩余生存时间。</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span><span style="color:#960050;background-color:#1e0010">、</span> persist key <span style="color:#960050;background-color:#1e0010">：取消过去时间</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7</span><span style="color:#960050;background-color:#1e0010">、</span> PEXPIRE key millisseconds <span style="color:#960050;background-color:#1e0010">修改</span>key <span style="color:#960050;background-color:#1e0010">的过期时间为毫秒</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">、</span> select <span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">选择数据库</span> <span style="color:#960050;background-color:#1e0010">数据库为</span><span style="color:#ae81ff">0</span><span style="color:#f92672">-</span><span style="color:#ae81ff">15</span><span style="color:#960050;background-color:#1e0010">（默认一共</span><span style="color:#ae81ff">16</span><span style="color:#960050;background-color:#1e0010">个数据库）</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span><span style="color:#960050;background-color:#1e0010">、</span> <span style="color:#960050;background-color:#1e0010">设计成多个数据库实际上是为了数据库安全和备份</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">、</span> move key dbindex <span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">将当前数据中的</span>key<span style="color:#960050;background-color:#1e0010">转移到其他数据库</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">11</span><span style="color:#960050;background-color:#1e0010">、</span> randomkey <span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">随机返回一个</span>key
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12</span><span style="color:#960050;background-color:#1e0010">、</span> rename key key2 <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">种命名</span>key
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">13</span><span style="color:#960050;background-color:#1e0010">、</span> echo <span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">打印命令</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">14</span><span style="color:#960050;background-color:#1e0010">、</span> dbsize <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">查看数据库的</span>key<span style="color:#960050;background-color:#1e0010">数量</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">15</span><span style="color:#960050;background-color:#1e0010">、</span> info <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">查看数据库信息</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">16</span><span style="color:#960050;background-color:#1e0010">、</span> config get <span style="color:#f92672">*</span> <span style="color:#960050;background-color:#1e0010">实时存储收到的请求，返回相关的配置</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">17</span><span style="color:#960050;background-color:#1e0010">、</span> flushdb <span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">清除当前数据库</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">18</span><span style="color:#960050;background-color:#1e0010">、</span> flushall <span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">清空所有数据库</span> 
</span></span></code></pre></div><h5 id="92-del-key">9.2 DEL key<a hidden class="anchor" aria-hidden="true" href="#92-del-key">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>该命令用于在key存在时删除key。
</span></span></code></pre></div><h5 id="93-exists-key">9.3 EXISTS key<a hidden class="anchor" aria-hidden="true" href="#93-exists-key">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>检查给定key是否存在。
</span></span></code></pre></div><h5 id="94-expire-key-seconds">9.4 EXPIRE key seconds<a hidden class="anchor" aria-hidden="true" href="#94-expire-key-seconds">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>为给定key设置过期时间(以秒计)
</span></span></code></pre></div><h5 id="95-pexpire-key-milliseconds">9.5 PEXPIRE key milliseconds<a hidden class="anchor" aria-hidden="true" href="#95-pexpire-key-milliseconds">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">设置</span>key<span style="color:#960050;background-color:#1e0010">的过期时间以毫秒计</span>
</span></span></code></pre></div><h5 id="96-ttl-key">9.6 TTL key<a hidden class="anchor" aria-hidden="true" href="#96-ttl-key">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>以秒为单位，返回给定key的剩余生存时间(TTL, time to live)
</span></span></code></pre></div><h5 id="97-pttl-key">9.7 PTTL key<a hidden class="anchor" aria-hidden="true" href="#97-pttl-key">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>以秒为单位，返回 key 的剩余生存时间
</span></span></code></pre></div><h5 id="98-keys-pattern">9.8 KEYS pattern<a hidden class="anchor" aria-hidden="true" href="#98-keys-pattern">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>查找所有服务给定模式(pattern)的key。
</span></span><span style="display:flex;"><span>keys 通配符  获取所有与pattern匹配的key，返回所有与该匹配
</span></span><span style="display:flex;"><span>  通配符 ： 
</span></span><span style="display:flex;"><span>		* 代表所有
</span></span><span style="display:flex;"><span>        ? 表示代表一个字符
</span></span></code></pre></div><h5 id="99-rename-key-newkey">9.9 RENAME key newkey<a hidden class="anchor" aria-hidden="true" href="#99-rename-key-newkey">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">修改</span>key<span style="color:#960050;background-color:#1e0010">的名称</span>
</span></span></code></pre></div><h5 id="910-move-key-db">9.10 MOVE key db<a hidden class="anchor" aria-hidden="true" href="#910-move-key-db">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">将当前数据库的</span> key <span style="color:#960050;background-color:#1e0010">移动到给定的数据库</span>db<span style="color:#960050;background-color:#1e0010">当中</span>
</span></span></code></pre></div><h5 id="911-type-key">9.11 TYPE key<a hidden class="anchor" aria-hidden="true" href="#911-type-key">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>返回 key 所存储的值的类型
</span></span></code></pre></div><h5 id="912-应用场景">9.12 应用场景<a hidden class="anchor" aria-hidden="true" href="#912-应用场景">#</a></h5>
<p><strong>EXPIPER key seconds</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">、限时的优惠活动信息</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">、网站数据缓存</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">对于一些需要定时更新的数据，例如</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">积分排行榜</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">、手机验证码</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">、限制网站访客访问频率</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">例如：</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">分钟最多访问</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">次</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><h5 id="913-key的命名建议">9.13 key的命名建议<a hidden class="anchor" aria-hidden="true" href="#913-key的命名建议">#</a></h5>
<p><strong>redis单个key允许存入512M大小</strong></p>
<ul>
<li>1、key 不要太长，尽量不要超过1024字节，这不仅消耗内存，而且会降低查找的效率</li>
<li>2、key 也不要太短，太短的话，key的可读性会降低</li>
<li>3、在一个项目中，key最好使用提议的命名模式，例如user:12:password</li>
<li>4、key名称区分大小写</li>
</ul>
<h4 id="十-redis数据类型">十 、Redis数据类型<a hidden class="anchor" aria-hidden="true" href="#十-redis数据类型">#</a></h4>
<h5 id="101-string-类型">10.1 String 类型<a hidden class="anchor" aria-hidden="true" href="#101-string-类型">#</a></h5>
<p>String类型是Redis最基本的数据类型，一个键最大能存储512MB。</p>
<p>String 数据结构最贱但的key-value类型，value其不仅是string，也可以是数字，是包含很多种类型的特殊类型，</p>
<p>String类型是二进制安全的。意思是redis的string可以包含任何数据。</p>
<p>比如序列化的对象进行存储，比如一张图片进行二进制存储，比如一个简单的字符串，数值等等。</p>
<h5 id="string命令">String命令<a hidden class="anchor" aria-hidden="true" href="#string命令">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">、复制语法：</span>
</span></span><span style="display:flex;"><span>	SET KEY_NAME VALUE <span style="color:#f92672">:</span> <span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">说明：多次设置</span>name<span style="color:#960050;background-color:#1e0010">会覆盖</span><span style="color:#f92672">)(</span>Redis SET <span style="color:#960050;background-color:#1e0010">命令用于设置给定</span> key <span style="color:#960050;background-color:#1e0010">的值。如果</span> key <span style="color:#960050;background-color:#1e0010">已经存储值，</span>SET <span style="color:#960050;background-color:#1e0010">就要写旧值，且无视类型</span><span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">。</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">、命令：</span>
</span></span><span style="display:flex;"><span>    SETNX key1 value<span style="color:#960050;background-color:#1e0010">：</span><span style="color:#f92672">(</span>not exist<span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">如果</span>key1<span style="color:#960050;background-color:#1e0010">不存在，则设置</span> <span style="color:#960050;background-color:#1e0010">并返回</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">。如果</span>key1<span style="color:#960050;background-color:#1e0010">存在，则不设置并返回</span><span style="color:#ae81ff">0</span><span style="color:#f92672">;(</span><span style="color:#960050;background-color:#1e0010">解决分布式锁</span>  <span style="color:#960050;background-color:#1e0010">方案之一，只有在</span>key <span style="color:#960050;background-color:#1e0010">不存在时设置</span> key <span style="color:#960050;background-color:#1e0010">的值。</span>setnx <span style="color:#f92672">(</span>SET <span style="color:#66d9ef">if</span> not exits<span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">命令在指定的</span>key<span style="color:#960050;background-color:#1e0010">不存在时，为</span>key<span style="color:#960050;background-color:#1e0010">设置指定的值</span><span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">。</span>
</span></span><span style="display:flex;"><span>    SETEX key1 <span style="color:#ae81ff">10</span> lx <span style="color:#f92672">:(</span>expired<span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">设置</span>key1<span style="color:#960050;background-color:#1e0010">的值为</span>lx<span style="color:#f92672">,</span><span style="color:#960050;background-color:#1e0010">过期时间为</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">秒，</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">秒后</span>key1<span style="color:#960050;background-color:#1e0010">清除（</span>key<span style="color:#960050;background-color:#1e0010">也清除）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SETEX key1 <span style="color:#ae81ff">10</span> lx <span style="color:#f92672">:(</span>expired<span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">设置</span>key1<span style="color:#960050;background-color:#1e0010">的值为</span>lx<span style="color:#960050;background-color:#1e0010">，过期时间为</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">秒，</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">秒后</span>key1<span style="color:#960050;background-color:#1e0010">清除</span><span style="color:#f92672">(</span>key <span style="color:#960050;background-color:#1e0010">也清除</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SETRANG STRING range value <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">替换字符串</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">、取值语法：</span>
</span></span><span style="display:flex;"><span>	GET KEY_NAME <span style="color:#f92672">:</span> Redis GET <span style="color:#960050;background-color:#1e0010">命令用于获取指定</span> key <span style="color:#960050;background-color:#1e0010">的值。如果</span> key <span style="color:#960050;background-color:#1e0010">不存在，返回</span> nil<span style="color:#960050;background-color:#1e0010">。如果</span>key<span style="color:#960050;background-color:#1e0010">存储的值不是字符串类型，返回一个错误。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  GETRANGE  key start end <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">用于获取存储在指定</span>key<span style="color:#960050;background-color:#1e0010">中字符串的子字符串。字符串的截取范围由</span> start <span style="color:#960050;background-color:#1e0010">和</span> end <span style="color:#960050;background-color:#1e0010">两个偏移量来决定</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">包括</span> start <span style="color:#960050;background-color:#1e0010">和</span> end <span style="color:#960050;background-color:#1e0010">在内</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	GETBIT key offset <span style="color:#960050;background-color:#1e0010">：对</span> key <span style="color:#960050;background-color:#1e0010">所存储的字符串值，获取指定偏移量上的为</span><span style="color:#f92672">(</span>bit<span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">；</span>
</span></span><span style="display:flex;"><span>GETTEST<span style="color:#960050;background-color:#1e0010">语法</span> <span style="color:#960050;background-color:#1e0010">：</span> GETSET KEY_NAME VALUE <span style="color:#f92672">:</span> GETSET <span style="color:#960050;background-color:#1e0010">命令用于设置指定</span> key <span style="color:#960050;background-color:#1e0010">的值，并返回</span>key<span style="color:#960050;background-color:#1e0010">的旧值。当</span>key<span style="color:#960050;background-color:#1e0010">不存在是，返回</span> nil
</span></span><span style="display:flex;"><span>	STRLEN key <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">返回</span> key <span style="color:#960050;background-color:#1e0010">所存储的字符串值的长度</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">、删除语法：</span>
</span></span><span style="display:flex;"><span>DEL KEY_NAME <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">删除指定的</span>key<span style="color:#960050;background-color:#1e0010">，如果存在，返回数字类型。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">、批量写：</span>MSET K1 V1 K2 V2 <span style="color:#f92672">...</span> <span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">一次性写入多个值</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span><span style="color:#960050;background-color:#1e0010">、批量读：</span>MGET K1 K2 K3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7</span><span style="color:#960050;background-color:#1e0010">、</span>GETSET NAME VALUE <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">一次性设置和读取</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">返回旧值，写上新值</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">、自增</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">自减：</span>
</span></span><span style="display:flex;"><span>  INCR KEY_Name <span style="color:#f92672">:</span> Incr <span style="color:#960050;background-color:#1e0010">命令将</span>key<span style="color:#960050;background-color:#1e0010">中存储的数组值增</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">。如果</span> key <span style="color:#960050;background-color:#1e0010">不存在，那么</span>key<span style="color:#960050;background-color:#1e0010">的值会先被初始化为</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">，然后在执行</span>INCR<span style="color:#960050;background-color:#1e0010">操作</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">自增</span><span style="color:#f92672">:</span> INCRBY KEY_Name <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">增量值</span>Incrby <span style="color:#960050;background-color:#1e0010">命令将</span>key<span style="color:#960050;background-color:#1e0010">中存储的数字加上指定的增量值</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">自减</span><span style="color:#f92672">:</span> DECR KEY_Name <span style="color:#960050;background-color:#1e0010">或</span> DECYBY KEY_NAME <span style="color:#960050;background-color:#1e0010">减值：</span>DECR <span style="color:#960050;background-color:#1e0010">命令将</span>key<span style="color:#960050;background-color:#1e0010">中存储的数字减少</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">：</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">注意这些</span>key<span style="color:#960050;background-color:#1e0010">对应的必须是数字类型字符串，否则会出错。</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">字符串拼接：</span>APPEND  KEY_NAME VALUE
</span></span><span style="display:flex;"><span><span style="color:#f92672">:</span>Append <span style="color:#960050;background-color:#1e0010">命令用于为指定的</span>key<span style="color:#960050;background-color:#1e0010">追加至末尾，如果不存在，为其赋值</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">字符串长度</span> <span style="color:#960050;background-color:#1e0010">：</span>STRLEN key
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">##########################</span>    
</span></span><span style="display:flex;"><span> setex   <span style="color:#f92672">(</span>set with expire<span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">#设置过期时间</span>
</span></span><span style="display:flex;"><span> setnx   <span style="color:#f92672">(</span>set <span style="color:#66d9ef">if</span> not exist<span style="color:#f92672">)</span> <span style="color:#960050;background-color:#1e0010">#不存在设置</span> <span style="color:#960050;background-color:#1e0010">在分布式锁中会常常使用！</span>
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><h5 id="102-应用场景">10.2 应用场景<a hidden class="anchor" aria-hidden="true" href="#102-应用场景">#</a></h5>
<ul>
<li>
<p><strong>1、String通常用于保存单个字符串或JSON字符串数据</strong></p>
</li>
<li>
<p><strong>2、因String是二进制安全的，所以你完全可以把一个图片文件的内容作为字符串来存储</strong></p>
</li>
<li>
<p><strong>3、计数器(常规key-value缓存应用。常规计数：微博数，粉丝数)</strong></p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>INCR 等指令本身就具有原子操作的特定，所以我们完全可以利用redis的INCR，INCRBY,DECR,DECRBY等指令来实现原子计数的效果。假如，在某种场景下有3个客户端同时读取了mynum的值<span style="color:#f92672">(</span>值为2<span style="color:#f92672">)</span>，然后对其同时进行了加1的操作，那么，最后mynum的值一定是5。
</span></span><span style="display:flex;"><span>不少网站都利用redis的这个特性来实现业务上的统计计数需求。
</span></span></code></pre></div><h5 id="103-hash类型">10.3 Hash类型<a hidden class="anchor" aria-hidden="true" href="#103-hash类型">#</a></h5>
<p>Hash类型是String类型的field和value的映射表，或者说是一个String集合。hash特别适合用于存储对象，相比较而言，将一个对象类型存储在Hash类型要存储在String类型里占用更少的内存空间，并对整个对象的存取。可以看成具有KEY和VALUE的MAP容器，该类型非常适合于存储值对象的信息。</p>
<p>如：uname，upass，age等。该类型的数据仅占用很少的磁盘空间(相比于JSON).</p>
<p>Redis 中每一个hash 可以存储 2的32次方 -1 键值对(40 多亿)</p>
<h5 id="104-hash命令">10.4 Hash命令<a hidden class="anchor" aria-hidden="true" href="#104-hash命令">#</a></h5>
<p>常用命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">一、赋值语法：</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">、</span> HSET KEY FIELD VALUE   <span style="color:#960050;background-color:#1e0010">：</span> <span style="color:#960050;background-color:#1e0010">为指定的</span>KEY<span style="color:#f92672">,</span><span style="color:#960050;background-color:#1e0010">设定</span>FILD<span style="color:#f92672">/</span>VALUE
</span></span><span style="display:flex;"><span>	<span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">、</span> HMSET KEY FIELD VALUE <span style="color:#f92672">[</span>FIELD1<span style="color:#960050;background-color:#1e0010">，</span>VALUE<span style="color:#f92672">]...</span> <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">同时将多个</span> field<span style="color:#f92672">-</span>value<span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">域</span><span style="color:#f92672">-</span><span style="color:#960050;background-color:#1e0010">值</span><span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">对设置到哈希表</span>key<span style="color:#960050;background-color:#1e0010">中。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">二、取值语法：</span>
</span></span><span style="display:flex;"><span>    HGET KEY FIELD  <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">获取存储在</span>HASH<span style="color:#960050;background-color:#1e0010">中的值，根据</span>FIELD<span style="color:#960050;background-color:#1e0010">得到</span>VALUE
</span></span><span style="display:flex;"><span>    HMGET KEY FIELD <span style="color:#f92672">[</span>FIELD1<span style="color:#f92672">]</span>   <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">获取</span>key<span style="color:#960050;background-color:#1e0010">所有给定字段的值</span>
</span></span><span style="display:flex;"><span>    HGETALL KEY     <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">返回</span>HASH<span style="color:#960050;background-color:#1e0010">表中所有的字段和值</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span> HKEYS KEY <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">获取所有哈希表中的字段</span>
</span></span><span style="display:flex;"><span> HLEN  KEY <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">获取哈希表中字段的数量</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">三、删除语法：</span>
</span></span><span style="display:flex;"><span>     HDEL KEY FIELD<span style="color:#f92672">[</span>FIELD2<span style="color:#f92672">]</span>  <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">删除一个或多个</span>HASH<span style="color:#960050;background-color:#1e0010">表字段</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">四、其它语法：</span>
</span></span><span style="display:flex;"><span>     HSETNX KEY FIELD VALUE <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">只有在字段</span>field <span style="color:#960050;background-color:#1e0010">不存在时，设置哈希表字段的值</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>     HINCRBY KEY FIELD INCREMENT <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">为哈希</span>key<span style="color:#960050;background-color:#1e0010">中的指定字段的整数值加上增量</span> increment<span style="color:#960050;background-color:#1e0010">。</span>
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>     HINCRBYFLOAT KEY FIELD INCREMENT  <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">为哈希表</span>key <span style="color:#960050;background-color:#1e0010">中的指定字段的浮点数值加上增量</span> increment
</span></span><span style="display:flex;"><span>         
</span></span><span style="display:flex;"><span>     HEXISTS KEY FIELD  <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">查看哈希表中</span>key<span style="color:#960050;background-color:#1e0010">中，指定的字段是否存在</span>  
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200804213506025.png" alt="image-20200804213506025"  />
</p>
<h5 id="105-应用场景">10.5 应用场景<a hidden class="anchor" aria-hidden="true" href="#105-应用场景">#</a></h5>
<p><strong>Hash的应用场景 ：(存储一个用户信息对象数据)</strong></p>
<ul>
<li>
<p><strong>常用于存储一个对象</strong></p>
</li>
<li>
<p><strong>为什么不用string存储一个对象</strong></p>
<p>hash值最接近关系数据库结构的数据类型，可以将数据库一条记录或程序中一个对象转换成hashmap存放在redis中。</p>
<p>用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息，如果用普通的key/value结构来存储，主要有一下2中村粗方式：</p>
<p>​		第一种方式将用户ID作为查找key，把其他信息封装成为一个对象以序列化的方式存储，这种方式的却但是，增加了序列化/反序列化的开销，并且在需要修改其中一项信息时，需要把整个对象取回，并且修改操作需要对并发进行保护，引入CAS等复杂问题。</p>
<p>​      第二种方法是这个用户信息对象有多少成员就存成多少个key-value对儿，用用户ID+对应属性的名称作为唯一标识来取的对应属性的值，虽然省去了序列化开销和并发问题，但是用户ID重复存储，如果存在大量这样的数据，内存浪费还是非常可观的。</p>
<h5 id="106-总结">10.6 总结：<a hidden class="anchor" aria-hidden="true" href="#106-总结">#</a></h5>
<p>Redis提供的Hash很好的解决了这个问题，Redis的Hash实际内部存储的Value为一个HashMap，</p>
</li>
</ul>
<h5 id="106-list类型">10.6 List类型<a hidden class="anchor" aria-hidden="true" href="#106-list类型">#</a></h5>
<p><strong>简介：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>1、   List 类型是一个链表结构的集合，其主要功能有push、pop、获取元素等。更详细的说，List类型是一个双端链表的节后，我们可以通过相关的操作进行集合的头部或者尾部添加和删除元素，List的设计是非常简单精巧，即可以最为栈，有可以最为队列，满足绝大多数的需求。
</span></span></code></pre></div><p><strong>常用命令</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">1、赋值语法：</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">LPUSH</span> <span style="color:#e6db74">KEY VALUE1 [VALUE2] :将一个或多个值插入到列表头部（从左侧添加）</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">RPUSH</span> <span style="color:#e6db74">KEY VALUE1 [VALUE2] ：在列表中添加一个或多个值（从有侧添加）</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">LPUSHX</span> <span style="color:#e6db74">KEY VAKUE :将一个值插入到已存在的列表头部。如果列表不在，操作无效</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">RPUSHX</span> <span style="color:#e6db74">KEY VALUE :一个值插入已经在的列表尾部（最右边）。如果列表不在，操作无效</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">2、取值语法：</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">LLEN</span> <span style="color:#e6db74">KEY   :获取列表长度</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">LINDEX</span> <span style="color:#e6db74">KEY INDEX	:通过索引获取列表中的元素</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">LRANGE</span> <span style="color:#e6db74">KEY START STOP	:获取列表指定范围内的元素</span>
</span></span></code></pre></div><p>描述：返回列表中指定区间的元素，区间以偏移量START和END指定。</p>
<p>其中0表示列表的第一个元素，1表示列表的第二个元素，以此类推。。。</p>
<p>也可以使用负数下标，以-1表示列表的最后一个元素，-2表示列表的倒数第二个元素，一次类推。。。</p>
<p>start：页大小（页数-1）</p>
<p>stop：（页大小页数）-1</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">3、删除语法：</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">LPOP</span> <span style="color:#e6db74">KEY :移除并获取列表的第一个元素（从左侧删除）</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">RPOP</span> <span style="color:#e6db74">KEY :移除列表的最后一个元素，返回值为移除的元素（从右侧删除）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">BLPOP</span> <span style="color:#e6db74">key1 [key2]timeout :移除并获取列表的第一个元素，如果列表没有元素会阻塞列表知道等待超时或发现可弹出元素为止。</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">4、修改语法：</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">LSET</span> <span style="color:#e6db74">KEY INDEX VALUE :通过索引设置列表元素的值</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">LINSERT</span> <span style="color:#e6db74">KEY BEFORE|AFTER WORIL VALUE :在列表的元素前或者后 插入元素 描述：将值 value 插入到列表key当中，位于值world之前或之后。</span>
</span></span></code></pre></div><p><strong>高级命令</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">高级语法：</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">RPOPLPUSH</span> <span style="color:#e6db74">source destiation : 移除列表的最后一个元素，并将该元素添加到另外一个列表并返回</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">	示例描述：</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">RPOPLPUSH</span> <span style="color:#e6db74">a1  a2  : a1的最后元素移到a2的左侧</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">RPOPLPUSH</span> <span style="color:#e6db74">a1  a1  : 循环列表，将最后元素移到最左侧</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">BRPOPLPUSH</span> <span style="color:#e6db74">source destination timeout  :从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它；如果列表没有元素会阻塞列表知道等待超时或发现可弹出的元素为止。</span>
</span></span></code></pre></div><p><strong>List代码案例</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.tyx.service.impl<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tyx.po.User<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.extern.slf4j.Slf4j<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.core.RedisTemplate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Service<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.util.CollectionUtils<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.Serializable<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Collections<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.TimeUnit<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author papi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @data 2020/7/15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserServiceImpl</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> redisTemplate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Redis有什么命令，Jedis有什么方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Lettuce-----》RedisTemplate进一步的封装
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *RedisTemplate 方法和命令是肯定不一样的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Redis 和 String类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 需求输入一个key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 先判断该key是否存在如果不存在则在mysql中进行查询，写入到redis中。并返回值。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getRedisValueByKey</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">hasKey</span><span style="color:#f92672">(</span>key<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//表示存在值，进行获取
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-------&gt; redis中查询的数据&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            Object o <span style="color:#f92672">=</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span> o<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//不存在去mysql中查并且赋值给reids
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            String val <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;redis中不存在的key&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;------&gt;mysql中查询出来的：&#34;</span><span style="color:#f92672">+</span>val<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>val<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;------&gt;mysql中查出的数据存入redis中&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> val<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 测试String类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 需求：用户输入一个redis数据。该key的有效期为28小时
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">expireStr</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String val<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>val<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">expire</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span>TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">HOURS</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 根据ID查询用户对象信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *  先判断redis中是否存在该key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *  如果不存在，查询数据库中mysql中的值，并将结果添加到redis中。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *  如果存在，直接将结果在redis查询，并返回。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> User <span style="color:#a6e22e">getHashKey</span><span style="color:#f92672">(</span>String id<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">hasKey</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span>id<span style="color:#f92672">)){</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-----&gt;查询redis数据库&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>User<span style="color:#f92672">)</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span>id<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-----&gt;查询mysql数据库&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            User user <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            user<span style="color:#f92672">.</span><span style="color:#a6e22e">setId</span><span style="color:#f92672">(</span>id<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            user<span style="color:#f92672">.</span><span style="color:#a6e22e">setAge</span><span style="color:#f92672">(</span><span style="color:#ae81ff">18</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            user<span style="color:#f92672">.</span><span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;速速&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                @param  h  用户的实体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                @param  hk 用户主键id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                @param  hv 整个对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span>id<span style="color:#f92672">,</span>user<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> user<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 将list放入缓存中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param list 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true 成功 false 失败
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lpushAll</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">leftPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> list<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 将list放入缓存中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param list 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time 时间（秒）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true 成功 false 失败
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lpushAll</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> time<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">leftPushAll</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> list<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>time <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>                redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">expire</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>time<span style="color:#f92672">,</span>TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 在变量左边添加元素。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param obj
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lpush</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object obj<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">leftPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>obj<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 在变量左边添加元素。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param prvot 中间参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param object 要放的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lpush</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object prvot<span style="color:#f92672">,</span>Object object<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">leftPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>prvot<span style="color:#f92672">,</span>object<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 在变量左边添加元素。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param prvot 中间参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param object 要放的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">rpush</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object prvot<span style="color:#f92672">,</span>Object object<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>prvot<span style="color:#f92672">,</span>object<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 在变量左边添加元素。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param object 要放的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">rpush</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object object<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>object<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 在变量左边添加元素。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param object 要放的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lpushIfPresent</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object object<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">leftPushIfPresent</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>object<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 移除集合中的左边第一个集合
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 返回右边第一个值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">lpop</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">leftPop</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 移除集合中的右边的元素，一般用在队列取值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 返回右边的元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">rpop</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">leftPop</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 获取指定区间的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param start 开始位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param end 结束位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 返回值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">lrange</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> start<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> end<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">range</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>start<span style="color:#f92672">,</span>end<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 返回当前位置上的值。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param index 当前位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">lindex</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">index</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>index<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key  键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param count 统计
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param object 移除的对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span><span style="color:#66d9ef">long</span> count<span style="color:#f92672">,</span> Object object<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>count<span style="color:#f92672">,</span>object<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 获取集合长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">llen</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 在集合的指定位置插入元素，如果指定的位置已有元素，则覆盖，没有则新增，超过集合的下标+n则会报错；
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param index 位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span>Long index<span style="color:#f92672">,</span> Object value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 截取集合元素，保留成都内地数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param start 开始位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param end 结束位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">trim</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span>Long start<span style="color:#f92672">,</span> Long end<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">trim</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>start<span style="color:#f92672">,</span>end<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *出去集合右边的值，同时集合的左边添加一个值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param str 入栈的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 返回对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">rightPopAndleftPush</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span>String str<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPopAndLeftPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>str<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *出去集合右边的值，同时集合的左边添加一个值,如果超过等待的时间仍然没有元素则退出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param str 左边新增的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time 超时时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 返回移除右边的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">rightPopAndleftPush</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span>String str<span style="color:#f92672">,</span><span style="color:#66d9ef">long</span> time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPopAndLeftPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>str<span style="color:#f92672">,</span>time<span style="color:#f92672">,</span>TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">MINUTES</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 删除.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param keys
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">del</span><span style="color:#f92672">(</span>String <span style="color:#f92672">...</span> keys<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>keys<span style="color:#f92672">!=</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> keys<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>keys<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">delete</span><span style="color:#f92672">(</span>keys<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">delete</span><span style="color:#f92672">(</span>CollectionUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">arrayToList</span><span style="color:#f92672">(</span>keys<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 设置过期时间。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param seconds 过期时间。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">expire</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span><span style="color:#66d9ef">long</span> seconds<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">expire</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>seconds<span style="color:#f92672">,</span>TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h5 id="107-list-的应用场景">10.7 List 的应用场景<a hidden class="anchor" aria-hidden="true" href="#107-list-的应用场景">#</a></h5>
<p><strong>项目应用于：1、对数据量大的集合数据删除；2、任务队列</strong></p>
<p><strong>1、对数据量大的集合数据删减</strong></p>
<p>​	列表数据显示，关注列表，粉丝列表，留言评论等&hellip;..分页，热点新闻等</p>
<p>利用LRANG还可以很方便的实现分页的功能，在博客系统中，每片博文的评论也可以存入一个单独的list中。</p>
<p><strong>2、任务队列</strong></p>
<p>(list 通常用来实现一个消息队列，而且可以却表先后顺序，不必像MySQL那样还需要通过ORDER BY来进行排序)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">任务队列介绍</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">生产者和消费者模式：</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">在处理</span>web<span style="color:#960050;background-color:#1e0010">客户端发送的命令请求是，某些操作的执行时间可能会比我们预期的更长一些，通过将待执行任务的相关信息放入队列里面，并在之后队列进行处理，用户可以推迟执行那些需要一段时间才能完成的操作，这种将工作交个任务处理器来执行的做法被称为任务队列（</span>task queue<span style="color:#960050;background-color:#1e0010">）。</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>RPOPLPUSH source destination
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">移除列表的最后一个元素，并将该元素添加到另一个列表并返回</span>
</span></span></code></pre></div><p><strong>3、List应用场景案例1</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"></code></pre></div><h5 id="108-set类型">10.8 Set类型<a hidden class="anchor" aria-hidden="true" href="#108-set类型">#</a></h5>
<p><strong>简介</strong></p>
<p>​	Redis的Set是String类型的无需集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。Redis中集合是通过哈希表实现的，set是通过hashtable实现的</p>
<p>集合中最大的成员数为2^32 -1,类似于JAVA中的Hashtable集合。</p>
<p><strong>命令</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">、复制语法：</span>
</span></span><span style="display:flex;"><span>    SADD KEY member1 <span style="color:#f92672">[</span>member2<span style="color:#f92672">]:</span><span style="color:#960050;background-color:#1e0010">向集合添加一个或多个成员</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">、取值语法：</span>
</span></span><span style="display:flex;"><span>    SCARD KEY <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">获取集合的成员数</span>
</span></span><span style="display:flex;"><span>    SMEMBERS KEY <span style="color:#960050;background-color:#1e0010">：返回集合中的所有成员</span>
</span></span><span style="display:flex;"><span>    SISMEMBER  KEY  MEMBER  <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">判断</span>member<span style="color:#960050;background-color:#1e0010">元素是否是集合</span>key<span style="color:#960050;background-color:#1e0010">的成员</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">开发中：验证是否存在判断</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    SRANDMEMBER KEY <span style="color:#f92672">[</span>COUNT<span style="color:#f92672">]</span> <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">返回集合中一个或对个随机数</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">、删除语法：</span>
</span></span><span style="display:flex;"><span>      SREM key member1 <span style="color:#f92672">[</span>member2<span style="color:#f92672">]</span> <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">移除集合中一个或多个成员</span>
</span></span><span style="display:flex;"><span>      SPOP key <span style="color:#f92672">[</span>count<span style="color:#f92672">]</span> <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">移除并返回集合中的一个随机元素</span>
</span></span><span style="display:flex;"><span>      SMOVE source destination member <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">将</span>member <span style="color:#960050;background-color:#1e0010">元素从</span>Source<span style="color:#960050;background-color:#1e0010">集合移动到</span>destination<span style="color:#960050;background-color:#1e0010">集合中</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">、差集语言：</span>
</span></span><span style="display:flex;"><span>   SDIFF  key1  <span style="color:#f92672">[</span>key2<span style="color:#f92672">]</span>  <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">返回给定所有集合的差集</span>
</span></span><span style="display:flex;"><span>   SDIFFSTORE destination key1 <span style="color:#f92672">[</span>key2<span style="color:#f92672">]</span>  <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">返回给定所有集合的茶几并存储在</span>destination<span style="color:#960050;background-color:#1e0010">中</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">、交集语言：</span>          
</span></span><span style="display:flex;"><span>    SUNION key1 <span style="color:#f92672">[</span>key2<span style="color:#f92672">]</span> <span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">返回所有给定集合的并集</span>
</span></span><span style="display:flex;"><span>    SUNIONSTORE destination key1 <span style="color:#f92672">[</span>key2<span style="color:#f92672">]</span> <span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">所有给定集合的并集存储在</span> destinatiion<span style="color:#960050;background-color:#1e0010">集合中</span>                              
</span></span></code></pre></div><h5 id="109-zset类型">10.9 ZSet类型<a hidden class="anchor" aria-hidden="true" href="#109-zset类型">#</a></h5>
<p>有序集合(sorted set)</p>
<p><strong>简介</strong></p>
<p>1、Redis有序集合和集合一样也是string类型元素的集合，且不允许重复的成员。</p>
<p>2、不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<p>3、有序集合的成员是唯一的，但分数（score）却可以重复。</p>
<p>4、集合是通过哈希表实现的。集合中最大的成员数为2^32 -1。Redis的ZSet是有序，且不重复。</p>
<p>（很多时候，我们都将redis中的有序结合叫做zsets，这是因为在redis中，有序集合相关的操作指令都是以z开头的）</p>
<p><strong>命令</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>1、复制语法：
</span></span><span style="display:flex;"><span>	ZADD KEY score1 member1 【score2 member2】  ：向有序集合添加一个或多个成员，或者更新已经存在成员的分数
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2、取值语法：
</span></span><span style="display:flex;"><span>	ZCARD key ：获取有序结合的成员数
</span></span><span style="display:flex;"><span>  ZCOUNT key min max :计算在有序结合中指定区间分数的成员数
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	127.0.0.1:6379&gt; ZADD kim 1 tian
</span></span><span style="display:flex;"><span>	(integer) 0
</span></span><span style="display:flex;"><span>	127.0.0.1:6379&gt; zadd kim 2 yuan 3 xing
</span></span><span style="display:flex;"><span>	(integer) 2
</span></span><span style="display:flex;"><span>	127.0.0.1:6379&gt; zcount kim 1 2
</span></span><span style="display:flex;"><span>	(integer) 2
</span></span><span style="display:flex;"><span>	127.0.0.1:6379&gt; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ZRANK  key member  :返回有序集合中指定成员的所有
</span></span><span style="display:flex;"><span>  ZRANGE KEY START STOP  [WITHSCORES]:通过索引区间返回有序集合成指定区间内的成员(低到高)
</span></span><span style="display:flex;"><span>	ZRANGEBYSCORE KEY MIN MAX [WITHSCORES] [LIMIT] :通过分数返回有序集合指定区间内的成员
</span></span><span style="display:flex;"><span>	ZREVRANGE KEY START STOP [WITHSCORES] :返回有序集中是定区间内的成员，通过索引，分数从高到底
</span></span><span style="display:flex;"><span>	ZREVERANGEBYSCORE KEY MAX MIN [WITHSCORES] :返回有序集中指定分数区间的成员，分数从高到低排序
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>删除语法：
</span></span><span style="display:flex;"><span>	DEL KEY   : 移除集合
</span></span><span style="display:flex;"><span>	ZREM key member [member...] 移除有序集合中的一个或多个成员
</span></span><span style="display:flex;"><span>	ZREMRANGEBYSCORE KEY MIN MAX  :移除有序集合中给定的分数区间的所有成员。
</span></span><span style="display:flex;"><span>	ZREMRANGEBYSCORE KEY MIN MAX  :移除有序集合中给定的分数区间的所有成员。
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>ZINCRBY KEY INCREMENT MEMBER :增加member元素的分数increment，返回值是更改后的分数
</span></span></code></pre></div><h5 id="1010-hyperloglog">10.10 HyperLogLog<a hidden class="anchor" aria-hidden="true" href="#1010-hyperloglog">#</a></h5>
<p><strong>常用命令</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>PFADD key element [element ...] : 添加指定元素到HyperLoglog中
</span></span><span style="display:flex;"><span>PFCOUNT KEY [key ...] :返回给定 HyperLogLog的基数估算值
</span></span><span style="display:flex;"><span>PFMERGE destkey sourcekey [sourcekey ...] :将过个HyperLogLog 合并为一个HyperLoglog
</span></span></code></pre></div><p><strong>应用场景</strong></p>
<p>基数不大，数据量不大就用不上，会有点大材小用浪费空间</p>
<p>有局限性，就是指能统计基数数量，而没办法去知道具体的内容是什么</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>统计注册 IP 数
</span></span><span style="display:flex;"><span>统计每日访问 IP 数
</span></span><span style="display:flex;"><span>统计页面实时 UV 数
</span></span><span style="display:flex;"><span>统计在线用户数
</span></span><span style="display:flex;"><span>统计用户每天搜索不同词条的个数
</span></span><span style="display:flex;"><span>统计真实文章阅读数
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200722003520767.png" alt="#####"  />
</p>
<h5 id="1011-geospatial-地理位置">10.11 geospatial 地理位置<a hidden class="anchor" aria-hidden="true" href="#1011-geospatial-地理位置">#</a></h5>
<p>GEORANDIUSBYMEMBER  找出指定元素周围的其他元素</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200805112212991.png" alt="image-20200805112212991"  />
</p>
<h4 id="十一springboot整合jedis">十一、SpringBoot整合Jedis<a hidden class="anchor" aria-hidden="true" href="#十一springboot整合jedis">#</a></h4>
<h5 id="111-简介">11.1 简介<a hidden class="anchor" aria-hidden="true" href="#111-简介">#</a></h5>
<p>​		我们在使用springboot搭建微服务的时候，在很多时候还是需要redis的高速缓存来缓存一些数据，存储一些高品率访问的数据，如果直接使用redis的话由比较麻烦，在这里，我们使用jedis来实现redis缓存达到高效缓存的目的。</p>
<h5 id="112-引入jedis依赖">11.2 引入Jedis依赖<a hidden class="anchor" aria-hidden="true" href="#112-引入jedis依赖">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>redis.clients<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>jedis<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;version&gt;</span>3.2.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>因为SpringBoot内默认引用了jedis版本。</p>
<p>所以我们直接引入jedis依赖无需配置jedis的版本号了。</p>
<h5 id="113-applicationyml">11.3 application.yml<a hidden class="anchor" aria-hidden="true" href="#113-applicationyml">#</a></h5>
<p>例如 在application.yml中配置如下信息：</p>
<h4 id="十二springboot2x中redis使用lettuce">十二、SpringBoot2.x中redis使用（lettuce）<a hidden class="anchor" aria-hidden="true" href="#十二springboot2x中redis使用lettuce">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>java代码操作Redis，需要使用Jedis，也就是redis支持java的第三方类库
</span></span><span style="display:flex;"><span>注意：Jedis2.7以上的版本才支持集群操作
</span></span></code></pre></div><h5 id="121-maven配置">12.1 maven配置<a hidden class="anchor" aria-hidden="true" href="#121-maven配置">#</a></h5>
<p>新建SpringBoot2.0.3的WEB工程，在MAVEN的pom.xml文件中加入如下依赖</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;project</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;modelVersion&gt;</span>4.0.0<span style="color:#f92672">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;version&gt;</span>2.3.1.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;relativePath/&gt;</span> <span style="color:#75715e">&lt;!-- lookup parent from repository --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>com.tyx<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>lettuce-demo<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;version&gt;</span>0.0.1-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;name&gt;</span>lettuce-demo<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;description&gt;</span>Demo project for Spring Boot<span style="color:#f92672">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;java.version&gt;</span>1.8<span style="color:#f92672">&lt;/java.version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- 默认是lettuce客户端 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- redis依赖common-pool 这个依赖一定要添加 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.commons<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>commons-pool2<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>2.8.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-devtools<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.projectlombok<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>lombok<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;exclusions&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;exclusion&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&lt;groupId&gt;</span>org.junit.vintage<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&lt;artifactId&gt;</span>junit-vintage-engine<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;/exclusion&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/exclusions&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;build&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;plugins&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/plugins&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/build&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/project&gt;</span>
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200414004122171.png" alt="image-20200715231230345"  />
</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200715231337580.png" alt="image-20200715231337580"  />
</p>
<h5 id="122-视频中的代码">12.2 视频中的代码<a hidden class="anchor" aria-hidden="true" href="#122-视频中的代码">#</a></h5>
<p><strong>POM文件</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;project</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0&#34;</span> <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;modelVersion&gt;</span>4.0.0<span style="color:#f92672">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;version&gt;</span>2.3.1.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;relativePath/&gt;</span> <span style="color:#75715e">&lt;!-- lookup parent from repository --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>com.tyx<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>lettuce-demo<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;version&gt;</span>0.0.1-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;name&gt;</span>lettuce-demo<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;description&gt;</span>Demo project for Spring Boot<span style="color:#f92672">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;java.version&gt;</span>1.8<span style="color:#f92672">&lt;/java.version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- 默认是lettuce客户端 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- redis依赖common-pool 这个依赖一定要添加 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.commons<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>commons-pool2<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>2.8.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-devtools<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.projectlombok<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>lombok<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;exclusions&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;exclusion&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&lt;groupId&gt;</span>org.junit.vintage<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&lt;artifactId&gt;</span>junit-vintage-engine<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;/exclusion&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/exclusions&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;build&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;plugins&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/plugins&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/build&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/project&gt;</span>
</span></span></code></pre></div><p><strong>RedisConfig</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.tyx.config<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.cache.annotation.CachingConfigurerSupport<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Bean<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.core.RedisTemplate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.serializer.StringRedisSerializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Component<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.Serializable<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author papi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @data 2020/7/15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RedisConfig</span>  <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">redisTemplate</span><span style="color:#f92672">(</span>LettuceConnectionFactory factory<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> redisTemplate <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RedisTemplate<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setKeySerializer</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> StringRedisSerializer<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setValueSerializer</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> GenericJackson2JsonRedisSerializer<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">setConnectionFactory</span><span style="color:#f92672">(</span>factory<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>User</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> com.tyx.po<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Data<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.Serializable<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author papi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @data 2020/7/15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Java常用编码规范
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Java规范
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> age<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String id<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>UserServiceImpl</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.tyx.service.impl<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tyx.po.User<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.extern.slf4j.Slf4j<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.core.RedisTemplate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Service<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.Serializable<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.TimeUnit<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author papi
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @data 2020/7/15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserServiceImpl</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> redisTemplate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Redis有什么命令，Jedis有什么方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Lettuce-----》RedisTemplate进一步的封装
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *RedisTemplate 方法和命令是肯定不一样的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * Redis 和 String类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 需求输入一个key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 先判断该key是否存在如果不存在则在mysql中进行查询，写入到redis中。并返回值。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getRedisValueByKey</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">hasKey</span><span style="color:#f92672">(</span>key<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//表示存在值，进行获取
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-------&gt; redis中查询的数据&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            Object o <span style="color:#f92672">=</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span> o<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//不存在去mysql中查并且赋值给reids
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            String val <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;redis中不存在的key&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;------&gt;mysql中查询出来的：&#34;</span><span style="color:#f92672">+</span>val<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>val<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;------&gt;mysql中查出的数据存入redis中&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> val<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 测试String类型
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 需求：用户输入一个redis数据。该key的有效期为28小时
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">expireStr</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String val<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span>val<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">expire</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span>TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">HOURS</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 根据ID查询用户对象信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *  先判断redis中是否存在该key
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *  如果不存在，查询数据库中mysql中的值，并将结果添加到redis中。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *  如果存在，直接将结果在redis查询，并返回。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> User <span style="color:#a6e22e">getHashKey</span><span style="color:#f92672">(</span>String id<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">hasKey</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span>id<span style="color:#f92672">)){</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-----&gt;查询redis数据库&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>User<span style="color:#f92672">)</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span>id<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-----&gt;查询mysql数据库&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            User user <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            user<span style="color:#f92672">.</span><span style="color:#a6e22e">setId</span><span style="color:#f92672">(</span>id<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            user<span style="color:#f92672">.</span><span style="color:#a6e22e">setAge</span><span style="color:#f92672">(</span><span style="color:#ae81ff">18</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            user<span style="color:#f92672">.</span><span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;速速&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                @param  h  用户的实体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                @param  hk 用户主键id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                @param  hv 整个对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span>id<span style="color:#f92672">,</span>user<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> user<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>测试类</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.tyx<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tyx.po.User<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tyx.service.impl.UserServiceImpl<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.AllArgsConstructor<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.jupiter.api.Test<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.test.context.SpringBootTest<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SpringBootTest</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LettuceDemoApplicationTests</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> UserServiceImpl userService<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">contextLoads</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">T1</span> <span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        String tyx <span style="color:#f92672">=</span> userService<span style="color:#f92672">.</span><span style="color:#a6e22e">getRedisValueByKey</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tyx&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;返回redis中的值为：&#34;</span> <span style="color:#f92672">+</span> tyx<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">T2</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        User hashKey <span style="color:#f92672">=</span> userService<span style="color:#f92672">.</span><span style="color:#a6e22e">getHashKey</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1003&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>hashKey<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h5 id="123-查看redis客户端信息">12.3 查看Redis客户端信息<a hidden class="anchor" aria-hidden="true" href="#123-查看redis客户端信息">#</a></h5>
<p>原因：把任何数据保存到redis中时，<strong>都需要进行序列化</strong>，默认使用JdkSerializationRedisSerializer进行数据序列化。所有的key和value还有hashkey和hashvalue的原始字符前，都加了一串字符。</p>
<h4 id="十三redis的发布订阅">十三、Redis的发布订阅<a hidden class="anchor" aria-hidden="true" href="#十三redis的发布订阅">#</a></h4>
<h5 id="131-redis发布订阅简介">13.1 redis发布订阅简介<a hidden class="anchor" aria-hidden="true" href="#131-redis发布订阅简介">#</a></h5>
<p>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者（pub）发送消息，订阅者（sub)接受消息。</p>
<p>Redis客户端可以订阅任意数量的频道</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者（pub）发送消息，订阅者（sub)接受消息。
</span></span><span style="display:flex;"><span>Redis 客户端可以订阅任意数量的频道。
</span></span><span style="display:flex;"><span>下图展示了频道channel1，以及订阅这个频道的三个客户端---client2，client5和client1之间的关系。
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200722224456077.png" alt="image-20200722224456077"  />
</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200809152404791.png" alt="image-20200809152404791"  />
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">//订阅端</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SUBSCRIBE</span> <span style="color:#e6db74">redischannel</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Reading</span> <span style="color:#e6db74">messages ...(press  ctrl-c quit)</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">//发送端</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">PUBLIC</span> <span style="color:#e6db74">redischannel &#34;redis channel&#34;</span>
</span></span></code></pre></div><h4 id="十四redis多数据库">十四、Redis多数据库<a hidden class="anchor" aria-hidden="true" href="#十四redis多数据库">#</a></h4>
<h5 id="141-redis下数据库是由一个整数索引标识而不是一个数据库名称默认情况下一个客户端连接到数据库0">14.1 Redis下，数据库是由一个整数索引标识，而不是一个数据库名称。默认情况下，一个客户端连接到<strong>数据库0</strong>。<a hidden class="anchor" aria-hidden="true" href="#141-redis下数据库是由一个整数索引标识而不是一个数据库名称默认情况下一个客户端连接到数据库0">#</a></h5>
<p>redis配置问阿金中下面的参数来控制数据库总数：</p>
<p>database 16  //（从0开始 1,2,3&hellip;15）</p>
<p><strong>select  数据库</strong>  //数据库的切换</p>
<p><strong>移动数据(将当前key移动另一库)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>move key 名称  数据库
</span></span></code></pre></div><h5 id="142-数据库清空">14.2 数据库清空：<a hidden class="anchor" aria-hidden="true" href="#142-数据库清空">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>flushdb  ：清除当前数据库的所有key
</span></span><span style="display:flex;"><span>flushall :清除整个redis的数据库所有key
</span></span></code></pre></div><h4 id="十五redis事务">十五、Redis事务<a hidden class="anchor" aria-hidden="true" href="#十五redis事务">#</a></h4>
<p>Redis事务可以一次执行多个命令，（按顺序地串行化执行，执行中不会被其他命令插入，不许加塞）</p>
<p><strong>简介</strong></p>
<p>Redis事务可以一次指定多个命令（允许在一个单独的步骤中执行一组命令），并且带有一下两个中要的保证：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>批量操作在发送EXEC命令前被放入队列缓存。
</span></span><span style="display:flex;"><span>收到EXEC命令后进入事务执行，事务中任意命令执行失败，其余命令依然被执行。
</span></span><span style="display:flex;"><span>在事务执行过程中，其他客户端提交的命令请求不会插入到事务执行命令列中。
</span></span></code></pre></div><ol>
<li><strong>Redis会将一个事务中的所有命令序列化，然后按顺序执行</strong></li>
<li><strong>执行中不会被其它命令插入，不许出现加赛行为</strong></li>
</ol>
<p><strong>常用命令</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">DISCARD</span> <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">	取消事务，放弃执行事务块内的所有命令。</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MULTI</span> <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">	标记一个事务块的开始。</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">EXEC</span> <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">	执行所有事务块内的命令。</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">UNWATCH</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">	取消watch命令对所有key的监视。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WATCH</span> <span style="color:#e6db74">KEY [KEY ...]</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">:监视一个(或多个)key，如果在事务执行之前这个(或这些)key被其他命令所改动，那么事务将被打断。</span>	
</span></span></code></pre></div><p>一个事务从开始到执行会经历以下三个阶段：</p>
<p>1、开始事务。</p>
<p>2、命令入队。</p>
<p>3、执行事务。</p>
<h5 id="151示例-1-multi-exec">15.1示例 1 MULTI EXEC<a hidden class="anchor" aria-hidden="true" href="#151示例-1-multi-exec">#</a></h5>
<p>转账功能，A向B转账50元</p>
<p>一个事务的例子，它先以MULTI开始一个事务，然后将多个命令入队到事务中，最后由EXEC命令触发事务</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200725220940140.png" alt="image-20200725220940140"  />
</p>
<ol>
<li><strong>输入Multi命令开始，输入的命令都会一次进入命令队列中，但不会执行</strong></li>
<li><strong>知道输入Exce后，Redis会将之前的命令队列中的命令一次执行。</strong></li>
</ol>
<h5 id="152-示例-discard放弃队列运行">15.2 示例 DISCARD放弃队列运行<a hidden class="anchor" aria-hidden="true" href="#152-示例-discard放弃队列运行">#</a></h5>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200725223959473.png" alt="image-20200725223959473"  />
</p>
<ol>
<li><strong>输入MULTI命令，输入的命令都会依次进入命令队列中，但不会执行。</strong></li>
<li><strong>直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。</strong></li>
<li><strong>命令队列的过程中可以使用命令DISCARD来放弃队列运行。</strong></li>
</ol>
<h4 id="153-示例3事务的错误处理">15.3 示例3事务的错误处理<a hidden class="anchor" aria-hidden="true" href="#153-示例3事务的错误处理">#</a></h4>
<p>事务的错误处理：</p>
<p>如果执行的某个命令报出了错误，则只有报错的命令不会被执行，<strong>而其他的命令都会执行，不会回滚</strong>。</p>
<h5 id="154--示例4-事务的错误处理">15.4  示例4 事务的错误处理<a hidden class="anchor" aria-hidden="true" href="#154--示例4-事务的错误处理">#</a></h5>
<p>事务的错误处理：</p>
<p>队列中的某个命令出现了 报告错误，执行是整个的所有队列都会被取消。</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200726083227677.png" alt="image-20200726083227677"  />
</p>
<p><strong>由于之前的错误，事务执行失败</strong></p>
<h5 id="155-示例5-事务的watch">15.5 示例5 事务的watch<a hidden class="anchor" aria-hidden="true" href="#155-示例5-事务的watch">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>WATCH  key [key ...]
</span></span><span style="display:flex;"><span>:监视一个(或多个)key，如果在事务执行前这个(或这些)key被其他命令所改动，那么事务将被打断。
</span></span></code></pre></div><p>需求：某一账户在一事务内进行操作，在提交事务前，另一个进程对该账户进行操作。</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200726191147022.png" alt="image-20200726191147022"  />
</p>
<h5 id="156-应用场景">15.6 应用场景<a hidden class="anchor" aria-hidden="true" href="#156-应用场景">#</a></h5>
<p>一组命令必须同时都执行，或者都不执行。</p>
<p>我们想要保证一组命令在执行的过程之中不被其他命令插入。</p>
<p><strong>案例</strong>： 秒杀</p>
<h5 id="157-redis事务的总结">15.7 Redis事务的总结<a hidden class="anchor" aria-hidden="true" href="#157-redis事务的总结">#</a></h5>
<p>Redis事务本质：一组命令的集合！一个事务中的所有命令都会被序列化，在事务执行过程中，会按照顺序执行！一次性，顺序性，排他性！执行一些列的命令！</p>
<p><strong>Redis事务没有隔离级别的概念！</strong></p>
<p>所有的命令在事务中，并没有直接被执行！只有发起执行命令的时候才会执行！Exec</p>
<p><strong>Redis单条命令保存原子性，但是事务不保证原子性！</strong></p>
<p>Redis 事务其实是支持原子性的！即使 Redis 不支持事务回滚机制，但是它会检查每一个事务中的命令是否错误。</p>
<h4 id="十六redis持久化">十六、Redis持久化<a hidden class="anchor" aria-hidden="true" href="#十六redis持久化">#</a></h4>
<h5 id="161-什么是redis-持久化">16.1 什么是Redis 持久化？<a hidden class="anchor" aria-hidden="true" href="#161-什么是redis-持久化">#</a></h5>
<p>持久化就是把内存的数据写到磁盘中去，防止府服务宕机内存数据丢失。</p>
<p>Redis提供了两种持久化方式：<strong>RDB(默认)和AOF</strong></p>
<p><strong>简介</strong></p>
<p>数据存放于：</p>
<p><strong>内存：高效，断电（关机）内存数据会丢失</strong></p>
<p><strong>硬盘：读写速度慢于内存，断电数据不会丢失</strong></p>
<p><strong>Redis持久化存储支持两种方式：RDB和AOF。RDB一定时间取存储文件，AOF默认每秒去存储历史命令，</strong></p>
<p><strong>Redis是支持持久化的内存数据库，也就是说redis需要经常将内存中的数据同步到硬盘来保证持久化。</strong></p>
<h5 id="162-rdb">16.2 RDB<a hidden class="anchor" aria-hidden="true" href="#162-rdb">#</a></h5>
<p>RDB是Redis DataBase缩写</p>
<p>Redis是内存数据库，如果不将内存中的数据库状态保存到磁盘中，那么一旦服务器进程退出，服务器中的数据库的状态也会消失。造成数据的丢失，所以redis提供了持久化的功能。</p>
<p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是所说的snapshot快照，它恢复是将卡UN关照文件爱你直接读到内存里。</p>
<p>Redis会单独创建（fock）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，在用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。这就确保了极高的性能。如果需要进行大规模的数据的恢复，且对于数据恢复的完整性不死非常敏感，那RDB方式要比AOF 方式更加的高效。RDB的缺点是最后一次持久化的数据可能丢失。</p>
<p>功能核心函数rdbSave（生成RDB文件）和rdbLoad（从文件加载内存）两个函数</p>
<ul>
<li><strong>rdbSave：生成RDB文件</strong></li>
<li><strong>rdbLoad：从文件夹杂内存</strong></li>
</ul>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200726194030744.png" alt="image-20200726194030744"  />
</p>
<p>RDB : 是redis默认的持久化机制</p>
<p>快照是默认的持久化方式。这种方式就是将内存中数据以快照的方式写入到二进制文件中，默认的文件名为<strong>dump.rdb</strong>。</p>
<p><strong>优点：</strong></p>
<ul>
<li>快照保存数据极快，还原数据极快</li>
<li>适用于灾难备份</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>小内存机器不适合使用，RDB机制符合要求就会照快照</li>
</ul>
<p><strong>快照条件：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>1、服务器正常关闭：./bin/redis-cli shutdown
</span></span><span style="display:flex;"><span>2、key满足一定条件，会进行快照
</span></span><span style="display:flex;"><span> vim redis.config 搜索save
</span></span><span style="display:flex;"><span> /save
</span></span><span style="display:flex;"><span>save   900  1      //每秒900秒（15分钟）至少1个key发生变化，产生快照
</span></span><span style="display:flex;"><span>save   300  10     //每300秒  （5分钟）至少10个key发生变化，产生快照
</span></span><span style="display:flex;"><span>save   60   10000  //每60秒（1分钟）至少10000个key发生变化，产生快照
</span></span></code></pre></div><h5 id="163-aof">16.3 AOF<a hidden class="anchor" aria-hidden="true" href="#163-aof">#</a></h5>
<p>由于快照方式是在一定间隔时间做一次的，所以如果redis意外down掉的话，就会丢失最后一个快照后的所有修改。如果应用要求不能丢失任何修改的话，可以采用aof持久化方式。</p>
<p>Append-only file：aof比rdb有更好的持久化性，是由于在使用aof持久化方式是，redis会将每一个收到的命令都通过write函数追加到文件中（默认是appendonly.aof)。当redis重启是会通过重新执行文件中保存的写命令来在内存冲重建整个数据库的内容。</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200726222819545.png" alt="image-20200726222819545"  />
</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200806232428617.png" alt="image-20200806232428617"  />
</p>
<p>每当执行服务器（定时）任务或者函数时flushAppendOnlyFile函数都会被调用，这个函数执行以下两个工作aof写入保存：</p>
<p><strong>WRITE：根据条件，将aof_buf中的缓存写入到AOF文件。</strong></p>
<p><strong>SAVE：根据条件，调用fsync或fdatasync函数，将AOF文件保存到磁盘中。</strong></p>
<p><strong>有三种方式如下（默认是：每秒fsync一次）</strong></p>
<ul>
<li>appendonly yes      //启用aof持久化方式</li>
<li><code>#</code> appendfsync always  //收到写命令就立即写入磁盘，最慢，但是保证完全的持久化</li>
<li>appendfysnceverysec    //每秒钟写入磁盘一次，在性能和持久化方面做了很好的折中</li>
<li><code>#</code> appendfysnc no        //完全依赖os，性能孔，持久化没保证</li>
</ul>
<p><strong>产生的问题：</strong></p>
<p>​	aof的方式也同时带来了另一个问题。持久化文件会变的越来越大。例如我们调用incr test命令 100次，问价中必须保存全部的1000条命令，其实有99条都是多余的。</p>
<h4 id="十七redis缓存与数据库一致性">十七、Redis缓存与数据库一致性<a hidden class="anchor" aria-hidden="true" href="#十七redis缓存与数据库一致性">#</a></h4>
<h5 id="171-实时同步">17.1 实时同步<a hidden class="anchor" aria-hidden="true" href="#171-实时同步">#</a></h5>
<p>对强一直要求比较高的，应采用实时同步方案，即查询缓存查询不到在从DB查询，保存到缓存；更新缓存时，先更新数据库，在将缓存的设置过期（建议不要去更新缓存内容，直接设置缓存过期）。</p>
<p>@Cacheable：查询时使用，注意Long类型需要转换为String类型，否则会抛异常</p>
<p>@CachePut：跟新是使用，使用此注解，一定会从DB上查询数据</p>
<p>@CacheEvict：删除时使用；</p>
<p>@Caching ：组合用法</p>
<h5 id="172-异步队列">17.2 异步队列<a hidden class="anchor" aria-hidden="true" href="#172-异步队列">#</a></h5>
<p>对于并发程度高的，可采用异步队列的方式同步，可采用kafka等消息中间件处理消息生产和消费。</p>
<h5 id="173-使用阿里的同步工具canal">17.3 使用阿里的同步工具canal<a hidden class="anchor" aria-hidden="true" href="#173-使用阿里的同步工具canal">#</a></h5>
<h5 id="174-采用udf自定义函数的方式">17.4 采用UDF自定义函数的方式<a hidden class="anchor" aria-hidden="true" href="#174-采用udf自定义函数的方式">#</a></h5>
<p>面对mysql的API进行编程，利用触发器进行缓存同步，但UDF主要是C/C++语言实现，学习成本高。</p>
<h4 id="十八总结">十八、总结<a hidden class="anchor" aria-hidden="true" href="#十八总结">#</a></h4>
<h5 id="181-缓存穿透">18.1 缓存穿透<a hidden class="anchor" aria-hidden="true" href="#181-缓存穿透">#</a></h5>
<p>缓存穿透是指查询一个一定不存在的数据，由于缓存时不命中时需要从数据库查询，查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到数据库去查询，造成缓存穿透。</p>
<p><strong>解决办法</strong>：持久层查询不到就缓存空结果，查询时先判断缓存中是否exists(key)，如果有直接返回空，没有则查询后返回，</p>
<p>注意insert时需要清除查询的key，否则即便DB中有值也查询不到（当然可以设置空缓存的过去时间）</p>
<blockquote>
<p>概念</p>
</blockquote>
<p>缓存穿透的概念很简单，用户想要查询一个数据没法安redis内存数据库没有，也就是缓存没有命中，于是向持久层数据量查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中，于是都去请求持久层数据库，这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<h6 id="1811-布隆过滤器">18.1.1 布隆过滤器<a hidden class="anchor" aria-hidden="true" href="#1811-布隆过滤器">#</a></h6>
<p>布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的查询压力；</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200809190855071.png" alt="image-20200809190855071"  />
</p>
<p>但是这种方法存在两个问题：</p>
<p>1、如果空值能够被缓存起来，这就意味着缓存需要更过的空间村粗更过的键，因为这当中可能回有很多的空值的键；</p>
<p>2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响；</p>
<h5 id="1812-缓存击穿">18.1.2 缓存击穿<a hidden class="anchor" aria-hidden="true" href="#1812-缓存击穿">#</a></h5>
<blockquote>
<p>概念</p>
</blockquote>
<p>这里需要主要的是缓存击穿的区别，缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就行在一个屏幕上凿开一个洞</p>
<p>当某个key在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导致数据库瞬间压力过大。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<p><strong>设置热点数据永不过期</strong></p>
<p>从缓存层面来看，没有设置过期时间，所有不会出现热点key过期后产生的问题。</p>
<p><strong>加锁互斥</strong></p>
<p>分布式锁：使用分布式锁，保证对于每个key同时只有一个线程去查询后盾服务，其他线程没有获得分布式锁的权限，因此只需要等待即可，这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p>
<h5 id="182-雪崩">18.2 雪崩<a hidden class="anchor" aria-hidden="true" href="#182-雪崩">#</a></h5>
<p><strong>雪崩：缓存大量失效的时候，引发大量查询数据库。</strong></p>
<p><strong>解决办法：</strong></p>
<p>​	用锁/分布式锁或者队列串行访问</p>
<p>​    缓存失效时间均匀分布</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>如果缓存集中在一端时间内失效，发生大量的缓存穿透，所有的查询都落在数据库上，造成了缓存雪崩。
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>这个没有完美解决办法，但是可以分析用户的行为，尽量让失效时间点均匀分布。大所属系统设计者考虑用加锁或者队列的方式保证缓存的单线程写，从而避免失效时大量的并发请求落到底层存储系统上。
</span></span></code></pre></div><ol>
<li>
<p><strong>加锁排队。限流&mdash;限流算法</strong></p>
<p>在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p>
<p>简单地来说，就是在缓存失效的时候（判断拿出来的值为空），不是立即去load db，而是先使用缓存工具的某些带成功操作返回值的操作（比如Redisde SETNX或者Memcache的ADD）去set一个mutex key，当操作返回成功是，在进行koad db 的操作应设缓存；否则，就重试整个get缓存的方法。</p>
<p>SETNX ,是【SET IF NOT EXISTS]的缩写，也就是只有不存在的时候才设置，可以利用它来实现锁的效果。</p>
</li>
<li>
<p><strong>数据预热</strong></p>
<p>可以通过缓存reload机制，预选去更新缓存，再即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>
</li>
</ol>
<h5 id="183-热点key">18.3 热点key<a hidden class="anchor" aria-hidden="true" href="#183-热点key">#</a></h5>
<p>​	热点key：某个key访问非常频繁。当key失效的时候有大量线程来构建缓存，导致负载增加，系统崩溃。</p>
<p>解决办法：</p>
<ol>
<li>使用锁，单机用synchronized ， lock等，分布式使用分布式锁</li>
<li>缓存过期时间不设置，而是设置在key对应的value里。如果检测到存的时间超过过期时间则 异步跟新缓存。</li>
<li>在value设置一个比过去时间t0小的过期时间值t1,当t1过期的时候，延长t1并做更新缓存操作。</li>
<li>设置标签缓存，标签缓存设置过期时间，标签缓存过期后，需异步地跟新实际缓存。</li>
</ol>
<p><strong>案例</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>假设并发有10000个请求，想达到对个请求从数据库中获取，其他9999个请求冲redis中获取这种效果
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200727233009577.png" alt="image-20200727233009577"  />
</p>
<p>双重检测锁测压：</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200727233804236.png" alt="image-20200727233804236"  />
</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200727225050871.png" alt="image-20200727225050871"  />
</p>
<h4 id="十九可能的问题">十九、可能的问题<a hidden class="anchor" aria-hidden="true" href="#十九可能的问题">#</a></h4>
<p>一般来说，要将redis运用于工程项目中，只是用一台Redis是万万不能的，原因如下：</p>
<p>1、从结构上，单个Redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；（容错性）</p>
<p>2、从容量上，单个redis服务器内存容量有限，就算一台redis服务器内存容量为256G，也不能将所有内容用作Redis存储内存，一般来说，单台Redis最大使用内存不应该超过20G。</p>
<p>问题：</p>
<ul>
<li>内存容量有限</li>
<li>处理能力有限</li>
<li>无法高可用。</li>
</ul>
<h4 id="二十主从复制">二十、主从复制<a hidden class="anchor" aria-hidden="true" href="#二十主从复制">#</a></h4>
<p><strong>简介</strong></p>
<p>电子商务网站上的商品，一般都是一次上传，无数次的浏览的，说专业点的也就是“多读少些”。</p>
<h5 id="201主从复制">20.1主从复制：<a hidden class="anchor" aria-hidden="true" href="#201主从复制">#</a></h5>
<p>一个Redis服务可以有多个该服务的复制品，这个Redis服务成为Master，其他的复制成为Slaves</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200728000743754.png" alt="image-20200728000743754"  />
</p>
<p>如图中所示：我们将一台Redis服务器作为主库（master），其他的三台作为（salve），主库负责写数据，每次有数据跟新都更新的数据同步到它的所有的从库，而从库只负责读数据。这样一来，就有了两个好处：</p>
<p>1、读写分离：不仅可以提高服务器的负载能力，并且可以根据读请求的规模自由增加或者减少从库的数据。</p>
<p>2、数据被复制成了好几份，就算一台机器出现故障，也可以使用其它机器的数据快速的恢复。</p>
<p>需要注意的是：Redis主从复制模式中，一台主库可以用用多个从库，一个从库只能属于一个主库。</p>
<h5 id="202-redis主从复制配置">20.2 Redis主从复制配置<a hidden class="anchor" aria-hidden="true" href="#202-redis主从复制配置">#</a></h5>
<p>在Redis中，要实现主从复制架构非常的简单，只需要在从数据库的配置文件中加上如下命令即可：</p>
<p>1、主数据库不需要任务配置，创建爱哪一个从数据库：</p>
<p>redis.config（配置文件信息）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>-- port 6380  : 从服务的端口号
</span></span><span style="display:flex;"><span>--slaveof  127.0.0.1 6379   ：指定主服务器
</span></span></code></pre></div><p>2、启动从数据库：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>./bin/redis-server   ./redis.conf  --port  6380  --slaveof  127.0.0.1   6379
</span></span></code></pre></div><p>3、登录到从服务客户端</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>./bin/redis-cli   -p  6380  -a  redis
</span></span></code></pre></div><p>4、哨兵模式</p>
<p><strong>简介</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>Redis-Sentinel(哨兵模式)是高可用解决方案，当redis在做master-slave的高可用方案时，假如master宕机了，redis本身（以及其很多客户端）都没有实现自动进行主备切换，而redis-sentinel本身是独立运行的进程，可以部署在其他的与redis集群可通讯的机器中监控redis集群。
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>有了主从复制的实现之后，我们如果想从服务器进行监控，那么在redis2.6以后提供了有个“哨兵”机制，并在2.8版本以后功能稳定起来。
</span></span><span style="display:flex;"><span>哨兵：故名司仪，就是监控Redis系统的运行状况。
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200728220027757.png" alt="image-20200728220027757"  />
</p>
<p>哨兵模式的特点</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>1、不时地监控redis是否按照预期良好地运行；
</span></span><span style="display:flex;"><span>2、如果发现某个redis 节点运行出现状况，能够通知另外一个进程（例如它的客户端）；
</span></span><span style="display:flex;"><span>3、能够进行自动切换。当一个master节点不可用时，能够选举出master的多个slave(如果有超过一个slave的话)中的一个来作为新的master，其他的slave节点会将它所追随的master地址改为被提升为master的salve的新地址。
</span></span><span style="display:flex;"><span>4、哨兵为客户端提供服务发现，客户端连接哨兵，哨兵提供当前master的地址然后提供服务，如果出现切换，也就是master挂了，哨兵会提供客户端一个新地址。
</span></span></code></pre></div><h5 id="203-基本概述">20.3 基本概述<a hidden class="anchor" aria-hidden="true" href="#203-基本概述">#</a></h5>
<p><strong>高可用</strong></p>
<p>&ldquo;高可用性（High Availability）&ldquo;通常用来描述一个系统经过专门的设计，从而减少停工时间，而保证器服务的高可用性。（一直都能用）</p>
<p>高可用：6个99.9999% 全年停机不超过32秒。</p>
<p><strong>高并发</strong></p>
<p><strong>高并发</strong> （High Concurrentcy）是互联网分布式系统架构设计中必须考虑的因素之一，它通常是指，通过设计在保证系统能够同时并行处理的很多请求。</p>
<p>高并发相关商用的一些指标有如下：</p>
<ul>
<li>响应时间（Response Time）</li>
<li>吞吐量（Throughput）</li>
<li>每秒查询率QPS（Query Pre Second），并发用户数等。</li>
</ul>
<p><strong>响应时间</strong>：系统对请求做出响应的时间，例如系统处理一个HTTP请求需要200ms，这个200ms就是系统的响应时间。</p>
<p><strong>吞吐量</strong>：单位时间内处理的请求数量。</p>
<p><strong>QPS</strong> ：每秒响应请求数。在互联网领域，这个指标和吞吐量区分的没有那么明显。</p>
<p>并发用户：同时承载正常使用系统功能的用户数量。例如一个即使通讯系统，同时在线量一定程度上代表</p>
<h5 id="204-主从复制的主要作用包括">20.4 主从复制的主要作用包括<a hidden class="anchor" aria-hidden="true" href="#204-主从复制的主要作用包括">#</a></h5>
<p><strong>1、数据冗余</strong>：主从复制实现了数据热备份，是持久化之外的一种数据冗余的方式。</p>
<p><strong>2、故障恢复</strong>：当主节点出现 问题时，可以由从节点提供服务，实现快速的故障恢复；世界上是以一种服务的冗余。</p>
<p><strong>3、负载均衡</strong>：在主从复制的基础上，配合读写分离，可以由节点提供写的服务，由从节点提供提供读服务（即写redis数据时应用及连接主节点，读redis数据时应该用从节点），人丹服务器的负载；尤其在写少读多的场景下，通过多个从节点分担读负载，可以大大提高redis服务器的并发量。</p>
<p><strong>4、高可用的基石</strong>：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是redis高可用的基础。</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200809172058925.png" alt="image-20200809172058925"  />
</p>
<h5 id="205-主从复制的原理">20.5 主从复制的原理<a hidden class="anchor" aria-hidden="true" href="#205-主从复制的原理">#</a></h5>
<p>Slave 启动成功连接到master后会发送一个sync命令</p>
<p>Master接收到名，启动后台的存盘进程，同时收集所有接受到的用于修改数据集命令，在后台进程执行完毕后，master将传送的数据文件到slave，并完成一次完全同步</p>
<p>全量复制：而slave服务在接受到数据库文件数据后，将其存盘并加载内存中。</p>
<p>增量文件：Master继续将新的所有收集的修改命令一次传给slave，完成同步</p>
<p>但是只要是重新连接master，一次完全同步（全量复制）将别自动执行。</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200809175246937.png" alt="image-20200809175246937"  />
</p>
<h4 id="二十一redis-cluster集群">二十一、Redis Cluster集群<a hidden class="anchor" aria-hidden="true" href="#二十一redis-cluster集群">#</a></h4>
<p><strong>简介</strong></p>
<h5 id="211-集群模式是实际使用最多的模式">21.1 集群模式是实际使用最多的模式。<a hidden class="anchor" aria-hidden="true" href="#211-集群模式是实际使用最多的模式">#</a></h5>
<p>Redis Cluster是社区版推出的Redis分布式集群解决方案，主要解决Redis分布式方面的需求，比如，当遇到单机内存，并发和流量等瓶颈的时候，Redis Cluster能起到很好的的负载均衡的目的。</p>
<p><strong>为什么使用redis-cluster？</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>为了在大流量访问下提供稳定的业务，集群化时存储的必然形态
</span></span><span style="display:flex;"><span>未来的发展趋势可定是云计算和大数据的紧密结合
</span></span><span style="display:flex;"><span>只有分布式架构能满足需求
</span></span></code></pre></div><h5 id="212-集群描述">21.2 集群描述<a hidden class="anchor" aria-hidden="true" href="#212-集群描述">#</a></h5>
<p>Redis集群搭建方案：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>(1)、Twitter开发的twemproxy
</span></span><span style="display:flex;"><span>(2)、豌豆荚开发的codis
</span></span><span style="display:flex;"><span>(3)、redis观法的redis-cluster
</span></span></code></pre></div><p>Redis集群搭建的方式有很多种，但从redis 3.0 之后变动表呢支持redis-cluster集群，志超需要3（master）+3（Slave）才能简历集群。Redis——Cluster采用无中心结构，没个节点保存数据和整个集群状态，每个节点都和其他所有 节点连接。其redis-cluster架构图如下所示：</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200728224937533.png" alt="image-20200728224937533"  />
</p>
<p>Redis Cluster集群几点最小配置6个节点以上（3主3从），其中主节点提供读写操作，从节点作为备用节点，不提供请求，只作为故障转移使用。</p>
<p><strong>Redis Cluster集群特点</strong></p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200728225228777.png" alt="image-20200728225228777"  />
</p>
<p>1、所有的redis节点彼此互联（PING-PONG)，内部使用二进制协议优化传输速度和带宽。</p>
<p>2、节点的fail是通过集群中超过半数的节点检测失效时才生效。</p>
<p>3、客户端与redis节点直连，不需要中间proxy层。客户端不需要连接集群所有节点，连接集群中任何一个可用节点即可。</p>
<p>4、redis-cluster把所有的物理节点映射到[0-16383]slot上（不一定是平均分配），cluster负责维护</p>
<p>5、redis集群预先分好16384个哈希槽，当需要在redis集群中放置一个key-value时，redis先对key使用crc16算法算出一个结果，然后把结果对16384求余数，这样对每个key都会对应一个编号在0-16383之间的哈希槽，redis会根据节点数量大致均等的将哈希槽映射到不同的节点。</p>
<h5 id="213-redis-cluster集群搭建">21.3 Redis Cluster集群搭建<a hidden class="anchor" aria-hidden="true" href="#213-redis-cluster集群搭建">#</a></h5>
<p>集群搭建参考官网：https://redis.io/topic/cluster-tutorial</p>
<p>​	redis集群需要至少三个master节点，我们这里搭建三个master节点，并且给每个master在搭建一个slave节点，总共6个节点，这里用一台机器（可以多台机器部署，修改一下ip地址就可以了）部署6个redis实例，三主三从。搭建集群的步骤如下：</p>
<ol>
<li>
<p>创建Redis节点安装目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>mkdir /root/apps/redis_cluster ：指定目录下  创建 redis_cluster
</span></span></code></pre></div></li>
<li>
<p>在redis_cluster目录，创建7000-7005   6个文件夹下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>mkdir 70000 70001 70002 70003 70004 70005
</span></span></code></pre></div></li>
<li>
<p>并将redis-conf分别拷贝到70000-70005文件夹下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>cp /opt/redis-5.0.8/redis.conf   ./70000
</span></span></code></pre></div></li>
<li>
<p>修改Redis配置文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">/</span>root<span style="color:#f92672">/</span>apps<span style="color:#f92672">/</span>redis_cluster<span style="color:#f92672">/</span><span style="color:#ae81ff">70000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">关闭保护模式</span> <span style="color:#960050;background-color:#1e0010">用于公网访问</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span><span style="color:#f92672">-</span>mode  no
</span></span><span style="display:flex;"><span>    port  <span style="color:#ae81ff">70000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">开启集群模式</span>
</span></span><span style="display:flex;"><span>    cluster<span style="color:#f92672">-</span>enabled  yes
</span></span><span style="display:flex;"><span>    cluster<span style="color:#f92672">-</span>config<span style="color:#f92672">-</span>file nodes<span style="color:#f92672">-</span><span style="color:#ae81ff">70000.</span>config
</span></span><span style="display:flex;"><span>    cluster<span style="color:#f92672">-</span>node<span style="color:#f92672">-</span>timeout  <span style="color:#ae81ff">5000</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">后台启动</span>
</span></span><span style="display:flex;"><span>    daemonize  yes
</span></span><span style="display:flex;"><span>    pidfile  <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>run<span style="color:#f92672">/</span>redis_70000<span style="color:#f92672">.</span><span style="color:#a6e22e">pid</span>
</span></span><span style="display:flex;"><span>    logfile  <span style="color:#e6db74">&#34;70000.log&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> dir <span style="color:#f92672">/</span>redis<span style="color:#f92672">/</span>data
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">此处绑定</span>ip<span style="color:#f92672">,</span><span style="color:#960050;background-color:#1e0010">可以是阿里内网</span>ip<span style="color:#960050;background-color:#1e0010">和本地</span>ip<span style="color:#960050;background-color:#1e0010">也可以直接注释掉该项</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> bind <span style="color:#ae81ff">127.0.0.1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">用于连接主节点密码</span>
</span></span><span style="display:flex;"><span>    masterauth redis
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#设置</span>redis<span style="color:#960050;background-color:#1e0010">密码</span> <span style="color:#960050;background-color:#1e0010">各个几点请保持密码一致</span>
</span></span><span style="display:flex;"><span>    requirepass  redis
</span></span></code></pre></div></li>
<li>
<p>依次复制并修改6个redis.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>cp ./70000/redis.conf ./70001   :依次进行复制
</span></span><span style="display:flex;"><span>vim ./70001/redis.conf  : 执行 %s/old/new/g 全部替换 ：wq 保存并退出  即可
</span></span></code></pre></div></li>
</ol>
<p>6、依次启动6个节点</p>
<p>将安装的redis目录下的src复制到cluster下，方便启动服务端</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>cd /opt/redis-5.0.8  :进入redis安装目录
</span></span><span style="display:flex;"><span>cp -r  ./src/  /usr/local/redis_cluster/   :将src文件复制到redis——cluster目录中
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>./src/redis-server   ./7000/redis.conf
</span></span><span style="display:flex;"><span>./src/redis-server   ./7001/redis.conf
</span></span><span style="display:flex;"><span>./src/redis-server   ./7002/redis.conf
</span></span><span style="display:flex;"><span>./src/redis-server   ./7003/redis.conf
</span></span><span style="display:flex;"><span>./src/redis-server   ./7004/redis.conf
</span></span><span style="display:flex;"><span>./src/redis-server   ./7005/redis.conf
</span></span></code></pre></div><p>启动后，可以用PS查看进程：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>ps -ef | grep -i redis
</span></span></code></pre></div><ol start="7">
<li>创建集群</li>
</ol>
<p>Redis 5版本后 通过redis-cli 客户端命令来创建集群。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>./src/redis-cli --cluster  create  -a redis 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002  127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 --cluster-replicas 1
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200802173440118.png" alt="image-20200802173440118"  />
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>Performing hash slots allocation on 6 nodes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Trying to optimize slaves allocation for anti-affinity
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/redis/images/image-20200802174653654.png" alt="image-20200802174653654"  />
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>[OK] All 16384 slots covered.
</span></span></code></pre></div><ol start="8">
<li>
<p>Redis Cluster集群验证</p>
<p>在某台机器上（或）连接集群的7001端口的几点：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">redis-cli</span>  <span style="color:#e6db74">-h 127.0.0.1  -c -p 7000 -a redis   :加参数 -c 可以连接到集群</span>
</span></span></code></pre></div><p>redis cluster在设计的时候，就考虑了去中心化，去中间件，也就是说集群中的每个节点都是平等的关系，都是对等的，每个几点都保存各自的数据和整个集群的状态。每个节点都和其他所有节点连接，而且这些连接保持活跃，这样就保证了我们只需要连接集群中的任意一个节点，就可以获取到其他节点的数据。</p>
<p>基本命令</p>
<p><strong>info replication</strong> 通过Cluster Nodes 命令和Cluster Info命令来看看集群的效果</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#e6db74">7000&gt; info replication</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">role</span><span style="color:#f92672">:</span><span style="color:#e6db74">master</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">connected_slaves</span><span style="color:#f92672">:</span><span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">slave0</span><span style="color:#f92672">:</span><span style="color:#e6db74">ip=127.0.0.1,port=7004,state=online,offset=1026,lag=1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">master_replid</span><span style="color:#f92672">:</span><span style="color:#e6db74">2c2851db4bea0ea2f9d93d60a065e868112c47d7</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">master_replid2</span><span style="color:#f92672">:</span><span style="color:#e6db74">0000000000000000000000000000000000000000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">master_repl_offset</span><span style="color:#f92672">:</span><span style="color:#e6db74">1026</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">second_repl_offset</span><span style="color:#f92672">:</span><span style="color:#e6db74">-1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">repl_backlog_active</span><span style="color:#f92672">:</span><span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">repl_backlog_size</span><span style="color:#f92672">:</span><span style="color:#e6db74">1048576</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">repl_backlog_first_byte_offset</span><span style="color:#f92672">:</span><span style="color:#e6db74">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">repl_backlog_histlen</span><span style="color:#f92672">:</span><span style="color:#e6db74">1026</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#e6db74">7000&gt;</span>
</span></span></code></pre></div><p><strong>输入命令cluster nodes</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">127.0.0.1</span><span style="color:#f92672">:</span><span style="color:#e6db74">7000&gt; cluster nodes</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">c58e7d40e34251897af3bee6bc6edd7a500f9fa6</span> <span style="color:#e6db74">127.0.0.1:7005@17005 slave 3a7ac96a39a41b395d5459eeac1f17d1f6fd96d7 0 1596391181092 6 connected</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">71e898b018d1775214a431bd22b3408b055dbb62</span> <span style="color:#e6db74">127.0.0.1:7003@17003 slave 5a191a63e8c2f5dbe945451bca0552426d6e9260 0 1596391182096 4 connected</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">60335b82c5348215c0dbbbac5b65c769f6668e4e</span> <span style="color:#e6db74">127.0.0.1:7000@17000 myself,master - 0 1596391181000 1 connected 0-5460</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">5a191a63e8c2f5dbe945451bca0552426d6e9260</span> <span style="color:#e6db74">127.0.0.1:7002@17002 master - 0 1596391183102 3 connected 10923-16383</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">9cae9ebf31a03c09a82281dcb629aac418e22831</span> <span style="color:#e6db74">127.0.0.1:7004@17004 slave 60335b82c5348215c0dbbbac5b65c769f6668e4e 0 1596391182000 5 connected</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">3a7ac96a39a41b395d5459eeac1f17d1f6fd96d7</span> <span style="color:#e6db74">127.0.0.1:7001@17001 master - 0 1596391182598 2 connected 5461-10922</span>
</span></span></code></pre></div><p>每个Redis的节点都有一个ID值，此ID将被此特定redis实例永久使用，以便实例在集群上下文中具有唯一的名称。每个节点都都会记住使用此ID的每个其他节点，而不是通过IP或端口号。IP地址和端口可能会发生变化，但唯一的节点标识符在节点的整个生命周期内都不会改变。我们简单称这个标识符为节点ID。</p>
<h5 id="214-redis总结">21.4 Redis总结<a hidden class="anchor" aria-hidden="true" href="#214-redis总结">#</a></h5>
<p><strong>简介：</strong></p>
<p>​     redis cluster 为了保证数据的高可用性，加入了主从模式，一个节点对应一个或多个从节点，主节点提供数据存取，从节点则是从主节点拉去数据备份，当这个主节点挂掉后，就会有这个从节点选取一个来充当主节点，从而保证集群不会挂掉。</p>
<p>集群有ABC三个主节点，如果这3个几点都没有加入从节点，如果B挂掉了，我们就无法访问整个集群了。A和C的slot也无法访问。</p>
<p>所以我们集群建立的时候，一定腰围每个主节点都添加一个从节点，比如像这样，集群包含主节点A,B,C 以及从节点A1,B1,C1，那么及时B挂掉系统也可以继续正确工作。</p>
<p>B1节点代替了B节点，所有Redis集群将会选择B1节点作为新的主节点，集群将会继续正确的提供服务。当B重新开启后，它就变成B1的从节点。</p>
<p>不过需要注意，如果几点B和B1同时挂掉，Redis集群就无法继续正确的提供服务了。</p>
<h5 id="215-关闭集群">21.5 关闭集群<a hidden class="anchor" aria-hidden="true" href="#215-关闭集群">#</a></h5>
<p>在/root/apps/redis_cluster 目录下编写脚本文件 ： vim shutdowm.sh</p>
<p>内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-cli</span> <span style="color:#e6db74">-c -h 127.0.0.1 -p 7000 -a redis shutdown</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-cli</span> <span style="color:#e6db74">-c -h 127.0.0.1 -p 7001 -a redis shutdown</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-cli</span> <span style="color:#e6db74">-c -h 127.0.0.1 -p 7002 -a redis shutdown</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-cli</span> <span style="color:#e6db74">-c -h 127.0.0.1 -p 7003 -a redis shutdown</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-cli</span> <span style="color:#e6db74">-c -h 127.0.0.1 -p 7004 -a redis shutdown</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-cli</span> <span style="color:#e6db74">-c -h 127.0.0.1 -p 7005 -a redis shutdown</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">chmod</span> <span style="color:#e6db74">u+x shutdown.sh   :然后执行将shutdown.sh变成可执行文件</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">./shutdown.sh</span>   <span style="color:#f92672">:</span><span style="color:#e6db74">在当前目录下启动</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">查看：</span> <span style="color:#e6db74">ps aux | grep redis</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">官方：/usr/local/redis_cluster/redis-cli</span> <span style="color:#e6db74">-a xxx -c -h 192.168.5.100 -p 8001</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">提示：-a</span> <span style="color:#e6db74">：访问服务端密码  ， -c 表示集群模式  ， -h指定ip地址  ，-p指定端口号</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-service</span> <span style="color:#e6db74">./70000/redis.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-service</span> <span style="color:#e6db74">./70001/redis.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-service</span> <span style="color:#e6db74">./70002/redis.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-service</span> <span style="color:#e6db74">./70003/redis.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-service</span> <span style="color:#e6db74">./70004/redis.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">/root/apps/redis_cluster/src/redis-service</span> <span style="color:#e6db74">./70005/redis.conf</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>chmod u+x redisinstall.sh   :然后执行将redisinstall.sh变成可执行文件
</span></span><span style="display:flex;"><span>./redisinstall.sh
</span></span></code></pre></div><h4 id="二十二redis中的拓展">二十二、Redis中的拓展<a hidden class="anchor" aria-hidden="true" href="#二十二redis中的拓展">#</a></h4>
<h5 id="221-redis为什么单线程还这么快">22.1 Redis为什么单线程还这么快<a hidden class="anchor" aria-hidden="true" href="#221-redis为什么单线程还这么快">#</a></h5>
<p>1、误区1：高性能的服务器一定是多线程的？</p>
<p>2、误区2：多线程（CUP上下文会切换！）一定比单线程效率高！</p>
<p>先去CPU&gt;内存&gt;硬盘的速度要有所了解！</p>
<p>核心：redis是将所有的数据全部放在内存中的，所以说使用单线程去炒作效率就是最高的。</p>
<p>多线称（CUP上下文切换：耗时！！！），对于内存来说，如果没有上下文切换效率就是最高的。对此读写就是在CUP上所以Redis 的速度是非常 快的。</p>
<h4 id="二十三重新配置redistemplate">二十三、重新配置RedisTemplate<a hidden class="anchor" aria-hidden="true" href="#二十三重新配置redistemplate">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.yux.redisdemo.redis<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Bean<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.connection.RedisConnectionFactory<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.core.RedisTemplate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.serializer.StringRedisSerializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.annotation.PropertyAccessor<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.databind.ObjectMapper<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * redis配置类
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author YUX
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @date   2018年6月6日
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">18
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">19
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RedisConfig</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;all&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">redisTemplate</span><span style="color:#f92672">(</span>RedisConnectionFactory factory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> template <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;();</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        template<span style="color:#f92672">.</span><span style="color:#a6e22e">setConnectionFactory</span><span style="color:#f92672">(</span>factory<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Jackson2JsonRedisSerializer<span style="color:#f92672">(</span>Object<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        ObjectMapper om <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ObjectMapper<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        om<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisibility</span><span style="color:#f92672">(</span>PropertyAccessor<span style="color:#f92672">.</span><span style="color:#a6e22e">ALL</span><span style="color:#f92672">,</span> JsonAutoDetect<span style="color:#f92672">.</span><span style="color:#a6e22e">Visibility</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ANY</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        om<span style="color:#f92672">.</span><span style="color:#a6e22e">enableDefaultTyping</span><span style="color:#f92672">(</span>ObjectMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">DefaultTyping</span><span style="color:#f92672">.</span><span style="color:#a6e22e">NON_FINAL</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        jackson2JsonRedisSerializer<span style="color:#f92672">.</span><span style="color:#a6e22e">setObjectMapper</span><span style="color:#f92672">(</span>om<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        StringRedisSerializer stringRedisSerializer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringRedisSerializer<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// key采用String的序列化方式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>        template<span style="color:#f92672">.</span><span style="color:#a6e22e">setKeySerializer</span><span style="color:#f92672">(</span>stringRedisSerializer<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// hash的key也采用String的序列化方式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>        template<span style="color:#f92672">.</span><span style="color:#a6e22e">setHashKeySerializer</span><span style="color:#f92672">(</span>stringRedisSerializer<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// value序列化方式采用jackson
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>        template<span style="color:#f92672">.</span><span style="color:#a6e22e">setValueSerializer</span><span style="color:#f92672">(</span>jackson2JsonRedisSerializer<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// hash的value序列化方式采用jackson
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        template<span style="color:#f92672">.</span><span style="color:#a6e22e">setHashValueSerializer</span><span style="color:#f92672">(</span>jackson2JsonRedisSerializer<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        template<span style="color:#f92672">.</span><span style="color:#a6e22e">afterPropertiesSet</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> template<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="二十四重新编写redisutils">二十四、重新编写RedisUtils<a hidden class="anchor" aria-hidden="true" href="#二十四重新编写redisutils">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.yux.redisdemo.redis<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Map<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Set<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.TimeUnit<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.redis.core.RedisTemplate<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Component<span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.util.CollectionUtils<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">14
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Redis工具类
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @author YUX
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @date   2018年6月7日
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RedisUtil</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> RedisTemplate<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> redisTemplate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// =============================common============================
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 26
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 指定缓存失效时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 27
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key  键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             28
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time 时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             29
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 30
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">expire</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>time <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>                redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">expire</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> time<span style="color:#f92672">,</span> TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 44
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 根据key 获取过期时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 45
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            46
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 时间(秒) 返回0代表为永久有效
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 47
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">getExpire</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">getExpire</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 53
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 判断key是否存在
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 54
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            55
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true 存在 false不存在
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 56
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hasKey</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">hasKey</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 67
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 删除缓存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 68
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 可以传一个值 或多个
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            69
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@SuppressWarnings</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;unchecked&#34;</span><span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">del</span><span style="color:#f92672">(</span>String<span style="color:#f92672">...</span> key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>key <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> key<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>key<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>                redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">delete</span><span style="color:#f92672">(</span>key<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]);</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">delete</span><span style="color:#f92672">(</span>CollectionUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">arrayToList</span><span style="color:#f92672">(</span>key<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ============================String=============================
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 83
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 普通缓存获取
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 84
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            85
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 86
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> key <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">:</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 92
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 普通缓存放入
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 93
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              94
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              95
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true成功 false失败
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 96
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 109
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 普通缓存放入并设置时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 110
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              111
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              112
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time  时间(秒) time要大于0 如果time小于等于0 将设置无限期
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              113
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true成功 false 失败
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 114
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object value<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>time <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">,</span> time<span style="color:#f92672">,</span> TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                set<span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 130
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 递增
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 131
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              132
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param delta 要增加几(大于0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              133
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 134
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">incr</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> delta<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>delta <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;递增因子必须大于0&#34;</span><span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">increment</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> delta<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 143
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 递减
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 144
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              145
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param delta 要减少几(小于0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              146
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 147
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">decr</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> delta<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>delta <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;递减因子必须大于0&#34;</span><span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">increment</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> <span style="color:#f92672">-</span>delta<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ================================Map=================================
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 157
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * HashGet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 158
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key  键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             159
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param item 项 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             160
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 161
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">hget</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String item<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> item<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 167
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 获取hashKey对应的所有键值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 168
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            169
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 对应的多个键值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 170
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Map<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">hmget</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">entries</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 176
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * HashSet
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 177
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            178
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param map 对应多个键值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            179
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true 成功 false 失败
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 180
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hmset</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> map<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">putAll</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> map<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 192
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * HashSet 并设置时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 193
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key  键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             194
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param map  对应多个键值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             195
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time 时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             196
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true成功 false失败
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 197
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hmset</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> map<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">putAll</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> map<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>time <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>                expire<span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> time<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 212
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 向一张hash表中放入数据,如果不存在将创建
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 213
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              214
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param item  项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              215
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              216
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true 成功 false失败
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 217
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hset</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String item<span style="color:#f92672">,</span> Object value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> item<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 229
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 向一张hash表中放入数据,如果不存在将创建
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 230
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              231
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param item  项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              232
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              233
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              234
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true 成功 false失败
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 235
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hset</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String item<span style="color:#f92672">,</span> Object value<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> item<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>time <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                expire<span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> time<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>           e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 250
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 删除hash表中的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 251
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key  键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             252
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param item 项 可以使多个 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             253
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">hdel</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object<span style="color:#f92672">...</span> item<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">delete</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> item<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 259
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 判断hash表中是否有该项的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 260
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key  键 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             261
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param item 项 不能为null
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             262
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true 存在 false不存在
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 263
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hHasKey</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String item<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">hasKey</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> item<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 269
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 270
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key  键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             271
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param item 项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             272
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param by   要增加几(大于0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             273
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 274
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">hincr</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String item<span style="color:#f92672">,</span> <span style="color:#66d9ef">double</span> by<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">increment</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> item<span style="color:#f92672">,</span> by<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 280
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * hash递减
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 281
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key  键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             282
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param item 项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             283
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param by   要减少记(小于0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *             284
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 285
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">hdecr</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> String item<span style="color:#f92672">,</span> <span style="color:#66d9ef">double</span> by<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForHash</span><span style="color:#f92672">().</span><span style="color:#a6e22e">increment</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> item<span style="color:#f92672">,</span> <span style="color:#f92672">-</span>by<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ============================set=============================
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 292
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 根据key获取Set中的所有值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 293
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            294
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 295
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Set<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">sGet</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForSet</span><span style="color:#f92672">().</span><span style="color:#a6e22e">members</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 306
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 根据value从一个set中查询,是否存在
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 307
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              308
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              309
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return true 存在 false不存在
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 310
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">sHasKey</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForSet</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isMember</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 321
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 将数据放入set缓存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 322
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key    键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *               323
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param values 值 可以是多个
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *               324
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 成功个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 325
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">sSet</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object<span style="color:#f92672">...</span> values<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForSet</span><span style="color:#f92672">().</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> values<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 336
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 将set数据放入缓存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 337
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key    键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *               338
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time   时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *               339
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param values 值 可以是多个
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *               340
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 成功个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 341
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">sSetAndTime</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> time<span style="color:#f92672">,</span> Object<span style="color:#f92672">...</span> values<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Long count <span style="color:#f92672">=</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForSet</span><span style="color:#f92672">().</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> values<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>time <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>              expire<span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> time<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> count<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>          e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 355
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 获取set缓存的长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 356
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            357
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 358
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">sGetSetSize</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForSet</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 369
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 移除值为value的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 370
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key    键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *               371
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param values 值 可以是多个
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *               372
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 移除的个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 373
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">setRemove</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object<span style="color:#f92672">...</span> values<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Long count <span style="color:#f92672">=</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForSet</span><span style="color:#f92672">().</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> values<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> count<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ===============================list=================================
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 386
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 获取list缓存的内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 387
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              388
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param start 开始
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              389
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param end   结束 0 到 -1代表所有值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              390
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 391
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">lGet</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> start<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> end<span style="color:#f92672">)</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">range</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> start<span style="color:#f92672">,</span> end<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 402
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 获取list缓存的长度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 403
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key 键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *            404
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 405
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">lGetListSize</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 416
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 通过索引 获取list中的值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 417
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              418
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              419
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 420
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">lGetIndex</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> index<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">index</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> index<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 431
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 将list放入缓存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 432
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              433
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              434
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time  时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              435
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 436
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lSet</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 将list放入缓存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time  时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lSet</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> Object value<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPush</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>time <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                expire<span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> time<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>          e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 467
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 将list放入缓存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 468
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              469
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              470
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time  时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              471
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 472
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lSet</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPushAll</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>          e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 484
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 将list放入缓存
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 485
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * &lt;p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 486
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              487
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              488
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param time  时间(秒)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              489
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 490
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lSet</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> value<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> time<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">rightPushAll</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>time <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                expire<span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> time<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 504
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 根据索引修改list中的某条数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 505
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              506
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param index 索引
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              507
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              508
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 509
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">lUpdateIndex</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> index<span style="color:#f92672">,</span> Object value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> index<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 521
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 移除N个值为value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 522
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param key   键
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              523
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param count 移除多少个
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              524
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param value 值
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *              525
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return 移除的个数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 526
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">lRemove</span><span style="color:#f92672">(</span>String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> count<span style="color:#f92672">,</span> Object value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Long remove <span style="color:#f92672">=</span> redisTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">opsForList</span><span style="color:#f92672">().</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>key<span style="color:#f92672">,</span> count<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> remove<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>           e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="二十五哨兵模式">二十五、哨兵模式<a hidden class="anchor" aria-hidden="true" href="#二十五哨兵模式">#</a></h4>
<h5 id="251-自动选举master的模式">25.1 自动选举master的模式<a hidden class="anchor" aria-hidden="true" href="#251-自动选举master的模式">#</a></h5>
<p>主从切换的技术方式是：当主机宕机之后，需要手动把一台服务器切换为主机服务器，这就需要人工干预，费时费力，还会造成一段时间内服务器不可用，这是一种不推荐的方式，更多的时候，我们在考虑使用哨兵模式。redis中2.8之后提供了哨兵模式来解决这个问题。</p>
<p>哨兵模式是一种特殊的模式，首先redis提供哨兵命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是<strong>哨兵同过发送命令，等待redis 服务器响应，从而监控运行的多个redis实例。</strong></p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200809181028449.png" alt="image-20200809181028449"  />
</p>
<p>这里的哨兵有两个作用：</p>
<ul>
<li>通过发送命令，让redis服务器返回监控其运行状态，包括主服务器和从服务器。</li>
<li>当哨兵检测到master宕机，会自动将slave切换成为master，然后通过发布订阅模式通知其他的服务器，修改配置文件，让她们切换主机。</li>
</ul>
<p>然而一个哨兵进程对Redis服务器进行监控可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p>
<p><img loading="lazy" src="/posts.images/redis/images/image-20200809181628868.png" alt="image-20200809181628868"  />
</p>
<p>假设主服务宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主管的认为服务器不可用，这个现象称为主观下线。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一侧投票，投票的结果由一个哨兵发起，进行failover[故障转移]操作。切换成功后，就会通过发布订阅模式，让哥哥哨兵把自己监控的服务器实现切换主机，这个过程称为可观下线。</p>
<p>我们目前的装填是一主二从！</p>
<p>1、配置哨兵配置文件sentinel.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">sentinel</span> <span style="color:#a6e22e">monitor</span>  <span style="color:#a6e22e">被监控的名称host</span> <span style="color:#a6e22e">port</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sentinel</span> <span style="color:#a6e22e">monitor</span>  <span style="color:#a6e22e">myredis</span> <span style="color:#ae81ff">127.0</span>.<span style="color:#ae81ff">0.1</span> <span style="color:#ae81ff">6379</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>候命的这个数字1，代表主机挂了，slave投票看让谁阶梯称为主机，票数最多的，就会称为主机！</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>redis-sentinel  bin/sentinel.conf
</span></span></code></pre></div><p><strong>优点：</strong></p>
<ul>
<li>哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</li>
<li>主从可以切换，故障可以转移，系统的可用性就会更好</li>
<li>哨兵模式就是主从模式的升级买手动到自动，更加健壮！</li>
</ul>
<p><strong>缺点</strong> ：</p>
<ul>
<li>redis不好在线扩容，集群容量一旦达到上限，在向扩容就十分麻烦！</li>
<li>实现哨兵模式的配置其实是很麻烦的，里面有很多选择！</li>
</ul>


        </div>

        <footer class="post-footer">
            

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="http://hugo.itshare.work/" style="color:#939393;">Cookie</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;"></a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="" style="float:left;margin: 0px 5px 0px 0px;"/>
            
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"Cookie"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"Cookie"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = '📄复制';

        function copyingDone() {
            copybutton.innerText = '👌🏻已复制!';
            setTimeout(() => {
                copybutton.innerText = '📄复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\n————————————————\r\n' +
                    '版权声明：本文为「'+"Cookie"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
